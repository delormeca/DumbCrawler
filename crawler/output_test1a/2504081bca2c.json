{
  "url": "https://docs.python.org/3/library/weakref.html",
  "status_code": 200,
  "depth": 1,
  "referrer": "https://docs.python.org/3/library/",
  "raw_html": "<!DOCTYPE html>\n\n<html lang=\"en\" data-content_root=\"../\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<meta property=\"og:title\" content=\"weakref — Weak references\" />\n<meta property=\"og:type\" content=\"website\" />\n<meta property=\"og:url\" content=\"https://docs.python.org/3/library/weakref.html\" />\n<meta property=\"og:site_name\" content=\"Python documentation\" />\n<meta property=\"og:description\" content=\"Source code: Lib/weakref.py The weakref module allows the Python programmer to create weak references to objects. In the following, the term referent means the object which is referred to by a weak...\" />\n<meta property=\"og:image:width\" content=\"1146\" />\n<meta property=\"og:image:height\" content=\"600\" />\n<meta property=\"og:image\" content=\"https://docs.python.org/3.14/_images/social_previews/summary_library_weakref_88301ee3.png\" />\n<meta property=\"og:image:alt\" content=\"Source code: Lib/weakref.py The weakref module allows the Python programmer to create weak references to objects. In the following, the term referent means the object which is referred to by a weak...\" />\n<meta name=\"description\" content=\"Source code: Lib/weakref.py The weakref module allows the Python programmer to create weak references to objects. In the following, the term referent means the object which is referred to by a weak...\" />\n<meta name=\"twitter:card\" content=\"summary_large_image\" />\n<meta name=\"theme-color\" content=\"#3776ab\">\n\n    <title>weakref — Weak references &#8212; Python 3.14.0 documentation</title><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments.css?v=b86133f3\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/classic.css?v=234b1a7c\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pydoctheme.css?v=8cd84f99\" />\n    <link id=\"pygments_dark_css\" media=\"(prefers-color-scheme: dark)\" rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments_dark.css?v=5349f25f\" />\n    \n    <script src=\"../_static/documentation_options.js?v=e4f4b189\"></script>\n    <script src=\"../_static/doctools.js?v=9bcbadda\"></script>\n    <script src=\"../_static/sphinx_highlight.js?v=dc90522c\"></script>\n    \n    <script src=\"../_static/sidebar.js\"></script>\n    \n    <link rel=\"search\" type=\"application/opensearchdescription+xml\"\n          title=\"Search within Python 3.14.0 documentation\"\n          href=\"../_static/opensearch.xml\"/>\n    <link rel=\"author\" title=\"About these documents\" href=\"../about.html\" />\n    <link rel=\"index\" title=\"Index\" href=\"../genindex.html\" />\n    <link rel=\"search\" title=\"Search\" href=\"../search.html\" />\n    <link rel=\"copyright\" title=\"Copyright\" href=\"../copyright.html\" />\n    <link rel=\"next\" title=\"types — Dynamic type creation and names for built-in types\" href=\"types.html\" />\n    <link rel=\"prev\" title=\"array — Efficient arrays of numeric values\" href=\"array.html\" />\n    \n      \n      <script defer file-types=\"bz2,epub,zip\" data-domain=\"docs.python.org\" src=\"https://analytics.python.org/js/script.file-downloads.outbound-links.js\"></script>\n      \n      <link rel=\"canonical\" href=\"https://docs.python.org/3/library/weakref.html\">\n      \n    \n\n    \n    <style>\n      @media only screen {\n        table.full-width-table {\n            width: 100%;\n        }\n      }\n    </style>\n<link rel=\"stylesheet\" href=\"../_static/pydoctheme_dark.css\" media=\"(prefers-color-scheme: dark)\" id=\"pydoctheme_dark_css\">\n    <link rel=\"shortcut icon\" type=\"image/png\" href=\"../_static/py.svg\">\n            <script type=\"text/javascript\" src=\"../_static/copybutton.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/menu.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/search-focus.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/themetoggle.js\"></script> \n            <script type=\"text/javascript\" src=\"../_static/rtd_switcher.js\"></script>\n            <meta name=\"readthedocs-addons-api-version\" content=\"1\">\n\n  </head>\n<body>\n<div class=\"mobile-nav\">\n    <input type=\"checkbox\" id=\"menuToggler\" class=\"toggler__input\" aria-controls=\"navigation\"\n           aria-pressed=\"false\" aria-expanded=\"false\" role=\"button\" aria-label=\"Menu\">\n    <nav class=\"nav-content\" role=\"navigation\">\n        <label for=\"menuToggler\" class=\"toggler__label\">\n            <span></span>\n        </label>\n        <span class=\"nav-items-wrapper\">\n            <a href=\"https://www.python.org/\" class=\"nav-logo\">\n                <img src=\"../_static/py.svg\" alt=\"Python logo\">\n            </a>\n            <span class=\"version_switcher_placeholder\"></span>\n            <form role=\"search\" class=\"search\" action=\"../search.html\" method=\"get\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" class=\"search-icon\">\n                    <path fill-rule=\"nonzero\" fill=\"currentColor\" d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"></path>\n                </svg>\n                <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\">\n                <input type=\"submit\" value=\"Go\">\n            </form>\n        </span>\n    </nav>\n    <div class=\"menu-wrapper\">\n        <nav class=\"menu\" role=\"navigation\" aria-label=\"main navigation\">\n            <div class=\"language_switcher_placeholder\"></div>\n            \n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label>\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code> — Weak references</a><ul>\n<li><a class=\"reference internal\" href=\"#weak-reference-objects\">Weak Reference Objects</a></li>\n<li><a class=\"reference internal\" href=\"#example\">Example</a></li>\n<li><a class=\"reference internal\" href=\"#finalizer-objects\">Finalizer Objects</a></li>\n<li><a class=\"reference internal\" href=\"#comparing-finalizers-with-del-methods\">Comparing finalizers with <code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code> methods</a></li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"array.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">array</span></code> — Efficient arrays of numeric values</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"types.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">types</span></code> — Dynamic type creation and names for built-in types</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/weakref.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </nav>\n    </div>\n</div>\n\n  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             accesskey=\"I\">index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"types.html\" title=\"types — Dynamic type creation and names for built-in types\"\n             accesskey=\"N\">next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"array.html\" title=\"array — Efficient arrays of numeric values\"\n             accesskey=\"P\">previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"datatypes.html\" accesskey=\"U\">Data Types</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code> — Weak references</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>    \n\n    <div class=\"document\">\n      <div class=\"documentwrapper\">\n        <div class=\"bodywrapper\">\n          <div class=\"body\" role=\"main\">\n            \n  <section id=\"module-weakref\">\n<span id=\"weakref-weak-references\"></span><span id=\"mod-weakref\"></span><h1><a class=\"reference internal\" href=\"#module-weakref\" title=\"weakref: Support for weak references and weak dictionaries.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code></a> — Weak references<a class=\"headerlink\" href=\"#module-weakref\" title=\"Link to this heading\">¶</a></h1>\n<p><strong>Source code:</strong> <a class=\"extlink-source reference external\" href=\"https://github.com/python/cpython/tree/3.14/Lib/weakref.py\">Lib/weakref.py</a></p>\n<hr class=\"docutils\" />\n<p>The <a class=\"reference internal\" href=\"#module-weakref\" title=\"weakref: Support for weak references and weak dictionaries.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code></a> module allows the Python programmer to create <em class=\"dfn\">weak\nreferences</em> to objects.</p>\n<p>In the following, the term <em class=\"dfn\">referent</em> means the object which is referred to\nby a weak reference.</p>\n<p>A weak reference to an object is not enough to keep the object alive: when the\nonly remaining references to a referent are weak references,\n<a class=\"reference internal\" href=\"../glossary.html#term-garbage-collection\"><span class=\"xref std std-term\">garbage collection</span></a> is free to destroy the referent and reuse its memory\nfor something else.  However, until the object is actually destroyed the weak\nreference may return the object even if there are no strong references to it.</p>\n<p>A primary use for weak references is to implement caches or\nmappings holding large objects, where it’s desired that a large object not be\nkept alive solely because it appears in a cache or mapping.</p>\n<p>For example, if you have a number of large binary image objects, you may wish to\nassociate a name with each.  If you used a Python dictionary to map names to\nimages, or images to names, the image objects would remain alive just because\nthey appeared as values or keys in the dictionaries.  The\n<a class=\"reference internal\" href=\"#weakref.WeakKeyDictionary\" title=\"weakref.WeakKeyDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakKeyDictionary</span></code></a> and <a class=\"reference internal\" href=\"#weakref.WeakValueDictionary\" title=\"weakref.WeakValueDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakValueDictionary</span></code></a> classes supplied by\nthe <a class=\"reference internal\" href=\"#module-weakref\" title=\"weakref: Support for weak references and weak dictionaries.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code></a> module are an alternative, using weak references to construct\nmappings that don’t keep objects alive solely because they appear in the mapping\nobjects.  If, for example, an image object is a value in a\n<a class=\"reference internal\" href=\"#weakref.WeakValueDictionary\" title=\"weakref.WeakValueDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakValueDictionary</span></code></a>, then when the last remaining references to that\nimage object are the weak references held by weak mappings, garbage collection\ncan reclaim the object, and its corresponding entries in weak mappings are\nsimply deleted.</p>\n<p><a class=\"reference internal\" href=\"#weakref.WeakKeyDictionary\" title=\"weakref.WeakKeyDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakKeyDictionary</span></code></a> and <a class=\"reference internal\" href=\"#weakref.WeakValueDictionary\" title=\"weakref.WeakValueDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakValueDictionary</span></code></a> use weak references\nin their implementation, setting up callback functions on the weak references\nthat notify the weak dictionaries when a key or value has been reclaimed by\ngarbage collection.  <a class=\"reference internal\" href=\"#weakref.WeakSet\" title=\"weakref.WeakSet\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakSet</span></code></a> implements the <a class=\"reference internal\" href=\"stdtypes.html#set\" title=\"set\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">set</span></code></a> interface,\nbut keeps weak references to its elements, just like a\n<a class=\"reference internal\" href=\"#weakref.WeakKeyDictionary\" title=\"weakref.WeakKeyDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakKeyDictionary</span></code></a> does.</p>\n<p><a class=\"reference internal\" href=\"#weakref.finalize\" title=\"weakref.finalize\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">finalize</span></code></a> provides a straight forward way to register a\ncleanup function to be called when an object is garbage collected.\nThis is simpler to use than setting up a callback function on a raw\nweak reference, since the module automatically ensures that the finalizer\nremains alive until the object is collected.</p>\n<p>Most programs should find that using one of these weak container types\nor <a class=\"reference internal\" href=\"#weakref.finalize\" title=\"weakref.finalize\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">finalize</span></code></a> is all they need – it’s not usually necessary to\ncreate your own weak references directly.  The low-level machinery is\nexposed by the <a class=\"reference internal\" href=\"#module-weakref\" title=\"weakref: Support for weak references and weak dictionaries.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code></a> module for the benefit of advanced uses.</p>\n<p>Not all objects can be weakly referenced. Objects which support weak references\ninclude class instances, functions written in Python (but not in C), instance methods,\nsets, frozensets, some <a class=\"reference internal\" href=\"../glossary.html#term-file-object\"><span class=\"xref std std-term\">file objects</span></a>, <a class=\"reference internal\" href=\"../glossary.html#term-generator\"><span class=\"xref std std-term\">generators</span></a>,\ntype objects, sockets, arrays, deques, regular expression pattern objects, and code\nobjects.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.2: </span>Added support for thread.lock, threading.Lock, and code objects.</p>\n</div>\n<p>Several built-in types such as <a class=\"reference internal\" href=\"stdtypes.html#list\" title=\"list\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">list</span></code></a> and <a class=\"reference internal\" href=\"stdtypes.html#dict\" title=\"dict\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">dict</span></code></a> do not directly\nsupport weak references but can add support through subclassing:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Dict</span><span class=\"p\">(</span><span class=\"nb\">dict</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n<span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">Dict</span><span class=\"p\">(</span><span class=\"n\">red</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">green</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">blue</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>   <span class=\"c1\"># this object is weak referenceable</span>\n</pre></div>\n</div>\n<div class=\"impl-detail compound\">\n<p><strong>CPython implementation detail:</strong> Other built-in types such as <a class=\"reference internal\" href=\"stdtypes.html#tuple\" title=\"tuple\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">tuple</span></code></a> and <a class=\"reference internal\" href=\"functions.html#int\" title=\"int\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">int</span></code></a> do not support weak\nreferences even when subclassed.</p>\n</div>\n<p>Extension types can easily be made to support weak references; see\n<a class=\"reference internal\" href=\"../extending/newtypes.html#weakref-support\"><span class=\"std std-ref\">Weak Reference Support</span></a>.</p>\n<p>When <code class=\"docutils literal notranslate\"><span class=\"pre\">__slots__</span></code> are defined for a given type, weak reference support is\ndisabled unless a <code class=\"docutils literal notranslate\"><span class=\"pre\">'__weakref__'</span></code> string is also present in the sequence of\nstrings in the <code class=\"docutils literal notranslate\"><span class=\"pre\">__slots__</span></code> declaration.\nSee <a class=\"reference internal\" href=\"../reference/datamodel.html#slots\"><span class=\"std std-ref\">__slots__ documentation</span></a> for details.</p>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.ref\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ref</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">object</span></span></em><span class=\"optional\">[</span>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">callback</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.ref\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a weak reference to <em>object</em>.  The original object can be retrieved by\ncalling the reference object if the referent is still alive; if the referent is\nno longer alive, calling the reference object will cause <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a> to be\nreturned.  If <em>callback</em> is provided and not <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>, and the returned\nweakref object is still alive, the callback will be called when the object is\nabout to be finalized; the weak reference object will be passed as the only\nparameter to the callback; the referent will no longer be available.</p>\n<p>It is allowable for many weak references to be constructed for the same object.\nCallbacks registered for each weak reference will be called from the most\nrecently registered callback to the oldest registered callback.</p>\n<p>Exceptions raised by the callback will be noted on the standard error output,\nbut cannot be propagated; they are handled in exactly the same way as exceptions\nraised from an object’s <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> method.</p>\n<p>Weak references are <a class=\"reference internal\" href=\"../glossary.html#term-hashable\"><span class=\"xref std std-term\">hashable</span></a> if the <em>object</em> is hashable.  They will\nmaintain their hash value even after the <em>object</em> was deleted.  If\n<a class=\"reference internal\" href=\"functions.html#hash\" title=\"hash\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">hash()</span></code></a> is called the first time only after the <em>object</em> was deleted,\nthe call will raise <a class=\"reference internal\" href=\"exceptions.html#TypeError\" title=\"TypeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">TypeError</span></code></a>.</p>\n<p>Weak references support tests for equality, but not ordering.  If the referents\nare still alive, two references have the same equality relationship as their\nreferents (regardless of the <em>callback</em>).  If either referent has been deleted,\nthe references are equal only if the reference objects are the same object.</p>\n<p>This is a subclassable type rather than a factory function.</p>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"weakref.ref.__callback__\">\n<span class=\"sig-name descname\"><span class=\"pre\">__callback__</span></span><a class=\"headerlink\" href=\"#weakref.ref.__callback__\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>This read-only attribute returns the callback currently associated to the\nweakref.  If there is no callback or if the referent of the weakref is\nno longer alive then this attribute will have value <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>.</p>\n</dd></dl>\n\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.4: </span>Added the <a class=\"reference internal\" href=\"#weakref.ref.__callback__\" title=\"weakref.ref.__callback__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__callback__</span></code></a> attribute.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"weakref.proxy\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">proxy</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">object</span></span></em><span class=\"optional\">[</span>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">callback</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.proxy\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a proxy to <em>object</em> which uses a weak reference.  This supports use of\nthe proxy in most contexts instead of requiring the explicit dereferencing used\nwith weak reference objects.  The returned object will have a type of either\n<code class=\"docutils literal notranslate\"><span class=\"pre\">ProxyType</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">CallableProxyType</span></code>, depending on whether <em>object</em> is\ncallable.  Proxy objects are not <a class=\"reference internal\" href=\"../glossary.html#term-hashable\"><span class=\"xref std std-term\">hashable</span></a> regardless of the referent; this\navoids a number of problems related to their fundamentally mutable nature, and\nprevents their use as dictionary keys.  <em>callback</em> is the same as the parameter\nof the same name to the <a class=\"reference internal\" href=\"#weakref.ref\" title=\"weakref.ref\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">ref()</span></code></a> function.</p>\n<p>Accessing an attribute of the proxy object after the referent is\ngarbage collected raises <a class=\"reference internal\" href=\"exceptions.html#ReferenceError\" title=\"ReferenceError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">ReferenceError</span></code></a>.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.8: </span>Extended the operator support on proxy objects to include the matrix\nmultiplication operators <code class=\"docutils literal notranslate\"><span class=\"pre\">&#64;</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">&#64;=</span></code>.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"weakref.getweakrefcount\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">getweakrefcount</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">object</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.getweakrefcount\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return the number of weak references and proxies which refer to <em>object</em>.</p>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"weakref.getweakrefs\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">getweakrefs</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">object</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.getweakrefs\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a list of all weak reference and proxy objects which refer to <em>object</em>.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakKeyDictionary\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">WeakKeyDictionary</span></span><span class=\"sig-paren\">(</span><span class=\"optional\">[</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">dict</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakKeyDictionary\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Mapping class that references keys weakly.  Entries in the dictionary will be\ndiscarded when there is no longer a strong reference to the key.  This can be\nused to associate additional data with an object owned by other parts of an\napplication without adding attributes to those objects.  This can be especially\nuseful with objects that override attribute accesses.</p>\n<p>Note that when a key with equal value to an existing key (but not equal identity)\nis inserted into the dictionary, it replaces the value but does not replace the\nexisting key. Due to this, when the reference to the original key is deleted, it\nalso deletes the entry in the dictionary:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">T</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">):</span> <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">k1</span><span class=\"p\">,</span> <span class=\"n\">k2</span> <span class=\"o\">=</span> <span class=\"n\">T</span><span class=\"p\">(),</span> <span class=\"n\">T</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">WeakKeyDictionary</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span><span class=\"p\">[</span><span class=\"n\">k1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>   <span class=\"c1\"># d = {k1: 1}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span><span class=\"p\">[</span><span class=\"n\">k2</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>   <span class=\"c1\"># d = {k1: 2}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">k1</span>      <span class=\"c1\"># d = {}</span>\n</pre></div>\n</div>\n<p>A workaround would be to remove the key prior to reassignment:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">T</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">):</span> <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">k1</span><span class=\"p\">,</span> <span class=\"n\">k2</span> <span class=\"o\">=</span> <span class=\"n\">T</span><span class=\"p\">(),</span> <span class=\"n\">T</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">WeakKeyDictionary</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span><span class=\"p\">[</span><span class=\"n\">k1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>   <span class=\"c1\"># d = {k1: 1}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">d</span><span class=\"p\">[</span><span class=\"n\">k1</span><span class=\"p\">]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">d</span><span class=\"p\">[</span><span class=\"n\">k2</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>   <span class=\"c1\"># d = {k2: 2}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">k1</span>      <span class=\"c1\"># d = {k2: 2}</span>\n</pre></div>\n</div>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.9: </span>Added support for <code class=\"docutils literal notranslate\"><span class=\"pre\">|</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">|=</span></code> operators, as specified in <span class=\"target\" id=\"index-0\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0584/\"><strong>PEP 584</strong></a>.</p>\n</div>\n</dd></dl>\n\n<p><a class=\"reference internal\" href=\"#weakref.WeakKeyDictionary\" title=\"weakref.WeakKeyDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakKeyDictionary</span></code></a> objects have an additional method that\nexposes the internal references directly.  The references are not guaranteed to\nbe “live” at the time they are used, so the result of calling the references\nneeds to be checked before being used.  This can be used to avoid creating\nreferences that will cause the garbage collector to keep the keys around longer\nthan needed.</p>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakKeyDictionary.keyrefs\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">WeakKeyDictionary.</span></span><span class=\"sig-name descname\"><span class=\"pre\">keyrefs</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakKeyDictionary.keyrefs\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return an iterable of the weak references to the keys.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakValueDictionary\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">WeakValueDictionary</span></span><span class=\"sig-paren\">(</span><span class=\"optional\">[</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">dict</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakValueDictionary\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Mapping class that references values weakly.  Entries in the dictionary will be\ndiscarded when no strong reference to the value exists any more.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.9: </span>Added support for <code class=\"docutils literal notranslate\"><span class=\"pre\">|</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">|=</span></code> operators, as specified in <span class=\"target\" id=\"index-1\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0584/\"><strong>PEP 584</strong></a>.</p>\n</div>\n</dd></dl>\n\n<p><a class=\"reference internal\" href=\"#weakref.WeakValueDictionary\" title=\"weakref.WeakValueDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakValueDictionary</span></code></a> objects have an additional method that has the\nsame issues as the <a class=\"reference internal\" href=\"#weakref.WeakKeyDictionary.keyrefs\" title=\"weakref.WeakKeyDictionary.keyrefs\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">WeakKeyDictionary.keyrefs()</span></code></a> method.</p>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakValueDictionary.valuerefs\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">WeakValueDictionary.</span></span><span class=\"sig-name descname\"><span class=\"pre\">valuerefs</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakValueDictionary.valuerefs\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return an iterable of the weak references to the values.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakSet\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">WeakSet</span></span><span class=\"sig-paren\">(</span><span class=\"optional\">[</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">elements</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakSet\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Set class that keeps weak references to its elements.  An element will be\ndiscarded when no strong reference to it exists any more.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.WeakMethod\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">WeakMethod</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">method</span></span></em><span class=\"optional\">[</span>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">callback</span></span></em><span class=\"optional\">]</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.WeakMethod\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A custom <a class=\"reference internal\" href=\"#weakref.ref\" title=\"weakref.ref\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ref</span></code></a> subclass which simulates a weak reference to a bound\nmethod (i.e., a method defined on a class and looked up on an instance).\nSince a bound method is ephemeral, a standard weak reference cannot keep\nhold of it.  <a class=\"reference internal\" href=\"#weakref.WeakMethod\" title=\"weakref.WeakMethod\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakMethod</span></code></a> has special code to recreate the bound\nmethod until either the object or the original function dies:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">C</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">method</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;method called!&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">C</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">ref</span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">WeakMethod</span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;bound method C.method of &lt;__main__.C object at 0x7fc859830220&gt;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span><span class=\"p\">()()</span>\n<span class=\"go\">method called!</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">c</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">gc</span><span class=\"o\">.</span><span class=\"n\">collect</span><span class=\"p\">()</span>\n<span class=\"go\">0</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt;</span>\n</pre></div>\n</div>\n<p><em>callback</em> is the same as the parameter of the same name to the <a class=\"reference internal\" href=\"#weakref.ref\" title=\"weakref.ref\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">ref()</span></code></a> function.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.4.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">finalize</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">obj</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">func</span></span></em>, <em class=\"sig-param\"><span class=\"positional-only-separator o\"><abbr title=\"Positional-only parameter separator (PEP 570)\"><span class=\"pre\">/</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">args</span></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">**</span></span><span class=\"n\"><span class=\"pre\">kwargs</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.finalize\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a callable finalizer object which will be called when <em>obj</em>\nis garbage collected. Unlike an ordinary weak reference, a finalizer\nwill always survive until the reference object is collected, greatly\nsimplifying lifecycle management.</p>\n<p>A finalizer is considered <em>alive</em> until it is called (either explicitly\nor at garbage collection), and after that it is <em>dead</em>.  Calling a live\nfinalizer returns the result of evaluating <code class=\"docutils literal notranslate\"><span class=\"pre\">func(*arg,</span> <span class=\"pre\">**kwargs)</span></code>,\nwhereas calling a dead finalizer returns <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>.</p>\n<p>Exceptions raised by finalizer callbacks during garbage collection\nwill be shown on the standard error output, but cannot be\npropagated.  They are handled in the same way as exceptions raised\nfrom an object’s <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> method or a weak reference’s\ncallback.</p>\n<p>When the program exits, each remaining live finalizer is called\nunless its <a class=\"reference internal\" href=\"atexit.html#module-atexit\" title=\"atexit: Register and execute cleanup functions.\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">atexit</span></code></a> attribute has been set to false.  They\nare called in reverse order of creation.</p>\n<p>A finalizer will never invoke its callback during the later part of\nthe <a class=\"reference internal\" href=\"../glossary.html#term-interpreter-shutdown\"><span class=\"xref std std-term\">interpreter shutdown</span></a> when module globals are liable to have\nbeen replaced by <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>.</p>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize.__call__\">\n<span class=\"sig-name descname\"><span class=\"pre\">__call__</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.finalize.__call__\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>If <em>self</em> is alive then mark it as dead and return the result of\ncalling <code class=\"docutils literal notranslate\"><span class=\"pre\">func(*args,</span> <span class=\"pre\">**kwargs)</span></code>.  If <em>self</em> is dead then return\n<a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize.detach\">\n<span class=\"sig-name descname\"><span class=\"pre\">detach</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.finalize.detach\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>If <em>self</em> is alive then mark it as dead and return the tuple\n<code class=\"docutils literal notranslate\"><span class=\"pre\">(obj,</span> <span class=\"pre\">func,</span> <span class=\"pre\">args,</span> <span class=\"pre\">kwargs)</span></code>.  If <em>self</em> is dead then return\n<a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize.peek\">\n<span class=\"sig-name descname\"><span class=\"pre\">peek</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#weakref.finalize.peek\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>If <em>self</em> is alive then return the tuple <code class=\"docutils literal notranslate\"><span class=\"pre\">(obj,</span> <span class=\"pre\">func,</span> <span class=\"pre\">args,</span>\n<span class=\"pre\">kwargs)</span></code>.  If <em>self</em> is dead then return <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize.alive\">\n<span class=\"sig-name descname\"><span class=\"pre\">alive</span></span><a class=\"headerlink\" href=\"#weakref.finalize.alive\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Property which is true if the finalizer is alive, false otherwise.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"weakref.finalize.atexit\">\n<span class=\"sig-name descname\"><span class=\"pre\">atexit</span></span><a class=\"headerlink\" href=\"#weakref.finalize.atexit\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A writable boolean property which by default is true.  When the\nprogram exits, it calls all remaining live finalizers for which\n<a class=\"reference internal\" href=\"#weakref.finalize.atexit\" title=\"weakref.finalize.atexit\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">atexit</span></code></a> is true.  They are called in reverse order of\ncreation.</p>\n</dd></dl>\n\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>It is important to ensure that <em>func</em>, <em>args</em> and <em>kwargs</em> do\nnot own any references to <em>obj</em>, either directly or indirectly,\nsince otherwise <em>obj</em> will never be garbage collected.  In\nparticular, <em>func</em> should not be a bound method of <em>obj</em>.</p>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.4.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py data\">\n<dt class=\"sig sig-object py\" id=\"weakref.ReferenceType\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ReferenceType</span></span><a class=\"headerlink\" href=\"#weakref.ReferenceType\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>The type object for weak references objects.</p>\n</dd></dl>\n\n<dl class=\"py data\">\n<dt class=\"sig sig-object py\" id=\"weakref.ProxyType\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ProxyType</span></span><a class=\"headerlink\" href=\"#weakref.ProxyType\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>The type object for proxies of objects which are not callable.</p>\n</dd></dl>\n\n<dl class=\"py data\">\n<dt class=\"sig sig-object py\" id=\"weakref.CallableProxyType\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">CallableProxyType</span></span><a class=\"headerlink\" href=\"#weakref.CallableProxyType\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>The type object for proxies of callable objects.</p>\n</dd></dl>\n\n<dl class=\"py data\">\n<dt class=\"sig sig-object py\" id=\"weakref.ProxyTypes\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">weakref.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ProxyTypes</span></span><a class=\"headerlink\" href=\"#weakref.ProxyTypes\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Sequence containing all the type objects for proxies.  This can make it simpler\nto test if an object is a proxy without being dependent on naming both proxy\ntypes.</p>\n</dd></dl>\n\n<div class=\"admonition seealso\">\n<p class=\"admonition-title\">See also</p>\n<dl class=\"simple\">\n<dt><span class=\"target\" id=\"index-2\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0205/\"><strong>PEP 205</strong></a> - Weak References</dt><dd><p>The proposal and rationale for this feature, including links to earlier\nimplementations and information about similar features in other languages.</p>\n</dd>\n</dl>\n</div>\n<section id=\"weak-reference-objects\">\n<span id=\"weakref-objects\"></span><h2>Weak Reference Objects<a class=\"headerlink\" href=\"#weak-reference-objects\" title=\"Link to this heading\">¶</a></h2>\n<p>Weak reference objects have no methods and no attributes besides\n<a class=\"reference internal\" href=\"#weakref.ref.__callback__\" title=\"weakref.ref.__callback__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">ref.__callback__</span></code></a>. A weak reference object allows the referent to be\nobtained, if it still exists, by calling it:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">weakref</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Object</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">o</span> <span class=\"o\">=</span> <span class=\"n\">Object</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">ref</span><span class=\"p\">(</span><span class=\"n\">o</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">r</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">o</span> <span class=\"ow\">is</span> <span class=\"n\">o2</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>If the referent no longer exists, calling the reference object returns\n<a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">o2</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">())</span>\n<span class=\"go\">None</span>\n</pre></div>\n</div>\n<p>Testing that a weak reference object is still live should be done using the\nexpression <code class=\"docutils literal notranslate\"><span class=\"pre\">ref()</span> <span class=\"pre\">is</span> <span class=\"pre\">not</span> <span class=\"pre\">None</span></code>.  Normally, application code that needs to use\na reference object should follow this pattern:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># r is a weak reference object</span>\n<span class=\"n\">o</span> <span class=\"o\">=</span> <span class=\"n\">r</span><span class=\"p\">()</span>\n<span class=\"k\">if</span> <span class=\"n\">o</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n    <span class=\"c1\"># referent has been garbage collected</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Object has been deallocated; can&#39;t frobnicate.&quot;</span><span class=\"p\">)</span>\n<span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Object is still live!&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">o</span><span class=\"o\">.</span><span class=\"n\">do_something_useful</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Using a separate test for “liveness” creates race conditions in threaded\napplications; another thread can cause a weak reference to become invalidated\nbefore the weak reference is called; the idiom shown above is safe in threaded\napplications as well as single-threaded applications.</p>\n<p>Specialized versions of <a class=\"reference internal\" href=\"#weakref.ref\" title=\"weakref.ref\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ref</span></code></a> objects can be created through subclassing.\nThis is used in the implementation of the <a class=\"reference internal\" href=\"#weakref.WeakValueDictionary\" title=\"weakref.WeakValueDictionary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">WeakValueDictionary</span></code></a> to reduce\nthe memory overhead for each entry in the mapping.  This may be most useful to\nassociate additional information with a reference, but could also be used to\ninsert additional processing on calls to retrieve the referent.</p>\n<p>This example shows how a subclass of <a class=\"reference internal\" href=\"#weakref.ref\" title=\"weakref.ref\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ref</span></code></a> can be used to store\nadditional information about an object and affect the value that’s returned when\nthe referent is accessed:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">weakref</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ExtendedRef</span><span class=\"p\">(</span><span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">ref</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">ob</span><span class=\"p\">,</span> <span class=\"n\">callback</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">/</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">annotations</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">ob</span><span class=\"p\">,</span> <span class=\"n\">callback</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__counter</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">annotations</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Return a pair containing the referent and the number of</span>\n<span class=\"sd\">        times the reference has been called.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">ob</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__call__</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"n\">ob</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__counter</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n            <span class=\"n\">ob</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">ob</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__counter</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">ob</span>\n</pre></div>\n</div>\n</section>\n<section id=\"example\">\n<span id=\"weakref-example\"></span><h2>Example<a class=\"headerlink\" href=\"#example\" title=\"Link to this heading\">¶</a></h2>\n<p>This simple example shows how an application can use object IDs to retrieve\nobjects that it has seen before.  The IDs of the objects can then be used in\nother data structures without forcing the objects to remain alive, but the\nobjects can still be retrieved by ID if they do.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">weakref</span>\n\n<span class=\"n\">_id2obj_dict</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">WeakValueDictionary</span><span class=\"p\">()</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">remember</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">):</span>\n    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"nb\">id</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n    <span class=\"n\">_id2obj_dict</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">id2obj</span><span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">_id2obj_dict</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n</section>\n<section id=\"finalizer-objects\">\n<span id=\"finalize-examples\"></span><h2>Finalizer Objects<a class=\"headerlink\" href=\"#finalizer-objects\" title=\"Link to this heading\">¶</a></h2>\n<p>The main benefit of using <a class=\"reference internal\" href=\"#weakref.finalize\" title=\"weakref.finalize\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">finalize</span></code></a> is that it makes it simple\nto register a callback without needing to preserve the returned finalizer\nobject.  For instance</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">weakref</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Object</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">kenny</span> <span class=\"o\">=</span> <span class=\"n\">Object</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"n\">kenny</span><span class=\"p\">,</span> <span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;You killed Kenny!&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;finalize object at ...; for &#39;Object&#39; at ...&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">kenny</span>\n<span class=\"go\">You killed Kenny!</span>\n</pre></div>\n</div>\n<p>The finalizer can be called directly as well.  However the finalizer\nwill invoke the callback at most once.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">callback</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">,</span> <span class=\"n\">z</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;CALLBACK&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"n\">y</span> <span class=\"o\">+</span> <span class=\"n\">z</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">Object</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">callback</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">z</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">alive</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">f</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"mi\">6</span>\n<span class=\"go\">CALLBACK</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">alive</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">f</span><span class=\"p\">()</span>                     <span class=\"c1\"># callback not called because finalizer dead</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">del</span> <span class=\"n\">obj</span>                 <span class=\"c1\"># callback not called because finalizer dead</span>\n</pre></div>\n</div>\n<p>You can unregister a finalizer using its <a class=\"reference internal\" href=\"#weakref.finalize.detach\" title=\"weakref.finalize.detach\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">detach()</span></code></a>\nmethod.  This kills the finalizer and returns the arguments passed to\nthe constructor when it was created.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">Object</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">callback</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">z</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">detach</span><span class=\"p\">()</span>\n<span class=\"go\">(&lt;...Object object ...&gt;, &lt;function callback ...&gt;, (1, 2), {&#39;z&#39;: 3})</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">newobj</span><span class=\"p\">,</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">_</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">alive</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">newobj</span> <span class=\"ow\">is</span> <span class=\"n\">obj</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">func</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">6</span>\n<span class=\"go\">CALLBACK</span>\n</pre></div>\n</div>\n<p>Unless you set the <a class=\"reference internal\" href=\"#weakref.finalize.atexit\" title=\"weakref.finalize.atexit\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">atexit</span></code></a> attribute to\n<a class=\"reference internal\" href=\"constants.html#False\" title=\"False\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">False</span></code></a>, a finalizer will be called when the program exits if it\nis still alive.  For instance</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">Object</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;obj dead or exiting&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;finalize object at ...; for &#39;Object&#39; at ...&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">exit</span><span class=\"p\">()</span>\n<span class=\"go\">obj dead or exiting</span>\n</pre></div>\n</div>\n</section>\n<section id=\"comparing-finalizers-with-del-methods\">\n<h2>Comparing finalizers with <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> methods<a class=\"headerlink\" href=\"#comparing-finalizers-with-del-methods\" title=\"Link to this heading\">¶</a></h2>\n<p>Suppose we want to create a class whose instances represent temporary\ndirectories.  The directories should be deleted with their contents\nwhen the first of the following events occurs:</p>\n<ul class=\"simple\">\n<li><p>the object is garbage collected,</p></li>\n<li><p>the object’s <code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">remove()</span></code> method is called, or</p></li>\n<li><p>the program exits.</p></li>\n</ul>\n<p>We might try to implement the class using a <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> method as\nfollows:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">TempDir</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">tempfile</span><span class=\"o\">.</span><span class=\"n\">mkdtemp</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">remove</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">shutil</span><span class=\"o\">.</span><span class=\"n\">rmtree</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">removed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__del__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Starting with Python 3.4, <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> methods no longer prevent\nreference cycles from being garbage collected, and module globals are\nno longer forced to <a class=\"reference internal\" href=\"constants.html#None\" title=\"None\"><code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code></a> during <a class=\"reference internal\" href=\"../glossary.html#term-interpreter-shutdown\"><span class=\"xref std std-term\">interpreter shutdown</span></a>.\nSo this code should work without any issues on CPython.</p>\n<p>However, handling of <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__del__\" title=\"object.__del__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code></a> methods is notoriously implementation\nspecific, since it depends on internal details of the interpreter’s garbage\ncollector implementation.</p>\n<p>A more robust alternative can be to define a finalizer which only references\nthe specific functions and objects that it needs, rather than having access\nto the full state of the object:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">TempDir</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">tempfile</span><span class=\"o\">.</span><span class=\"n\">mkdtemp</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finalizer</span> <span class=\"o\">=</span> <span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">shutil</span><span class=\"o\">.</span><span class=\"n\">rmtree</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">remove</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finalizer</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">removed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finalizer</span><span class=\"o\">.</span><span class=\"n\">alive</span>\n</pre></div>\n</div>\n<p>Defined like this, our finalizer only receives a reference to the details\nit needs to clean up the directory appropriately. If the object never gets\ngarbage collected the finalizer will still be called at exit.</p>\n<p>The other advantage of weakref based finalizers is that they can be used to\nregister finalizers for classes where the definition is controlled by a\nthird party, such as running code when a module is unloaded:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">weakref</span><span class=\"o\">,</span><span class=\"w\"> </span><span class=\"nn\">sys</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">unloading_module</span><span class=\"p\">():</span>\n    <span class=\"c1\"># implicit reference to the module globals from the function body</span>\n<span class=\"n\">weakref</span><span class=\"o\">.</span><span class=\"n\">finalize</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">modules</span><span class=\"p\">[</span><span class=\"vm\">__name__</span><span class=\"p\">],</span> <span class=\"n\">unloading_module</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>If you create a finalizer object in a daemonic thread just as the program\nexits then there is the possibility that the finalizer\ndoes not get called at exit.  However, in a daemonic thread\n<a class=\"reference internal\" href=\"atexit.html#atexit.register\" title=\"atexit.register\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">atexit.register()</span></code></a>, <code class=\"docutils literal notranslate\"><span class=\"pre\">try:</span> <span class=\"pre\">...</span> <span class=\"pre\">finally:</span> <span class=\"pre\">...</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">with:</span> <span class=\"pre\">...</span></code>\ndo not guarantee that cleanup occurs either.</p>\n</div>\n</section>\n</section>\n\n\n            <div class=\"clearer\"></div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sphinxsidebar\" role=\"navigation\" aria-label=\"Main\">\n        <div class=\"sphinxsidebarwrapper\">\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code> — Weak references</a><ul>\n<li><a class=\"reference internal\" href=\"#weak-reference-objects\">Weak Reference Objects</a></li>\n<li><a class=\"reference internal\" href=\"#example\">Example</a></li>\n<li><a class=\"reference internal\" href=\"#finalizer-objects\">Finalizer Objects</a></li>\n<li><a class=\"reference internal\" href=\"#comparing-finalizers-with-del-methods\">Comparing finalizers with <code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__del__()</span></code> methods</a></li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"array.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">array</span></code> — Efficient arrays of numeric values</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"types.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">types</span></code> — Dynamic type creation and names for built-in types</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/weakref.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </div>\n<div id=\"sidebarbutton\" title=\"Collapse sidebar\">\n<span>«</span>\n</div>\n\n      </div>\n      <div class=\"clearer\"></div>\n    </div>  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             >index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"types.html\" title=\"types — Dynamic type creation and names for built-in types\"\n             >next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"array.html\" title=\"array — Efficient arrays of numeric values\"\n             >previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"datatypes.html\" >Data Types</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">weakref</span></code> — Weak references</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>  \n    <div class=\"footer\">\n    &copy; <a href=\"../copyright.html\">Copyright</a> 2001 Python Software Foundation.\n    <br>\n    This page is licensed under the Python Software Foundation License Version 2.\n    <br>\n    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.\n    <br>\n    \n      See <a href=\"/license.html\">History and License</a> for more information.<br>\n    \n    \n    <br>\n\n    The Python Software Foundation is a non-profit corporation.\n<a href=\"https://www.python.org/psf/donations/\">Please donate.</a>\n<br>\n    <br>\n      Last updated on Nov 25, 2025 (18:01 UTC).\n    \n      <a href=\"/bugs.html\">Found a bug</a>?\n    \n    <br>\n\n    Created using <a href=\"https://www.sphinx-doc.org/\">Sphinx</a> 8.2.3.\n    </div>\n\n    <script type=\"text/javascript\" src=\"../_static/switchers.js\"></script>\n  </body>\n</html>",
  "metadata": {
    "title": "weakref — Weak references — Python 3.14.0 documentation",
    "meta_description": "Source code: Lib/weakref.py The weakref module allows the Python programmer to create weak references to objects. In the following, the term referent means the object which is referred to by a weak...",
    "h1": "— Weak references"
  },
  "request_headers": {
    "Referer": "https://docs.python.org/3/library/",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en",
    "User-Agent": "DumbCrawler/1.0",
    "Accept-Encoding": "gzip, deflate"
  },
  "response_headers": {
    "Content-Length": "13679",
    "Server": "nginx",
    "Content-Type": "text/html",
    "Last-Modified": "Tue, 25 Nov 2025 18:03:26 GMT",
    "Etag": "\"6925ef6e-13900\"",
    "X-Clacks-Overhead": "GNU Terry Pratchett",
    "Strict-Transport-Security": "max-age=315360000; includeSubDomains; preload",
    "Via": "1.1 varnish, 1.1 varnish",
    "Accept-Ranges": "bytes",
    "Age": "3544",
    "Date": "Wed, 26 Nov 2025 05:25:23 GMT",
    "X-Served-By": "cache-lga21925-LGA, cache-yul1970045-YUL",
    "X-Cache": "HIT, HIT",
    "X-Cache-Hits": "244, 0",
    "X-Timer": "S1764134724.524908,VS0,VE1",
    "Vary": "Accept-Encoding"
  },
  "crawled_at": "2025-11-26T05:25:24.116730+00:00",
  "crawler": {
    "name": "DumbCrawler",
    "version": "1.0",
    "mode": "crawl",
    "js_mode": "off",
    "scope": "subdomain"
  }
}