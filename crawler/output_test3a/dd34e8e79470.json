{
  "url": "https://docs.python.org/3/library/contextlib.html",
  "status_code": 200,
  "depth": 1,
  "referrer": "https://docs.python.org/3/library/",
  "raw_html": "<!DOCTYPE html>\n\n<html lang=\"en\" data-content_root=\"../\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<meta property=\"og:title\" content=\"contextlib — Utilities for with-statement contexts\" />\n<meta property=\"og:type\" content=\"website\" />\n<meta property=\"og:url\" content=\"https://docs.python.org/3/library/contextlib.html\" />\n<meta property=\"og:site_name\" content=\"Python documentation\" />\n<meta property=\"og:description\" content=\"Source code: Lib/contextlib.py This module provides utilities for common tasks involving the with statement. For more information see also Context Manager Types and With Statement Context Managers....\" />\n<meta property=\"og:image:width\" content=\"1146\" />\n<meta property=\"og:image:height\" content=\"600\" />\n<meta property=\"og:image\" content=\"https://docs.python.org/3.14/_images/social_previews/summary_library_contextlib_237a2b5d.png\" />\n<meta property=\"og:image:alt\" content=\"Source code: Lib/contextlib.py This module provides utilities for common tasks involving the with statement. For more information see also Context Manager Types and With Statement Context Managers....\" />\n<meta name=\"description\" content=\"Source code: Lib/contextlib.py This module provides utilities for common tasks involving the with statement. For more information see also Context Manager Types and With Statement Context Managers....\" />\n<meta name=\"twitter:card\" content=\"summary_large_image\" />\n<meta name=\"theme-color\" content=\"#3776ab\">\n\n    <title>contextlib — Utilities for with-statement contexts &#8212; Python 3.14.0 documentation</title><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments.css?v=b86133f3\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/classic.css?v=234b1a7c\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pydoctheme.css?v=8cd84f99\" />\n    <link id=\"pygments_dark_css\" media=\"(prefers-color-scheme: dark)\" rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments_dark.css?v=5349f25f\" />\n    \n    <script src=\"../_static/documentation_options.js?v=e4f4b189\"></script>\n    <script src=\"../_static/doctools.js?v=9bcbadda\"></script>\n    <script src=\"../_static/sphinx_highlight.js?v=dc90522c\"></script>\n    \n    <script src=\"../_static/sidebar.js\"></script>\n    \n    <link rel=\"search\" type=\"application/opensearchdescription+xml\"\n          title=\"Search within Python 3.14.0 documentation\"\n          href=\"../_static/opensearch.xml\"/>\n    <link rel=\"author\" title=\"About these documents\" href=\"../about.html\" />\n    <link rel=\"index\" title=\"Index\" href=\"../genindex.html\" />\n    <link rel=\"search\" title=\"Search\" href=\"../search.html\" />\n    <link rel=\"copyright\" title=\"Copyright\" href=\"../copyright.html\" />\n    <link rel=\"next\" title=\"abc — Abstract Base Classes\" href=\"abc.html\" />\n    <link rel=\"prev\" title=\"dataclasses — Data Classes\" href=\"dataclasses.html\" />\n    \n      \n      <script defer file-types=\"bz2,epub,zip\" data-domain=\"docs.python.org\" src=\"https://analytics.python.org/js/script.file-downloads.outbound-links.js\"></script>\n      \n      <link rel=\"canonical\" href=\"https://docs.python.org/3/library/contextlib.html\">\n      \n    \n\n    \n    <style>\n      @media only screen {\n        table.full-width-table {\n            width: 100%;\n        }\n      }\n    </style>\n<link rel=\"stylesheet\" href=\"../_static/pydoctheme_dark.css\" media=\"(prefers-color-scheme: dark)\" id=\"pydoctheme_dark_css\">\n    <link rel=\"shortcut icon\" type=\"image/png\" href=\"../_static/py.svg\">\n            <script type=\"text/javascript\" src=\"../_static/copybutton.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/menu.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/search-focus.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/themetoggle.js\"></script> \n            <script type=\"text/javascript\" src=\"../_static/rtd_switcher.js\"></script>\n            <meta name=\"readthedocs-addons-api-version\" content=\"1\">\n\n  </head>\n<body>\n<div class=\"mobile-nav\">\n    <input type=\"checkbox\" id=\"menuToggler\" class=\"toggler__input\" aria-controls=\"navigation\"\n           aria-pressed=\"false\" aria-expanded=\"false\" role=\"button\" aria-label=\"Menu\">\n    <nav class=\"nav-content\" role=\"navigation\">\n        <label for=\"menuToggler\" class=\"toggler__label\">\n            <span></span>\n        </label>\n        <span class=\"nav-items-wrapper\">\n            <a href=\"https://www.python.org/\" class=\"nav-logo\">\n                <img src=\"../_static/py.svg\" alt=\"Python logo\">\n            </a>\n            <span class=\"version_switcher_placeholder\"></span>\n            <form role=\"search\" class=\"search\" action=\"../search.html\" method=\"get\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" class=\"search-icon\">\n                    <path fill-rule=\"nonzero\" fill=\"currentColor\" d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"></path>\n                </svg>\n                <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\">\n                <input type=\"submit\" value=\"Go\">\n            </form>\n        </span>\n    </nav>\n    <div class=\"menu-wrapper\">\n        <nav class=\"menu\" role=\"navigation\" aria-label=\"main navigation\">\n            <div class=\"language_switcher_placeholder\"></div>\n            \n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label>\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code> — Utilities for <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code>-statement contexts</a><ul>\n<li><a class=\"reference internal\" href=\"#utilities\">Utilities</a></li>\n<li><a class=\"reference internal\" href=\"#examples-and-recipes\">Examples and Recipes</a><ul>\n<li><a class=\"reference internal\" href=\"#supporting-a-variable-number-of-context-managers\">Supporting a variable number of context managers</a></li>\n<li><a class=\"reference internal\" href=\"#catching-exceptions-from-enter-methods\">Catching exceptions from <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> methods</a></li>\n<li><a class=\"reference internal\" href=\"#cleaning-up-in-an-enter-implementation\">Cleaning up in an <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> implementation</a></li>\n<li><a class=\"reference internal\" href=\"#replacing-any-use-of-try-finally-and-flag-variables\">Replacing any use of <code class=\"docutils literal notranslate\"><span class=\"pre\">try-finally</span></code> and flag variables</a></li>\n<li><a class=\"reference internal\" href=\"#using-a-context-manager-as-a-function-decorator\">Using a context manager as a function decorator</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#single-use-reusable-and-reentrant-context-managers\">Single use, reusable and reentrant context managers</a><ul>\n<li><a class=\"reference internal\" href=\"#reentrant-context-managers\">Reentrant context managers</a></li>\n<li><a class=\"reference internal\" href=\"#reusable-context-managers\">Reusable context managers</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"dataclasses.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">dataclasses</span></code> — Data Classes</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"abc.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">abc</span></code> — Abstract Base Classes</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/contextlib.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </nav>\n    </div>\n</div>\n\n  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             accesskey=\"I\">index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"abc.html\" title=\"abc — Abstract Base Classes\"\n             accesskey=\"N\">next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"dataclasses.html\" title=\"dataclasses — Data Classes\"\n             accesskey=\"P\">previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"python.html\" accesskey=\"U\">Python Runtime Services</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code> — Utilities for <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code>-statement contexts</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>    \n\n    <div class=\"document\">\n      <div class=\"documentwrapper\">\n        <div class=\"bodywrapper\">\n          <div class=\"body\" role=\"main\">\n            \n  <section id=\"module-contextlib\">\n<span id=\"contextlib-utilities-for-with-statement-contexts\"></span><h1><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code> — Utilities for <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code>-statement contexts<a class=\"headerlink\" href=\"#module-contextlib\" title=\"Link to this heading\">¶</a></h1>\n<p><strong>Source code:</strong> <a class=\"extlink-source reference external\" href=\"https://github.com/python/cpython/tree/3.14/Lib/contextlib.py\">Lib/contextlib.py</a></p>\n<hr class=\"docutils\" />\n<p>This module provides utilities for common tasks involving the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatement. For more information see also <a class=\"reference internal\" href=\"stdtypes.html#typecontextmanager\"><span class=\"std std-ref\">Context Manager Types</span></a> and\n<a class=\"reference internal\" href=\"../reference/datamodel.html#context-managers\"><span class=\"std std-ref\">With Statement Context Managers</span></a>.</p>\n<section id=\"utilities\">\n<h2>Utilities<a class=\"headerlink\" href=\"#utilities\" title=\"Link to this heading\">¶</a></h2>\n<p>Functions and classes provided:</p>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AbstractContextManager\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">AbstractContextManager</span></span><a class=\"headerlink\" href=\"#contextlib.AbstractContextManager\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>An <a class=\"reference internal\" href=\"../glossary.html#term-abstract-base-class\"><span class=\"xref std std-term\">abstract base class</span></a> for classes that implement\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__enter__()</span></code></a> and <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__exit__()</span></code></a>. A default\nimplementation for <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__enter__()</span></code></a> is provided which returns\n<code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code> while <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__exit__()</span></code></a> is an abstract method which by default\nreturns <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>. See also the definition of <a class=\"reference internal\" href=\"stdtypes.html#typecontextmanager\"><span class=\"std std-ref\">Context Manager Types</span></a>.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.6.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AbstractAsyncContextManager\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">AbstractAsyncContextManager</span></span><a class=\"headerlink\" href=\"#contextlib.AbstractAsyncContextManager\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>An <a class=\"reference internal\" href=\"../glossary.html#term-abstract-base-class\"><span class=\"xref std std-term\">abstract base class</span></a> for classes that implement\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aenter__\" title=\"object.__aenter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__aenter__()</span></code></a> and <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aexit__\" title=\"object.__aexit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__aexit__()</span></code></a>. A default\nimplementation for <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aenter__\" title=\"object.__aenter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__aenter__()</span></code></a> is provided which returns\n<code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code> while <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aexit__\" title=\"object.__aexit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">object.__aexit__()</span></code></a> is an abstract method which by default\nreturns <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>. See also the definition of\n<a class=\"reference internal\" href=\"../reference/datamodel.html#async-context-managers\"><span class=\"std std-ref\">Asynchronous Context Managers</span></a>.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.7.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.contextmanager\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">&#64;</span></span><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">contextmanager</span></span><a class=\"headerlink\" href=\"#contextlib.contextmanager\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>This function is a <a class=\"reference internal\" href=\"../glossary.html#term-decorator\"><span class=\"xref std std-term\">decorator</span></a> that can be used to define a factory\nfunction for <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement context managers, without needing to\ncreate a class or separate <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a> and <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> methods.</p>\n<p>While many objects natively support use in with statements, sometimes a\nresource needs to be managed that isn’t a context manager in its own right,\nand doesn’t implement a <code class=\"docutils literal notranslate\"><span class=\"pre\">close()</span></code> method for use with <code class=\"docutils literal notranslate\"><span class=\"pre\">contextlib.closing</span></code>.</p>\n<p>An abstract example would be the following to ensure correct resource\nmanagement:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n\n<span class=\"nd\">@contextmanager</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">managed_resource</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Code to acquire resource, e.g.:</span>\n    <span class=\"n\">resource</span> <span class=\"o\">=</span> <span class=\"n\">acquire_resource</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span> <span class=\"n\">resource</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Code to release resource, e.g.:</span>\n        <span class=\"n\">release_resource</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>The function can then be used like this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">managed_resource</span><span class=\"p\">(</span><span class=\"n\">timeout</span><span class=\"o\">=</span><span class=\"mi\">3600</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">resource</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"c1\"># Resource is released at the end of this block,</span>\n<span class=\"gp\">... </span>    <span class=\"c1\"># even if code in the block raises an exception</span>\n</pre></div>\n</div>\n<p>The function being decorated must return a <a class=\"reference internal\" href=\"../glossary.html#term-generator\"><span class=\"xref std std-term\">generator</span></a>-iterator when\ncalled. This iterator must yield exactly one value, which will be bound to\nthe targets in the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement’s <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">as</span></code> clause, if any.</p>\n<p>At the point where the generator yields, the block nested in the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatement is executed.  The generator is then resumed after the block is exited.\nIf an unhandled exception occurs in the block, it is reraised inside the\ngenerator at the point where the yield occurred.  Thus, you can use a\n<a class=\"reference internal\" href=\"../reference/compound_stmts.html#try\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">try</span></code></a>…<a class=\"reference internal\" href=\"../reference/compound_stmts.html#except\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">except</span></code></a>…<a class=\"reference internal\" href=\"../reference/compound_stmts.html#finally\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">finally</span></code></a> statement to trap\nthe error (if any), or ensure that some cleanup takes place. If an exception is\ntrapped merely in order to log it or to perform some action (rather than to\nsuppress it entirely), the generator must reraise that exception. Otherwise the\ngenerator context manager will indicate to the <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement that\nthe exception has been handled, and execution will resume with the statement\nimmediately following the <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement.</p>\n<p><a class=\"reference internal\" href=\"#contextlib.contextmanager\" title=\"contextlib.contextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">contextmanager()</span></code></a> uses <a class=\"reference internal\" href=\"#contextlib.ContextDecorator\" title=\"contextlib.ContextDecorator\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code></a> so the context managers\nit creates can be used as decorators as well as in <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statements.\nWhen used as a decorator, a new generator instance is implicitly created on\neach function call (this allows the otherwise “one-shot” context managers\ncreated by <a class=\"reference internal\" href=\"#contextlib.contextmanager\" title=\"contextlib.contextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">contextmanager()</span></code></a> to meet the requirement that context\nmanagers support multiple invocations in order to be used as decorators).</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.2: </span>Use of <a class=\"reference internal\" href=\"#contextlib.ContextDecorator\" title=\"contextlib.ContextDecorator\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code></a>.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.asynccontextmanager\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">&#64;</span></span><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">asynccontextmanager</span></span><a class=\"headerlink\" href=\"#contextlib.asynccontextmanager\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.contextmanager\" title=\"contextlib.contextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">contextmanager()</span></code></a>, but creates an\n<a class=\"reference internal\" href=\"../reference/datamodel.html#async-context-managers\"><span class=\"std std-ref\">asynchronous context manager</span></a>.</p>\n<p>This function is a <a class=\"reference internal\" href=\"../glossary.html#term-decorator\"><span class=\"xref std std-term\">decorator</span></a> that can be used to define a factory\nfunction for <a class=\"reference internal\" href=\"../reference/compound_stmts.html#async-with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">async</span> <span class=\"pre\">with</span></code></a> statement asynchronous context managers,\nwithout needing to create a class or separate <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aenter__\" title=\"object.__aenter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__aenter__()</span></code></a> and\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__aexit__\" title=\"object.__aexit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__aexit__()</span></code></a> methods. It must be applied to an <a class=\"reference internal\" href=\"../glossary.html#term-asynchronous-generator\"><span class=\"xref std std-term\">asynchronous\ngenerator</span></a> function.</p>\n<p>A simple example:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">asynccontextmanager</span>\n\n<span class=\"nd\">@asynccontextmanager</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">get_connection</span><span class=\"p\">():</span>\n    <span class=\"n\">conn</span> <span class=\"o\">=</span> <span class=\"k\">await</span> <span class=\"n\">acquire_db_connection</span><span class=\"p\">()</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span> <span class=\"n\">conn</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"k\">await</span> <span class=\"n\">release_db_connection</span><span class=\"p\">(</span><span class=\"n\">conn</span><span class=\"p\">)</span>\n\n<span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">get_all_users</span><span class=\"p\">():</span>\n    <span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">get_connection</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">conn</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">conn</span><span class=\"o\">.</span><span class=\"n\">query</span><span class=\"p\">(</span><span class=\"s1\">&#39;SELECT ...&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.7.</span></p>\n</div>\n<p>Context managers defined with <a class=\"reference internal\" href=\"#contextlib.asynccontextmanager\" title=\"contextlib.asynccontextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">asynccontextmanager()</span></code></a> can be used\neither as decorators or with <a class=\"reference internal\" href=\"../reference/compound_stmts.html#async-with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">async</span> <span class=\"pre\">with</span></code></a> statements:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">time</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">asynccontextmanager</span>\n\n<span class=\"nd\">@asynccontextmanager</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">timeit</span><span class=\"p\">():</span>\n    <span class=\"n\">now</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">monotonic</span><span class=\"p\">()</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;it took </span><span class=\"si\">{</span><span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">monotonic</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">now</span><span class=\"si\">}</span><span class=\"s1\">s to run&#39;</span><span class=\"p\">)</span>\n\n<span class=\"nd\">@timeit</span><span class=\"p\">()</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">():</span>\n    <span class=\"c1\"># ... async code ...</span>\n</pre></div>\n</div>\n<p>When used as a decorator, a new generator instance is implicitly created on\neach function call. This allows the otherwise “one-shot” context managers\ncreated by <a class=\"reference internal\" href=\"#contextlib.asynccontextmanager\" title=\"contextlib.asynccontextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">asynccontextmanager()</span></code></a> to meet the requirement that context\nmanagers support multiple invocations in order to be used as decorators.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.10: </span>Async context managers created with <a class=\"reference internal\" href=\"#contextlib.asynccontextmanager\" title=\"contextlib.asynccontextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">asynccontextmanager()</span></code></a> can\nbe used as decorators.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.closing\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">closing</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">thing</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.closing\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a context manager that closes <em>thing</em> upon completion of the block.  This\nis basically equivalent to:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n\n<span class=\"nd\">@contextmanager</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">closing</span><span class=\"p\">(</span><span class=\"n\">thing</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span> <span class=\"n\">thing</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"n\">thing</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>And lets you write code like this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">closing</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">urllib.request</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">urlopen</span>\n\n<span class=\"k\">with</span> <span class=\"n\">closing</span><span class=\"p\">(</span><span class=\"n\">urlopen</span><span class=\"p\">(</span><span class=\"s1\">&#39;https://www.python.org&#39;</span><span class=\"p\">))</span> <span class=\"k\">as</span> <span class=\"n\">page</span><span class=\"p\">:</span>\n    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">page</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>without needing to explicitly close <code class=\"docutils literal notranslate\"><span class=\"pre\">page</span></code>.  Even if an error occurs,\n<code class=\"docutils literal notranslate\"><span class=\"pre\">page.close()</span></code> will be called when the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> block is exited.</p>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Most types managing resources support the <a class=\"reference internal\" href=\"../glossary.html#term-context-manager\"><span class=\"xref std std-term\">context manager</span></a> protocol,\nwhich closes <em>thing</em> on leaving the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement.\nAs such, <code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">closing()</span></code> is most useful for third party types that don’t\nsupport context managers.\nThis example is purely for illustration purposes,\nas <a class=\"reference internal\" href=\"urllib.request.html#urllib.request.urlopen\" title=\"urllib.request.urlopen\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">urlopen()</span></code></a> would normally be used in a context manager.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.aclosing\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">aclosing</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">thing</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.aclosing\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return an async context manager that calls the <code class=\"docutils literal notranslate\"><span class=\"pre\">aclose()</span></code> method of <em>thing</em>\nupon completion of the block.  This is basically equivalent to:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">asynccontextmanager</span>\n\n<span class=\"nd\">@asynccontextmanager</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">aclosing</span><span class=\"p\">(</span><span class=\"n\">thing</span><span class=\"p\">):</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">yield</span> <span class=\"n\">thing</span>\n    <span class=\"k\">finally</span><span class=\"p\">:</span>\n        <span class=\"k\">await</span> <span class=\"n\">thing</span><span class=\"o\">.</span><span class=\"n\">aclose</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Significantly, <code class=\"docutils literal notranslate\"><span class=\"pre\">aclosing()</span></code> supports deterministic cleanup of async\ngenerators when they happen to exit early by <a class=\"reference internal\" href=\"../reference/simple_stmts.html#break\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">break</span></code></a> or an\nexception.  For example:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">aclosing</span>\n\n<span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">aclosing</span><span class=\"p\">(</span><span class=\"n\">my_generator</span><span class=\"p\">())</span> <span class=\"k\">as</span> <span class=\"n\">values</span><span class=\"p\">:</span>\n    <span class=\"k\">async</span> <span class=\"k\">for</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">values</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"o\">==</span> <span class=\"mi\">42</span><span class=\"p\">:</span>\n            <span class=\"k\">break</span>\n</pre></div>\n</div>\n<p>This pattern ensures that the generator’s async exit code is executed in\nthe same context as its iterations (so that exceptions and context\nvariables work as expected, and the exit code isn’t run after the\nlifetime of some task it depends on).</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.10.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\" id=\"simplifying-support-for-single-optional-context-managers\">\n<dt class=\"sig sig-object py\" id=\"contextlib.nullcontext\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">nullcontext</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">enter_result</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.nullcontext\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a context manager that returns <em>enter_result</em> from <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code>, but\notherwise does nothing. It is intended to be used as a stand-in for an\noptional context manager, for example:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">myfunction</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"p\">,</span> <span class=\"n\">ignore_exceptions</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">ignore_exceptions</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Use suppress to ignore all exceptions.</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">contextlib</span><span class=\"o\">.</span><span class=\"n\">suppress</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Do not ignore any exceptions, cm has no effect.</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">contextlib</span><span class=\"o\">.</span><span class=\"n\">nullcontext</span><span class=\"p\">()</span>\n    <span class=\"k\">with</span> <span class=\"n\">cm</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Do something</span>\n</pre></div>\n</div>\n<p>An example using <em>enter_result</em>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">process_file</span><span class=\"p\">(</span><span class=\"n\">file_or_path</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">file_or_path</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"c1\"># If string, open file</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">file_or_path</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Caller is responsible for closing file</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">nullcontext</span><span class=\"p\">(</span><span class=\"n\">file_or_path</span><span class=\"p\">)</span>\n\n    <span class=\"k\">with</span> <span class=\"n\">cm</span> <span class=\"k\">as</span> <span class=\"n\">file</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Perform processing on the file</span>\n</pre></div>\n</div>\n<p>It can also be used as a stand-in for\n<a class=\"reference internal\" href=\"../reference/datamodel.html#async-context-managers\"><span class=\"std std-ref\">asynchronous context managers</span></a>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">send_http</span><span class=\"p\">(</span><span class=\"n\">session</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">session</span><span class=\"p\">:</span>\n        <span class=\"c1\"># If no http session, create it with aiohttp</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">aiohttp</span><span class=\"o\">.</span><span class=\"n\">ClientSession</span><span class=\"p\">()</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Caller is responsible for closing the session</span>\n        <span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">nullcontext</span><span class=\"p\">(</span><span class=\"n\">session</span><span class=\"p\">)</span>\n\n    <span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">cm</span> <span class=\"k\">as</span> <span class=\"n\">session</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Send http requests with session</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.7.</span></p>\n</div>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.10: </span><a class=\"reference internal\" href=\"../glossary.html#term-asynchronous-context-manager\"><span class=\"xref std std-term\">asynchronous context manager</span></a> support was added.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.suppress\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">suppress</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">exceptions</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.suppress\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Return a context manager that suppresses any of the specified exceptions\nif they occur in the body of a <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement and then\nresumes execution with the first statement following the end of the\n<code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement.</p>\n<p>As with any other mechanism that completely suppresses exceptions, this\ncontext manager should be used only to cover very specific errors where\nsilently continuing with program execution is known to be the right\nthing to do.</p>\n<p>For example:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">suppress</span>\n\n<span class=\"k\">with</span> <span class=\"n\">suppress</span><span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">):</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"s1\">&#39;somefile.tmp&#39;</span><span class=\"p\">)</span>\n\n<span class=\"k\">with</span> <span class=\"n\">suppress</span><span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">):</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"s1\">&#39;someotherfile.tmp&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This code is equivalent to:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"s1\">&#39;somefile.tmp&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">except</span> <span class=\"ne\">FileNotFoundError</span><span class=\"p\">:</span>\n    <span class=\"k\">pass</span>\n\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"s1\">&#39;someotherfile.tmp&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">except</span> <span class=\"ne\">FileNotFoundError</span><span class=\"p\">:</span>\n    <span class=\"k\">pass</span>\n</pre></div>\n</div>\n<p>This context manager is <a class=\"reference internal\" href=\"#reentrant-cms\"><span class=\"std std-ref\">reentrant</span></a>.</p>\n<p>If the code within the <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> block raises a\n<a class=\"reference internal\" href=\"exceptions.html#BaseExceptionGroup\" title=\"BaseExceptionGroup\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">BaseExceptionGroup</span></code></a>, suppressed exceptions are removed from the\ngroup.  Any exceptions of the group which are not suppressed are re-raised in\na new group which is created using the original group’s <a class=\"reference internal\" href=\"exceptions.html#BaseExceptionGroup.derive\" title=\"BaseExceptionGroup.derive\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">derive()</span></code></a>\nmethod.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.4.</span></p>\n</div>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.12: </span><code class=\"docutils literal notranslate\"><span class=\"pre\">suppress</span></code> now supports suppressing exceptions raised as\npart of a <a class=\"reference internal\" href=\"exceptions.html#BaseExceptionGroup\" title=\"BaseExceptionGroup\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">BaseExceptionGroup</span></code></a>.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.redirect_stdout\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">redirect_stdout</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">new_target</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.redirect_stdout\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Context manager for temporarily redirecting <a class=\"reference internal\" href=\"sys.html#sys.stdout\" title=\"sys.stdout\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.stdout</span></code></a> to\nanother file or file-like object.</p>\n<p>This tool adds flexibility to existing functions or classes whose output\nis hardwired to stdout.</p>\n<p>For example, the output of <a class=\"reference internal\" href=\"functions.html#help\" title=\"help\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">help()</span></code></a> normally is sent to <em>sys.stdout</em>.\nYou can capture that output in a string by redirecting the output to an\n<a class=\"reference internal\" href=\"io.html#io.StringIO\" title=\"io.StringIO\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">io.StringIO</span></code></a> object. The replacement stream is returned from the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> method and so is available as the target of the\n<a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">redirect_stdout</span><span class=\"p\">(</span><span class=\"n\">io</span><span class=\"o\">.</span><span class=\"n\">StringIO</span><span class=\"p\">())</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"n\">help</span><span class=\"p\">(</span><span class=\"nb\">pow</span><span class=\"p\">)</span>\n<span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">getvalue</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>To send the output of <a class=\"reference internal\" href=\"functions.html#help\" title=\"help\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">help()</span></code></a> to a file on disk, redirect the output\nto a regular file:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s1\">&#39;help.txt&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n    <span class=\"k\">with</span> <span class=\"n\">redirect_stdout</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">):</span>\n        <span class=\"n\">help</span><span class=\"p\">(</span><span class=\"nb\">pow</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>To send the output of <a class=\"reference internal\" href=\"functions.html#help\" title=\"help\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">help()</span></code></a> to <em>sys.stderr</em>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">redirect_stdout</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stderr</span><span class=\"p\">):</span>\n    <span class=\"n\">help</span><span class=\"p\">(</span><span class=\"nb\">pow</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Note that the global side effect on <a class=\"reference internal\" href=\"sys.html#sys.stdout\" title=\"sys.stdout\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.stdout</span></code></a> means that this\ncontext manager is not suitable for use in library code and most threaded\napplications. It also has no effect on the output of subprocesses.\nHowever, it is still a useful approach for many utility scripts.</p>\n<p>This context manager is <a class=\"reference internal\" href=\"#reentrant-cms\"><span class=\"std std-ref\">reentrant</span></a>.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.4.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.redirect_stderr\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">redirect_stderr</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">new_target</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.redirect_stderr\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.redirect_stdout\" title=\"contextlib.redirect_stdout\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">redirect_stdout()</span></code></a> but redirecting\n<a class=\"reference internal\" href=\"sys.html#sys.stderr\" title=\"sys.stderr\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.stderr</span></code></a> to another file or file-like object.</p>\n<p>This context manager is <a class=\"reference internal\" href=\"#reentrant-cms\"><span class=\"std std-ref\">reentrant</span></a>.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.5.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"contextlib.chdir\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">chdir</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">path</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.chdir\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Non parallel-safe context manager to change the current working directory.\nAs this changes a global state, the working directory, it is not suitable\nfor use in most threaded or async contexts. It is also not suitable for most\nnon-linear code execution, like generators, where the program execution is\ntemporarily relinquished – unless explicitly desired, you should not yield\nwhen this context manager is active.</p>\n<p>This is a simple wrapper around <a class=\"reference internal\" href=\"os.html#os.chdir\" title=\"os.chdir\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">chdir()</span></code></a>, it changes the current\nworking directory upon entering and restores the old one on exit.</p>\n<p>This context manager is <a class=\"reference internal\" href=\"#reentrant-cms\"><span class=\"std std-ref\">reentrant</span></a>.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.11.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ContextDecorator\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ContextDecorator</span></span><a class=\"headerlink\" href=\"#contextlib.ContextDecorator\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A base class that enables a context manager to also be used as a decorator.</p>\n<p>Context managers inheriting from <code class=\"docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code> have to implement\n<code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">__exit__</span></code> as normal. <code class=\"docutils literal notranslate\"><span class=\"pre\">__exit__</span></code> retains its optional\nexception handling even when used as a decorator.</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code> is used by <a class=\"reference internal\" href=\"#contextlib.contextmanager\" title=\"contextlib.contextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">contextmanager()</span></code></a>, so you get this\nfunctionality automatically.</p>\n<p>Example of <code class=\"docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ContextDecorator</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">mycontext</span><span class=\"p\">(</span><span class=\"n\">ContextDecorator</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__enter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Starting&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__exit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">exc</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Finishing&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n</pre></div>\n</div>\n<p>The class can then be used like this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@mycontext</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">function</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;The bit in the middle&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">function</span><span class=\"p\">()</span>\n<span class=\"go\">Starting</span>\n<span class=\"go\">The bit in the middle</span>\n<span class=\"go\">Finishing</span>\n\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">mycontext</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;The bit in the middle&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Starting</span>\n<span class=\"go\">The bit in the middle</span>\n<span class=\"go\">Finishing</span>\n</pre></div>\n</div>\n<p>This change is just syntactic sugar for any construct of the following form:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">f</span><span class=\"p\">():</span>\n    <span class=\"k\">with</span> <span class=\"n\">cm</span><span class=\"p\">():</span>\n        <span class=\"c1\"># Do stuff</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code> lets you instead write:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nd\">@cm</span><span class=\"p\">()</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">f</span><span class=\"p\">():</span>\n    <span class=\"c1\"># Do stuff</span>\n</pre></div>\n</div>\n<p>It makes it clear that the <code class=\"docutils literal notranslate\"><span class=\"pre\">cm</span></code> applies to the whole function, rather than\njust a piece of it (and saving an indentation level is nice, too).</p>\n<p>Existing context managers that already have a base class can be extended by\nusing <code class=\"docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code> as a mixin class:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ContextDecorator</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">mycontext</span><span class=\"p\">(</span><span class=\"n\">ContextBaseClass</span><span class=\"p\">,</span> <span class=\"n\">ContextDecorator</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__enter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__exit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">exc</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n</pre></div>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>As the decorated function must be able to be called multiple times, the\nunderlying context manager must support use in multiple <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatements. If this is not the case, then the original construct with the\nexplicit <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement inside the function should be used.</p>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.2.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncContextDecorator\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">AsyncContextDecorator</span></span><a class=\"headerlink\" href=\"#contextlib.AsyncContextDecorator\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.ContextDecorator\" title=\"contextlib.ContextDecorator\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code></a> but only for asynchronous functions.</p>\n<p>Example of <code class=\"docutils literal notranslate\"><span class=\"pre\">AsyncContextDecorator</span></code>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">asyncio</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">run</span>\n<span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">AsyncContextDecorator</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">mycontext</span><span class=\"p\">(</span><span class=\"n\">AsyncContextDecorator</span><span class=\"p\">):</span>\n    <span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__aenter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Starting&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span>\n\n    <span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__aexit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">exc</span><span class=\"p\">):</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Finishing&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n</pre></div>\n</div>\n<p>The class can then be used like this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@mycontext</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">function</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;The bit in the middle&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">function</span><span class=\"p\">())</span>\n<span class=\"go\">Starting</span>\n<span class=\"go\">The bit in the middle</span>\n<span class=\"go\">Finishing</span>\n\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">function</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>   <span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">mycontext</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;The bit in the middle&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">function</span><span class=\"p\">())</span>\n<span class=\"go\">Starting</span>\n<span class=\"go\">The bit in the middle</span>\n<span class=\"go\">Finishing</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.10.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ExitStack</span></span><a class=\"headerlink\" href=\"#contextlib.ExitStack\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A context manager that is designed to make it easy to programmatically\ncombine other context managers and cleanup functions, especially those\nthat are optional or otherwise driven by input data.</p>\n<p>For example, a set of files may easily be handled in a single with\nstatement as follows:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"n\">files</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">enter_context</span><span class=\"p\">(</span><span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">fname</span><span class=\"p\">))</span> <span class=\"k\">for</span> <span class=\"n\">fname</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">]</span>\n    <span class=\"c1\"># All opened files will automatically be closed at the end of</span>\n    <span class=\"c1\"># the with statement, even if attempts to open files later</span>\n    <span class=\"c1\"># in the list raise an exception</span>\n</pre></div>\n</div>\n<p>The <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a> method returns the <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> instance, and\nperforms no additional operations.</p>\n<p>Each instance maintains a stack of registered callbacks that are called in\nreverse order when the instance is closed (either explicitly or implicitly\nat the end of a <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement). Note that callbacks are <em>not</em>\ninvoked implicitly when the context stack instance is garbage collected.</p>\n<p>This stack model is used so that context managers that acquire their\nresources in their <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__</span></code> method (such as file objects) can be\nhandled correctly.</p>\n<p>Since registered callbacks are invoked in the reverse order of\nregistration, this ends up behaving as if multiple nested <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatements had been used with the registered set of callbacks. This even\nextends to exception handling - if an inner callback suppresses or replaces\nan exception, then outer callbacks will be passed arguments based on that\nupdated state.</p>\n<p>This is a relatively low level API that takes care of the details of\ncorrectly unwinding the stack of exit callbacks. It provides a suitable\nfoundation for higher level context managers that manipulate the exit\nstack in application specific ways.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.3.</span></p>\n</div>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack.enter_context\">\n<span class=\"sig-name descname\"><span class=\"pre\">enter_context</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">cm</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.ExitStack.enter_context\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Enters a new context manager and adds its <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> method to\nthe callback stack. The return value is the result of the context\nmanager’s own <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a> method.</p>\n<p>These context managers may suppress exceptions just as they normally\nwould if used directly as part of a <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.11: </span>Raises <a class=\"reference internal\" href=\"exceptions.html#TypeError\" title=\"TypeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">TypeError</span></code></a> instead of <a class=\"reference internal\" href=\"exceptions.html#AttributeError\" title=\"AttributeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">AttributeError</span></code></a> if <em>cm</em>\nis not a context manager.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack.push\">\n<span class=\"sig-name descname\"><span class=\"pre\">push</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">exit</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.ExitStack.push\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Adds a context manager’s <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> method to the callback stack.</p>\n<p>As <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> is <em>not</em> invoked, this method can be used to cover\npart of an <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a> implementation with a context manager’s own\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> method.</p>\n<p>If passed an object that is not a context manager, this method assumes\nit is a callback with the same signature as a context manager’s\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> method and adds it directly to the callback stack.</p>\n<p>By returning true values, these callbacks can suppress exceptions the\nsame way context manager <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__exit__\" title=\"object.__exit__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__exit__()</span></code></a> methods can.</p>\n<p>The passed in object is returned from the function, allowing this\nmethod to be used as a function decorator.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack.callback\">\n<span class=\"sig-name descname\"><span class=\"pre\">callback</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">callback</span></span></em>, <em class=\"sig-param\"><span class=\"positional-only-separator o\"><abbr title=\"Positional-only parameter separator (PEP 570)\"><span class=\"pre\">/</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">args</span></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">**</span></span><span class=\"n\"><span class=\"pre\">kwds</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.ExitStack.callback\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Accepts an arbitrary callback function and arguments and adds it to\nthe callback stack.</p>\n<p>Unlike the other methods, callbacks added this way cannot suppress\nexceptions (as they are never passed the exception details).</p>\n<p>The passed in callback is returned from the function, allowing this\nmethod to be used as a function decorator.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack.pop_all\">\n<span class=\"sig-name descname\"><span class=\"pre\">pop_all</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.ExitStack.pop_all\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Transfers the callback stack to a fresh <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> instance\nand returns it. No callbacks are invoked by this operation - instead,\nthey will now be invoked when the new stack is closed (either\nexplicitly or implicitly at the end of a <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement).</p>\n<p>For example, a group of files can be opened as an “all or nothing”\noperation as follows:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"n\">files</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">enter_context</span><span class=\"p\">(</span><span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">fname</span><span class=\"p\">))</span> <span class=\"k\">for</span> <span class=\"n\">fname</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">]</span>\n    <span class=\"c1\"># Hold onto the close method, but don&#39;t call it yet.</span>\n    <span class=\"n\">close_files</span> <span class=\"o\">=</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">pop_all</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">close</span>\n    <span class=\"c1\"># If opening any file fails, all previously opened files will be</span>\n    <span class=\"c1\"># closed automatically. If all files are opened successfully,</span>\n    <span class=\"c1\"># they will remain open even after the with statement ends.</span>\n    <span class=\"c1\"># close_files() can then be invoked explicitly to close them all.</span>\n</pre></div>\n</div>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.ExitStack.close\">\n<span class=\"sig-name descname\"><span class=\"pre\">close</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.ExitStack.close\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Immediately unwinds the callback stack, invoking callbacks in the\nreverse order of registration. For any context managers and exit\ncallbacks registered, the arguments passed in will indicate that no\nexception occurred.</p>\n</dd></dl>\n\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncExitStack\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">contextlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">AsyncExitStack</span></span><a class=\"headerlink\" href=\"#contextlib.AsyncExitStack\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>An <a class=\"reference internal\" href=\"../reference/datamodel.html#async-context-managers\"><span class=\"std std-ref\">asynchronous context manager</span></a>, similar\nto <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a>, that supports combining both synchronous and\nasynchronous context managers, as well as having coroutines for\ncleanup logic.</p>\n<p>The <a class=\"reference internal\" href=\"#contextlib.ExitStack.close\" title=\"contextlib.ExitStack.close\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">close()</span></code></a> method is not implemented; <a class=\"reference internal\" href=\"#contextlib.AsyncExitStack.aclose\" title=\"contextlib.AsyncExitStack.aclose\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">aclose()</span></code></a> must be used\ninstead.</p>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncExitStack.enter_async_context\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">async</span></span><span class=\"w\"> </span></em><span class=\"sig-name descname\"><span class=\"pre\">enter_async_context</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">cm</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.AsyncExitStack.enter_async_context\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.ExitStack.enter_context\" title=\"contextlib.ExitStack.enter_context\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.enter_context()</span></code></a> but expects an asynchronous context\nmanager.</p>\n<div class=\"versionchanged\">\n<p><span class=\"versionmodified changed\">Changed in version 3.11: </span>Raises <a class=\"reference internal\" href=\"exceptions.html#TypeError\" title=\"TypeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">TypeError</span></code></a> instead of <a class=\"reference internal\" href=\"exceptions.html#AttributeError\" title=\"AttributeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">AttributeError</span></code></a> if <em>cm</em>\nis not an asynchronous context manager.</p>\n</div>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncExitStack.push_async_exit\">\n<span class=\"sig-name descname\"><span class=\"pre\">push_async_exit</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">exit</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.AsyncExitStack.push_async_exit\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.ExitStack.push\" title=\"contextlib.ExitStack.push\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.push()</span></code></a> but expects either an asynchronous context manager\nor a coroutine function.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncExitStack.push_async_callback\">\n<span class=\"sig-name descname\"><span class=\"pre\">push_async_callback</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">callback</span></span></em>, <em class=\"sig-param\"><span class=\"positional-only-separator o\"><abbr title=\"Positional-only parameter separator (PEP 570)\"><span class=\"pre\">/</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">args</span></span></em>, <em class=\"sig-param\"><span class=\"o\"><span class=\"pre\">**</span></span><span class=\"n\"><span class=\"pre\">kwds</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.AsyncExitStack.push_async_callback\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.ExitStack.callback\" title=\"contextlib.ExitStack.callback\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.callback()</span></code></a> but expects a coroutine function.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"contextlib.AsyncExitStack.aclose\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">async</span></span><span class=\"w\"> </span></em><span class=\"sig-name descname\"><span class=\"pre\">aclose</span></span><span class=\"sig-paren\">(</span><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#contextlib.AsyncExitStack.aclose\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Similar to <a class=\"reference internal\" href=\"#contextlib.ExitStack.close\" title=\"contextlib.ExitStack.close\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.close()</span></code></a> but properly handles awaitables.</p>\n</dd></dl>\n\n<p>Continuing the example for <a class=\"reference internal\" href=\"#contextlib.asynccontextmanager\" title=\"contextlib.asynccontextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">asynccontextmanager()</span></code></a>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">AsyncExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"n\">connections</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"k\">await</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">enter_async_context</span><span class=\"p\">(</span><span class=\"n\">get_connection</span><span class=\"p\">())</span>\n        <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)]</span>\n    <span class=\"c1\"># All opened connections will automatically be released at the end of</span>\n    <span class=\"c1\"># the async with statement, even if attempts to open a connection</span>\n    <span class=\"c1\"># later in the list raise an exception.</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.7.</span></p>\n</div>\n</dd></dl>\n\n</section>\n<section id=\"examples-and-recipes\">\n<h2>Examples and Recipes<a class=\"headerlink\" href=\"#examples-and-recipes\" title=\"Link to this heading\">¶</a></h2>\n<p>This section describes some examples and recipes for making effective use of\nthe tools provided by <a class=\"reference internal\" href=\"#module-contextlib\" title=\"contextlib: Utilities for with-statement contexts.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code></a>.</p>\n<section id=\"supporting-a-variable-number-of-context-managers\">\n<h3>Supporting a variable number of context managers<a class=\"headerlink\" href=\"#supporting-a-variable-number-of-context-managers\" title=\"Link to this heading\">¶</a></h3>\n<p>The primary use case for <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> is the one given in the class\ndocumentation: supporting a variable number of context managers and other\ncleanup operations in a single <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement. The variability\nmay come from the number of context managers needed being driven by user\ninput (such as opening a user specified collection of files), or from\nsome of the context managers being optional:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"k\">for</span> <span class=\"n\">resource</span> <span class=\"ow\">in</span> <span class=\"n\">resources</span><span class=\"p\">:</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">enter_context</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">need_special_resource</span><span class=\"p\">():</span>\n        <span class=\"n\">special</span> <span class=\"o\">=</span> <span class=\"n\">acquire_special_resource</span><span class=\"p\">()</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"n\">release_special_resource</span><span class=\"p\">,</span> <span class=\"n\">special</span><span class=\"p\">)</span>\n    <span class=\"c1\"># Perform operations that use the acquired resources</span>\n</pre></div>\n</div>\n<p>As shown, <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> also makes it quite easy to use <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatements to manage arbitrary resources that don’t natively support the\ncontext management protocol.</p>\n</section>\n<section id=\"catching-exceptions-from-enter-methods\">\n<h3>Catching exceptions from <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> methods<a class=\"headerlink\" href=\"#catching-exceptions-from-enter-methods\" title=\"Link to this heading\">¶</a></h3>\n<p>It is occasionally desirable to catch exceptions from an <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code>\nmethod implementation, <em>without</em> inadvertently catching exceptions from\nthe <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement body or the context manager’s <code class=\"docutils literal notranslate\"><span class=\"pre\">__exit__</span></code>\nmethod. By using <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> the steps in the context management\nprotocol can be separated slightly in order to allow this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">stack</span> <span class=\"o\">=</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span>\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">enter_context</span><span class=\"p\">(</span><span class=\"n\">cm</span><span class=\"p\">)</span>\n<span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n    <span class=\"c1\"># handle __enter__ exception</span>\n<span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"k\">with</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n        <span class=\"c1\"># Handle normal case</span>\n</pre></div>\n</div>\n<p>Actually needing to do this is likely to indicate that the underlying API\nshould be providing a direct resource management interface for use with\n<a class=\"reference internal\" href=\"../reference/compound_stmts.html#try\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">try</span></code></a>/<a class=\"reference internal\" href=\"../reference/compound_stmts.html#except\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">except</span></code></a>/<a class=\"reference internal\" href=\"../reference/compound_stmts.html#finally\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">finally</span></code></a> statements, but not\nall APIs are well designed in that regard. When a context manager is the\nonly resource management API provided, then <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> can make it\neasier to handle various situations that can’t be handled directly in a\n<a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement.</p>\n</section>\n<section id=\"cleaning-up-in-an-enter-implementation\">\n<h3>Cleaning up in an <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> implementation<a class=\"headerlink\" href=\"#cleaning-up-in-an-enter-implementation\" title=\"Link to this heading\">¶</a></h3>\n<p>As noted in the documentation of <a class=\"reference internal\" href=\"#contextlib.ExitStack.push\" title=\"contextlib.ExitStack.push\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.push()</span></code></a>, this\nmethod can be useful in cleaning up an already allocated resource if later\nsteps in the <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a> implementation fail.</p>\n<p>Here’s an example of doing this for a context manager that accepts resource\nacquisition and release functions, along with an optional validation function,\nand maps them to the context management protocol:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">contextmanager</span><span class=\"p\">,</span> <span class=\"n\">AbstractContextManager</span><span class=\"p\">,</span> <span class=\"n\">ExitStack</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ResourceManager</span><span class=\"p\">(</span><span class=\"n\">AbstractContextManager</span><span class=\"p\">):</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">acquire_resource</span><span class=\"p\">,</span> <span class=\"n\">release_resource</span><span class=\"p\">,</span> <span class=\"n\">check_resource_ok</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">acquire_resource</span> <span class=\"o\">=</span> <span class=\"n\">acquire_resource</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">release_resource</span> <span class=\"o\">=</span> <span class=\"n\">release_resource</span>\n        <span class=\"k\">if</span> <span class=\"n\">check_resource_ok</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">check_resource_ok</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">check_resource_ok</span> <span class=\"o\">=</span> <span class=\"n\">check_resource_ok</span>\n\n    <span class=\"nd\">@contextmanager</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">_cleanup_on_error</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n            <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">push</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n            <span class=\"k\">yield</span>\n            <span class=\"c1\"># The validation check passed and didn&#39;t raise an exception</span>\n            <span class=\"c1\"># Accordingly, we want to keep the resource, and pass it</span>\n            <span class=\"c1\"># back to our caller</span>\n            <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">pop_all</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__enter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">resource</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">acquire_resource</span><span class=\"p\">()</span>\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_cleanup_on_error</span><span class=\"p\">():</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">check_resource_ok</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">):</span>\n                <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;Failed validation for </span><span class=\"si\">{!r}</span><span class=\"s2\">&quot;</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">RuntimeError</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">))</span>\n        <span class=\"k\">return</span> <span class=\"n\">resource</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__exit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">exc_details</span><span class=\"p\">):</span>\n        <span class=\"c1\"># We don&#39;t need to duplicate any of our resource release logic</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">release_resource</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n</section>\n<section id=\"replacing-any-use-of-try-finally-and-flag-variables\">\n<h3>Replacing any use of <code class=\"docutils literal notranslate\"><span class=\"pre\">try-finally</span></code> and flag variables<a class=\"headerlink\" href=\"#replacing-any-use-of-try-finally-and-flag-variables\" title=\"Link to this heading\">¶</a></h3>\n<p>A pattern you will sometimes see is a <code class=\"docutils literal notranslate\"><span class=\"pre\">try-finally</span></code> statement with a flag\nvariable to indicate whether or not the body of the <code class=\"docutils literal notranslate\"><span class=\"pre\">finally</span></code> clause should\nbe executed. In its simplest form (that can’t already be handled just by\nusing an <code class=\"docutils literal notranslate\"><span class=\"pre\">except</span></code> clause instead), it looks something like this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">cleanup_needed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">perform_operation</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n        <span class=\"n\">cleanup_needed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n<span class=\"k\">finally</span><span class=\"p\">:</span>\n    <span class=\"k\">if</span> <span class=\"n\">cleanup_needed</span><span class=\"p\">:</span>\n        <span class=\"n\">cleanup_resources</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>As with any <code class=\"docutils literal notranslate\"><span class=\"pre\">try</span></code> statement based code, this can cause problems for\ndevelopment and review, because the setup code and the cleanup code can end\nup being separated by arbitrarily long sections of code.</p>\n<p><a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> makes it possible to instead register a callback for\nexecution at the end of a <code class=\"docutils literal notranslate\"><span class=\"pre\">with</span></code> statement, and then later decide to skip\nexecuting that callback:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ExitStack</span>\n\n<span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"n\">cleanup_resources</span><span class=\"p\">)</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">perform_operation</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">pop_all</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>This allows the intended cleanup behaviour to be made explicit up front,\nrather than requiring a separate flag variable.</p>\n<p>If a particular application uses this pattern a lot, it can be simplified\neven further by means of a small helper class:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ExitStack</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Callback</span><span class=\"p\">(</span><span class=\"n\">ExitStack</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">callback</span><span class=\"p\">,</span> <span class=\"o\">/</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"n\">callback</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwds</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">cancel</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">pop_all</span><span class=\"p\">()</span>\n\n<span class=\"k\">with</span> <span class=\"n\">Callback</span><span class=\"p\">(</span><span class=\"n\">cleanup_resources</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">cb</span><span class=\"p\">:</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">perform_operation</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n        <span class=\"n\">cb</span><span class=\"o\">.</span><span class=\"n\">cancel</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>If the resource cleanup isn’t already neatly bundled into a standalone\nfunction, then it is still possible to use the decorator form of\n<a class=\"reference internal\" href=\"#contextlib.ExitStack.callback\" title=\"contextlib.ExitStack.callback\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ExitStack.callback()</span></code></a> to declare the resource cleanup in\nadvance:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ExitStack</span>\n\n<span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n    <span class=\"nd\">@stack</span><span class=\"o\">.</span><span class=\"n\">callback</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">cleanup_resources</span><span class=\"p\">():</span>\n        <span class=\"o\">...</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">perform_operation</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">pop_all</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Due to the way the decorator protocol works, a callback function\ndeclared this way cannot take any parameters. Instead, any resources to\nbe released must be accessed as closure variables.</p>\n</section>\n<section id=\"using-a-context-manager-as-a-function-decorator\">\n<h3>Using a context manager as a function decorator<a class=\"headerlink\" href=\"#using-a-context-manager-as-a-function-decorator\" title=\"Link to this heading\">¶</a></h3>\n<p><a class=\"reference internal\" href=\"#contextlib.ContextDecorator\" title=\"contextlib.ContextDecorator\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code></a> makes it possible to use a context manager in\nboth an ordinary <code class=\"docutils literal notranslate\"><span class=\"pre\">with</span></code> statement and also as a function decorator.</p>\n<p>For example, it is sometimes useful to wrap functions or groups of statements\nwith a logger that can track the time of entry and time of exit.  Rather than\nwriting both a function decorator and a context manager for the task,\ninheriting from <a class=\"reference internal\" href=\"#contextlib.ContextDecorator\" title=\"contextlib.ContextDecorator\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ContextDecorator</span></code></a> provides both capabilities in a\nsingle definition:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ContextDecorator</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">logging</span>\n\n<span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">basicConfig</span><span class=\"p\">(</span><span class=\"n\">level</span><span class=\"o\">=</span><span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">track_entry_and_exit</span><span class=\"p\">(</span><span class=\"n\">ContextDecorator</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__enter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Entering: </span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__exit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">exc_type</span><span class=\"p\">,</span> <span class=\"n\">exc</span><span class=\"p\">,</span> <span class=\"n\">exc_tb</span><span class=\"p\">):</span>\n        <span class=\"n\">logging</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s1\">&#39;Exiting: </span><span class=\"si\">%s</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Instances of this class can be used as both a context manager:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">track_entry_and_exit</span><span class=\"p\">(</span><span class=\"s1\">&#39;widget loader&#39;</span><span class=\"p\">):</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Some time consuming activity goes here&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">load_widget</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>And also as a function decorator:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nd\">@track_entry_and_exit</span><span class=\"p\">(</span><span class=\"s1\">&#39;widget loader&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">activity</span><span class=\"p\">():</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;Some time consuming activity goes here&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">load_widget</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Note that there is one additional limitation when using context managers\nas function decorators: there’s no way to access the return value of\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__enter__\" title=\"object.__enter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__enter__()</span></code></a>. If that value is needed, then it is still necessary to use\nan explicit <code class=\"docutils literal notranslate\"><span class=\"pre\">with</span></code> statement.</p>\n<div class=\"admonition seealso\">\n<p class=\"admonition-title\">See also</p>\n<dl class=\"simple\">\n<dt><span class=\"target\" id=\"index-0\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0343/\"><strong>PEP 343</strong></a> - The “with” statement</dt><dd><p>The specification, background, and examples for the Python <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a>\nstatement.</p>\n</dd>\n</dl>\n</div>\n</section>\n</section>\n<section id=\"single-use-reusable-and-reentrant-context-managers\">\n<span id=\"single-use-reusable-and-reentrant-cms\"></span><h2>Single use, reusable and reentrant context managers<a class=\"headerlink\" href=\"#single-use-reusable-and-reentrant-context-managers\" title=\"Link to this heading\">¶</a></h2>\n<p>Most context managers are written in a way that means they can only be\nused effectively in a <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement once. These single use\ncontext managers must be created afresh each time they’re used -\nattempting to use them a second time will trigger an exception or\notherwise not work correctly.</p>\n<p>This common limitation means that it is generally advisable to create\ncontext managers directly in the header of the <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement\nwhere they are used (as shown in all of the usage examples above).</p>\n<p>Files are an example of effectively single use context managers, since\nthe first <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statement will close the file, preventing any\nfurther IO operations using that file object.</p>\n<p>Context managers created using <a class=\"reference internal\" href=\"#contextlib.contextmanager\" title=\"contextlib.contextmanager\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">contextmanager()</span></code></a> are also single use\ncontext managers, and will complain about the underlying generator failing\nto yield if an attempt is made to use them a second time:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@contextmanager</span>\n<span class=\"gp\">... </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">singleuse</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Before&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">yield</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;After&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">cm</span> <span class=\"o\">=</span> <span class=\"n\">singleuse</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">cm</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Before</span>\n<span class=\"go\">After</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">cm</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">RuntimeError</span>: <span class=\"n\">generator didn&#39;t yield</span>\n</pre></div>\n</div>\n<section id=\"reentrant-context-managers\">\n<span id=\"reentrant-cms\"></span><h3>Reentrant context managers<a class=\"headerlink\" href=\"#reentrant-context-managers\" title=\"Link to this heading\">¶</a></h3>\n<p>More sophisticated context managers may be “reentrant”. These context\nmanagers can not only be used in multiple <a class=\"reference internal\" href=\"../reference/compound_stmts.html#with\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code></a> statements,\nbut may also be used <em>inside</em> a <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code> statement that is already\nusing the same context manager.</p>\n<p><a class=\"reference internal\" href=\"threading.html#threading.RLock\" title=\"threading.RLock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">threading.RLock</span></code></a> is an example of a reentrant context manager, as are\n<a class=\"reference internal\" href=\"#contextlib.suppress\" title=\"contextlib.suppress\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">suppress()</span></code></a>, <a class=\"reference internal\" href=\"#contextlib.redirect_stdout\" title=\"contextlib.redirect_stdout\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">redirect_stdout()</span></code></a>, and <a class=\"reference internal\" href=\"#contextlib.chdir\" title=\"contextlib.chdir\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">chdir()</span></code></a>. Here’s a very\nsimple example of reentrant use:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">redirect_stdout</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">io</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">StringIO</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">stream</span> <span class=\"o\">=</span> <span class=\"n\">StringIO</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">write_to_stream</span> <span class=\"o\">=</span> <span class=\"n\">redirect_stdout</span><span class=\"p\">(</span><span class=\"n\">stream</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">write_to_stream</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;This is written to the stream rather than stdout&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">with</span> <span class=\"n\">write_to_stream</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;This is also written to the stream&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;This is written directly to stdout&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">This is written directly to stdout</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">stream</span><span class=\"o\">.</span><span class=\"n\">getvalue</span><span class=\"p\">())</span>\n<span class=\"go\">This is written to the stream rather than stdout</span>\n<span class=\"go\">This is also written to the stream</span>\n</pre></div>\n</div>\n<p>Real world examples of reentrancy are more likely to involve multiple\nfunctions calling each other and hence be far more complicated than this\nexample.</p>\n<p>Note also that being reentrant is <em>not</em> the same thing as being thread safe.\n<a class=\"reference internal\" href=\"#contextlib.redirect_stdout\" title=\"contextlib.redirect_stdout\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">redirect_stdout()</span></code></a>, for example, is definitely not thread safe, as it\nmakes a global modification to the system state by binding <a class=\"reference internal\" href=\"sys.html#sys.stdout\" title=\"sys.stdout\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.stdout</span></code></a>\nto a different stream.</p>\n</section>\n<section id=\"reusable-context-managers\">\n<span id=\"reusable-cms\"></span><h3>Reusable context managers<a class=\"headerlink\" href=\"#reusable-context-managers\" title=\"Link to this heading\">¶</a></h3>\n<p>Distinct from both single use and reentrant context managers are “reusable”\ncontext managers (or, to be completely explicit, “reusable, but not\nreentrant” context managers, since reentrant context managers are also\nreusable). These context managers support being used multiple times, but\nwill fail (or otherwise not work correctly) if the specific context manager\ninstance has already been used in a containing with statement.</p>\n<p><a class=\"reference internal\" href=\"threading.html#threading.Lock\" title=\"threading.Lock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">threading.Lock</span></code></a> is an example of a reusable, but not reentrant,\ncontext manager (for a reentrant lock, it is necessary to use\n<a class=\"reference internal\" href=\"threading.html#threading.RLock\" title=\"threading.RLock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">threading.RLock</span></code></a> instead).</p>\n<p>Another example of a reusable, but not reentrant, context manager is\n<a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a>, as it invokes <em>all</em> currently registered callbacks\nwhen leaving any with statement, regardless of where those callbacks\nwere added:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ExitStack</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">stack</span> <span class=\"o\">=</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from first context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving first context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Leaving first context</span>\n<span class=\"go\">Callback: from first context</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from second context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving second context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Leaving second context</span>\n<span class=\"go\">Callback: from second context</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from outer context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">with</span> <span class=\"n\">stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"n\">stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from inner context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving inner context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving outer context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Leaving inner context</span>\n<span class=\"go\">Callback: from inner context</span>\n<span class=\"go\">Callback: from outer context</span>\n<span class=\"go\">Leaving outer context</span>\n</pre></div>\n</div>\n<p>As the output from the example shows, reusing a single stack object across\nmultiple with statements works correctly, but attempting to nest them\nwill cause the stack to be cleared at the end of the innermost with\nstatement, which is unlikely to be desirable behaviour.</p>\n<p>Using separate <a class=\"reference internal\" href=\"#contextlib.ExitStack\" title=\"contextlib.ExitStack\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ExitStack</span></code></a> instances instead of reusing a single\ninstance avoids that problem:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">contextlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ExitStack</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">outer_stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">outer_stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from outer context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">with</span> <span class=\"n\">ExitStack</span><span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">inner_stack</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"n\">inner_stack</span><span class=\"o\">.</span><span class=\"n\">callback</span><span class=\"p\">(</span><span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Callback: from inner context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving inner context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Leaving outer context&quot;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">Leaving inner context</span>\n<span class=\"go\">Callback: from inner context</span>\n<span class=\"go\">Leaving outer context</span>\n<span class=\"go\">Callback: from outer context</span>\n</pre></div>\n</div>\n</section>\n</section>\n</section>\n\n\n            <div class=\"clearer\"></div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sphinxsidebar\" role=\"navigation\" aria-label=\"Main\">\n        <div class=\"sphinxsidebarwrapper\">\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code> — Utilities for <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code>-statement contexts</a><ul>\n<li><a class=\"reference internal\" href=\"#utilities\">Utilities</a></li>\n<li><a class=\"reference internal\" href=\"#examples-and-recipes\">Examples and Recipes</a><ul>\n<li><a class=\"reference internal\" href=\"#supporting-a-variable-number-of-context-managers\">Supporting a variable number of context managers</a></li>\n<li><a class=\"reference internal\" href=\"#catching-exceptions-from-enter-methods\">Catching exceptions from <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> methods</a></li>\n<li><a class=\"reference internal\" href=\"#cleaning-up-in-an-enter-implementation\">Cleaning up in an <code class=\"docutils literal notranslate\"><span class=\"pre\">__enter__</span></code> implementation</a></li>\n<li><a class=\"reference internal\" href=\"#replacing-any-use-of-try-finally-and-flag-variables\">Replacing any use of <code class=\"docutils literal notranslate\"><span class=\"pre\">try-finally</span></code> and flag variables</a></li>\n<li><a class=\"reference internal\" href=\"#using-a-context-manager-as-a-function-decorator\">Using a context manager as a function decorator</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#single-use-reusable-and-reentrant-context-managers\">Single use, reusable and reentrant context managers</a><ul>\n<li><a class=\"reference internal\" href=\"#reentrant-context-managers\">Reentrant context managers</a></li>\n<li><a class=\"reference internal\" href=\"#reusable-context-managers\">Reusable context managers</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"dataclasses.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">dataclasses</span></code> — Data Classes</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"abc.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">abc</span></code> — Abstract Base Classes</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/contextlib.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </div>\n<div id=\"sidebarbutton\" title=\"Collapse sidebar\">\n<span>«</span>\n</div>\n\n      </div>\n      <div class=\"clearer\"></div>\n    </div>  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             >index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"abc.html\" title=\"abc — Abstract Base Classes\"\n             >next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"dataclasses.html\" title=\"dataclasses — Data Classes\"\n             >previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"python.html\" >Python Runtime Services</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">contextlib</span></code> — Utilities for <code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">with</span></code>-statement contexts</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>  \n    <div class=\"footer\">\n    &copy; <a href=\"../copyright.html\">Copyright</a> 2001 Python Software Foundation.\n    <br>\n    This page is licensed under the Python Software Foundation License Version 2.\n    <br>\n    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.\n    <br>\n    \n      See <a href=\"/license.html\">History and License</a> for more information.<br>\n    \n    \n    <br>\n\n    The Python Software Foundation is a non-profit corporation.\n<a href=\"https://www.python.org/psf/donations/\">Please donate.</a>\n<br>\n    <br>\n      Last updated on Nov 25, 2025 (18:01 UTC).\n    \n      <a href=\"/bugs.html\">Found a bug</a>?\n    \n    <br>\n\n    Created using <a href=\"https://www.sphinx-doc.org/\">Sphinx</a> 8.2.3.\n    </div>\n\n    <script type=\"text/javascript\" src=\"../_static/switchers.js\"></script>\n  </body>\n</html>",
  "metadata": {
    "title": "contextlib — Utilities for with-statement contexts — Python 3.14.0 documentation",
    "meta_description": "Source code: Lib/contextlib.py This module provides utilities for common tasks involving the with statement. For more information see also Context Manager Types and With Statement Context Managers....",
    "h1": "— Utilities for"
  },
  "request_headers": {
    "Referer": "https://docs.python.org/3/library/",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en",
    "User-Agent": "DumbCrawler/1.0",
    "Accept-Encoding": "gzip, deflate"
  },
  "response_headers": {
    "Content-Length": "18494",
    "Server": "nginx",
    "Content-Type": "text/html",
    "Last-Modified": "Tue, 25 Nov 2025 18:03:26 GMT",
    "Etag": "\"6925ef6e-20657\"",
    "X-Clacks-Overhead": "GNU Terry Pratchett",
    "Strict-Transport-Security": "max-age=315360000; includeSubDomains; preload",
    "Via": "1.1 varnish, 1.1 varnish",
    "Accept-Ranges": "bytes",
    "Age": "3477",
    "Date": "Wed, 26 Nov 2025 05:32:30 GMT",
    "X-Served-By": "cache-lga21949-LGA, cache-yul1970022-YUL",
    "X-Cache": "HIT, HIT",
    "X-Cache-Hits": "207, 0",
    "X-Timer": "S1764135150.298595,VS0,VE1",
    "Vary": "Accept-Encoding"
  },
  "crawled_at": "2025-11-26T05:32:30.724929+00:00",
  "crawler": {
    "name": "DumbCrawler",
    "version": "1.0",
    "mode": "crawl",
    "js_mode": "off",
    "scope": "subfolder"
  }
}