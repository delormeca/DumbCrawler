{
  "url": "https://docs.python.org/3/library/annotationlib.html",
  "status_code": 200,
  "depth": 1,
  "referrer": "https://docs.python.org/3/library/",
  "raw_html": "<!DOCTYPE html>\n\n<html lang=\"en\" data-content_root=\"../\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<meta property=\"og:title\" content=\"annotationlib — Functionality for introspecting annotations\" />\n<meta property=\"og:type\" content=\"website\" />\n<meta property=\"og:url\" content=\"https://docs.python.org/3/library/annotationlib.html\" />\n<meta property=\"og:site_name\" content=\"Python documentation\" />\n<meta property=\"og:description\" content=\"Source code: Lib/annotationlib.py The annotationlib module provides tools for introspecting annotations on modules, classes, and functions. Annotations are lazily evaluated and often contain forwar...\" />\n<meta property=\"og:image:width\" content=\"1146\" />\n<meta property=\"og:image:height\" content=\"600\" />\n<meta property=\"og:image\" content=\"https://docs.python.org/3.14/_images/social_previews/summary_library_annotationlib_f16fa90e.png\" />\n<meta property=\"og:image:alt\" content=\"Source code: Lib/annotationlib.py The annotationlib module provides tools for introspecting annotations on modules, classes, and functions. Annotations are lazily evaluated and often contain forwar...\" />\n<meta name=\"description\" content=\"Source code: Lib/annotationlib.py The annotationlib module provides tools for introspecting annotations on modules, classes, and functions. Annotations are lazily evaluated and often contain forwar...\" />\n<meta name=\"twitter:card\" content=\"summary_large_image\" />\n<meta name=\"theme-color\" content=\"#3776ab\">\n\n    <title>annotationlib — Functionality for introspecting annotations &#8212; Python 3.14.0 documentation</title><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments.css?v=b86133f3\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/classic.css?v=234b1a7c\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pydoctheme.css?v=8cd84f99\" />\n    <link id=\"pygments_dark_css\" media=\"(prefers-color-scheme: dark)\" rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments_dark.css?v=5349f25f\" />\n    \n    <script src=\"../_static/documentation_options.js?v=e4f4b189\"></script>\n    <script src=\"../_static/doctools.js?v=9bcbadda\"></script>\n    <script src=\"../_static/sphinx_highlight.js?v=dc90522c\"></script>\n    \n    <script src=\"../_static/sidebar.js\"></script>\n    \n    <link rel=\"search\" type=\"application/opensearchdescription+xml\"\n          title=\"Search within Python 3.14.0 documentation\"\n          href=\"../_static/opensearch.xml\"/>\n    <link rel=\"author\" title=\"About these documents\" href=\"../about.html\" />\n    <link rel=\"index\" title=\"Index\" href=\"../genindex.html\" />\n    <link rel=\"search\" title=\"Search\" href=\"../search.html\" />\n    <link rel=\"copyright\" title=\"Copyright\" href=\"../copyright.html\" />\n    <link rel=\"next\" title=\"site — Site-specific configuration hook\" href=\"site.html\" />\n    <link rel=\"prev\" title=\"inspect — Inspect live objects\" href=\"inspect.html\" />\n    \n      \n      <script defer file-types=\"bz2,epub,zip\" data-domain=\"docs.python.org\" src=\"https://analytics.python.org/js/script.file-downloads.outbound-links.js\"></script>\n      \n      <link rel=\"canonical\" href=\"https://docs.python.org/3/library/annotationlib.html\">\n      \n    \n\n    \n    <style>\n      @media only screen {\n        table.full-width-table {\n            width: 100%;\n        }\n      }\n    </style>\n<link rel=\"stylesheet\" href=\"../_static/pydoctheme_dark.css\" media=\"(prefers-color-scheme: dark)\" id=\"pydoctheme_dark_css\">\n    <link rel=\"shortcut icon\" type=\"image/png\" href=\"../_static/py.svg\">\n            <script type=\"text/javascript\" src=\"../_static/copybutton.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/menu.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/search-focus.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/themetoggle.js\"></script> \n            <script type=\"text/javascript\" src=\"../_static/rtd_switcher.js\"></script>\n            <meta name=\"readthedocs-addons-api-version\" content=\"1\">\n\n  </head>\n<body>\n<div class=\"mobile-nav\">\n    <input type=\"checkbox\" id=\"menuToggler\" class=\"toggler__input\" aria-controls=\"navigation\"\n           aria-pressed=\"false\" aria-expanded=\"false\" role=\"button\" aria-label=\"Menu\">\n    <nav class=\"nav-content\" role=\"navigation\">\n        <label for=\"menuToggler\" class=\"toggler__label\">\n            <span></span>\n        </label>\n        <span class=\"nav-items-wrapper\">\n            <a href=\"https://www.python.org/\" class=\"nav-logo\">\n                <img src=\"../_static/py.svg\" alt=\"Python logo\">\n            </a>\n            <span class=\"version_switcher_placeholder\"></span>\n            <form role=\"search\" class=\"search\" action=\"../search.html\" method=\"get\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" class=\"search-icon\">\n                    <path fill-rule=\"nonzero\" fill=\"currentColor\" d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"></path>\n                </svg>\n                <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\">\n                <input type=\"submit\" value=\"Go\">\n            </form>\n        </span>\n    </nav>\n    <div class=\"menu-wrapper\">\n        <nav class=\"menu\" role=\"navigation\" aria-label=\"main navigation\">\n            <div class=\"language_switcher_placeholder\"></div>\n            \n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label>\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> — Functionality for introspecting annotations</a><ul>\n<li><a class=\"reference internal\" href=\"#annotation-semantics\">Annotation semantics</a></li>\n<li><a class=\"reference internal\" href=\"#classes\">Classes</a></li>\n<li><a class=\"reference internal\" href=\"#functions\">Functions</a></li>\n<li><a class=\"reference internal\" href=\"#recipes\">Recipes</a><ul>\n<li><a class=\"reference internal\" href=\"#using-annotations-in-a-metaclass\">Using annotations in a metaclass</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#limitations-of-the-string-format\">Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">STRING</span></code> format</a></li>\n<li><a class=\"reference internal\" href=\"#limitations-of-the-forwardref-format\">Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code> format</a></li>\n<li><a class=\"reference internal\" href=\"#security-implications-of-introspecting-annotations\">Security implications of introspecting annotations</a></li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"inspect.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">inspect</span></code> — Inspect live objects</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"site.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">site</span></code> — Site-specific configuration hook</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/annotationlib.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </nav>\n    </div>\n</div>\n\n  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             accesskey=\"I\">index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"site.html\" title=\"site — Site-specific configuration hook\"\n             accesskey=\"N\">next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"inspect.html\" title=\"inspect — Inspect live objects\"\n             accesskey=\"P\">previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"python.html\" accesskey=\"U\">Python Runtime Services</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> — Functionality for introspecting annotations</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>    \n\n    <div class=\"document\">\n      <div class=\"documentwrapper\">\n        <div class=\"bodywrapper\">\n          <div class=\"body\" role=\"main\">\n            \n  <section id=\"module-annotationlib\">\n<span id=\"annotationlib-functionality-for-introspecting-annotations\"></span><h1><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> — Functionality for introspecting annotations<a class=\"headerlink\" href=\"#module-annotationlib\" title=\"Link to this heading\">¶</a></h1>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n<p><strong>Source code:</strong> <a class=\"extlink-source reference external\" href=\"https://github.com/python/cpython/tree/3.14/Lib/annotationlib.py\">Lib/annotationlib.py</a></p>\n<hr class=\"docutils\" />\n<p>The <code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> module provides tools for introspecting\n<a class=\"reference internal\" href=\"../glossary.html#term-annotation\"><span class=\"xref std std-term\">annotations</span></a> on modules, classes, and functions.</p>\n<p>Annotations are <a class=\"reference internal\" href=\"../reference/executionmodel.html#lazy-evaluation\"><span class=\"std std-ref\">lazily evaluated</span></a> and often contain\nforward references to objects that are not yet defined when the annotation\nis created. This module provides a set of low-level tools that can be used to retrieve annotations in a reliable way, even\nin the presence of forward references and other edge cases.</p>\n<p>This module supports retrieving annotations in three main formats\n(see <a class=\"reference internal\" href=\"#annotationlib.Format\" title=\"annotationlib.Format\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Format</span></code></a>), each of which works best for different use cases:</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a> evaluates the annotations and returns their value.\nThis is most straightforward to work with, but it may raise errors,\nfor example if the annotations contain references to undefined names.</p></li>\n<li><p><a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> returns <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> objects\nfor annotations that cannot be resolved, allowing you to inspect the\nannotations without evaluating them. This is useful when you need to\nwork with annotations that may contain unresolved forward references.</p></li>\n<li><p><a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> returns the annotations as a string, similar\nto how it would appear in the source file. This is useful for documentation\ngenerators that want to display annotations in a readable way.</p></li>\n</ul>\n<p>The <a class=\"reference internal\" href=\"#annotationlib.get_annotations\" title=\"annotationlib.get_annotations\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code></a> function is the main entry point for\nretrieving annotations. Given a function, class, or module, it returns\nan annotations dictionary in the requested format. This module also provides\nfunctionality for working directly with the <a class=\"reference internal\" href=\"../glossary.html#term-annotate-function\"><span class=\"xref std std-term\">annotate function</span></a>\nthat is used to evaluate annotations, such as <a class=\"reference internal\" href=\"#annotationlib.get_annotate_from_class_namespace\" title=\"annotationlib.get_annotate_from_class_namespace\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotate_from_class_namespace()</span></code></a>\nand <a class=\"reference internal\" href=\"#annotationlib.call_annotate_function\" title=\"annotationlib.call_annotate_function\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">call_annotate_function()</span></code></a>, as well as the\n<a class=\"reference internal\" href=\"#annotationlib.call_evaluate_function\" title=\"annotationlib.call_evaluate_function\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">call_evaluate_function()</span></code></a> function for working with\n<a class=\"reference internal\" href=\"../glossary.html#term-evaluate-function\"><span class=\"xref std std-term\">evaluate functions</span></a>.</p>\n<div class=\"admonition caution\">\n<p class=\"admonition-title\">Caution</p>\n<p>Most functionality in this module can execute arbitrary code; see\n<a class=\"reference internal\" href=\"#annotationlib-security\"><span class=\"std std-ref\">the security section</span></a> for more information.</p>\n</div>\n<div class=\"admonition seealso\">\n<p class=\"admonition-title\">See also</p>\n<p><span class=\"target\" id=\"index-0\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0649/\"><strong>PEP 649</strong></a> proposed the current model for how annotations work in Python.</p>\n<p><span class=\"target\" id=\"index-1\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0749/\"><strong>PEP 749</strong></a> expanded on various aspects of <span class=\"target\" id=\"index-2\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0649/\"><strong>PEP 649</strong></a> and introduced the\n<code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> module.</p>\n<p><a class=\"reference internal\" href=\"../howto/annotations.html#annotations-howto\"><span class=\"std std-ref\">Annotations Best Practices</span></a> provides best practices for working with\nannotations.</p>\n<p><a class=\"extlink-pypi reference external\" href=\"https://pypi.org/project/typing-extensions/\">typing-extensions</a> provides a backport of <a class=\"reference internal\" href=\"#annotationlib.get_annotations\" title=\"annotationlib.get_annotations\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code></a>\nthat works on earlier versions of Python.</p>\n</div>\n<section id=\"annotation-semantics\">\n<h2>Annotation semantics<a class=\"headerlink\" href=\"#annotation-semantics\" title=\"Link to this heading\">¶</a></h2>\n<p>The way annotations are evaluated has changed over the history of Python 3,\nand currently still depends on a <a class=\"reference internal\" href=\"../reference/simple_stmts.html#future\"><span class=\"std std-ref\">future import</span></a>.\nThere have been execution models for annotations:</p>\n<ul class=\"simple\">\n<li><p><em>Stock semantics</em> (default in Python 3.0 through 3.13; see <span class=\"target\" id=\"index-3\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-3107/\"><strong>PEP 3107</strong></a>\nand <span class=\"target\" id=\"index-4\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0526/\"><strong>PEP 526</strong></a>): Annotations are evaluated eagerly, as they are\nencountered in the source code.</p></li>\n<li><p><em>Stringified annotations</em> (used with <code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code>\nin Python 3.7 and newer; see <span class=\"target\" id=\"index-5\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0563/\"><strong>PEP 563</strong></a>): Annotations are stored as\nstrings only.</p></li>\n<li><p><em>Deferred evaluation</em> (default in Python 3.14 and newer; see <span class=\"target\" id=\"index-6\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0649/\"><strong>PEP 649</strong></a> and\n<span class=\"target\" id=\"index-7\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0749/\"><strong>PEP 749</strong></a>): Annotations are evaluated lazily, only when they are accessed.</p></li>\n</ul>\n<p>As an example, consider the following program:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">func</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"n\">Cls</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Cls</span><span class=\"p\">:</span> <span class=\"k\">pass</span>\n\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">.</span><span class=\"vm\">__annotations__</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This will behave as follows:</p>\n<ul class=\"simple\">\n<li><p>Under stock semantics (Python 3.13 and earlier), it will throw a\n<a class=\"reference internal\" href=\"exceptions.html#NameError\" title=\"NameError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">NameError</span></code></a> at the line where <code class=\"docutils literal notranslate\"><span class=\"pre\">func</span></code> is defined,\nbecause <code class=\"docutils literal notranslate\"><span class=\"pre\">Cls</span></code> is an undefined name at that point.</p></li>\n<li><p>Under stringified annotations (if <code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code>\nis used), it will print <code class=\"docutils literal notranslate\"><span class=\"pre\">{'a':</span> <span class=\"pre\">'Cls',</span> <span class=\"pre\">'return':</span> <span class=\"pre\">'None'}</span></code>.</p></li>\n<li><p>Under deferred evaluation (Python 3.14 and later), it will print\n<code class=\"docutils literal notranslate\"><span class=\"pre\">{'a':</span> <span class=\"pre\">&lt;class</span> <span class=\"pre\">'Cls'&gt;,</span> <span class=\"pre\">'return':</span> <span class=\"pre\">None}</span></code>.</p></li>\n</ul>\n<p>Stock semantics were used when function annotations were first introduced\nin Python 3.0 (by <span class=\"target\" id=\"index-8\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-3107/\"><strong>PEP 3107</strong></a>) because this was the simplest, most obvious\nway to implement annotations. The same execution model was used when variable\nannotations were introduced in Python 3.6 (by <span class=\"target\" id=\"index-9\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0526/\"><strong>PEP 526</strong></a>). However,\nstock semantics caused problems when using annotations as type hints,\nsuch as a need to refer to names that are not yet defined when the\nannotation is encountered. In addition, there were performance problems\nwith executing annotations at module import time. Therefore, in Python 3.7,\n<span class=\"target\" id=\"index-10\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0563/\"><strong>PEP 563</strong></a> introduced the ability to store annotations as strings using the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code> syntax. The plan at the time was to\neventually make this behavior the default, but a problem appeared:\nstringified annotations are more difficult to process for those who\nintrospect annotations at runtime. An alternative proposal, <span class=\"target\" id=\"index-11\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0649/\"><strong>PEP 649</strong></a>,\nintroduced the third execution model, deferred evaluation, and was implemented\nin Python 3.14. Stringified annotations are still used if\n<code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code> is present, but this behavior will\neventually be removed.</p>\n</section>\n<section id=\"classes\">\n<h2>Classes<a class=\"headerlink\" href=\"#classes\" title=\"Link to this heading\">¶</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.Format\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">Format</span></span><a class=\"headerlink\" href=\"#annotationlib.Format\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>An <a class=\"reference internal\" href=\"enum.html#enum.IntEnum\" title=\"enum.IntEnum\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">IntEnum</span></code></a> describing the formats in which annotations\ncan be returned. Members of the enum, or their equivalent integer values,\ncan be passed to <a class=\"reference internal\" href=\"#annotationlib.get_annotations\" title=\"annotationlib.get_annotations\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code></a> and other functions in this\nmodule, as well as to <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__annotate__\" title=\"object.__annotate__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__annotate__</span></code></a> functions.</p>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.Format.VALUE\">\n<span class=\"sig-name descname\"><span class=\"pre\">VALUE</span></span><em class=\"property\"><span class=\"w\"> </span><span class=\"p\"><span class=\"pre\">=</span></span><span class=\"w\"> </span><span class=\"pre\">1</span></em><a class=\"headerlink\" href=\"#annotationlib.Format.VALUE\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Values are the result of evaluating the annotation expressions.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\">\n<span class=\"sig-name descname\"><span class=\"pre\">VALUE_WITH_FAKE_GLOBALS</span></span><em class=\"property\"><span class=\"w\"> </span><span class=\"p\"><span class=\"pre\">=</span></span><span class=\"w\"> </span><span class=\"pre\">2</span></em><a class=\"headerlink\" href=\"#annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Special value used to signal that an annotate function is being\nevaluated in a special environment with fake globals. When passed this\nvalue, annotate functions should either return the same value as for\nthe <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Format.VALUE</span></code></a> format, or raise <a class=\"reference internal\" href=\"exceptions.html#NotImplementedError\" title=\"NotImplementedError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">NotImplementedError</span></code></a>\nto signal that they do not support execution in this environment.\nThis format is only used internally and should not be passed to\nthe functions in this module.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.Format.FORWARDREF\">\n<span class=\"sig-name descname\"><span class=\"pre\">FORWARDREF</span></span><em class=\"property\"><span class=\"w\"> </span><span class=\"p\"><span class=\"pre\">=</span></span><span class=\"w\"> </span><span class=\"pre\">3</span></em><a class=\"headerlink\" href=\"#annotationlib.Format.FORWARDREF\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Values are real annotation values (as per <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Format.VALUE</span></code></a> format)\nfor defined values, and <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> proxies for undefined\nvalues. Real objects may contain references to <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>\nproxy objects.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.Format.STRING\">\n<span class=\"sig-name descname\"><span class=\"pre\">STRING</span></span><em class=\"property\"><span class=\"w\"> </span><span class=\"p\"><span class=\"pre\">=</span></span><span class=\"w\"> </span><span class=\"pre\">4</span></em><a class=\"headerlink\" href=\"#annotationlib.Format.STRING\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Values are the text string of the annotation as it appears in the\nsource code, up to modifications including, but not restricted to,\nwhitespace normalizations and constant values optimizations.</p>\n<p>The exact values of these strings may change in future versions of Python.</p>\n</dd></dl>\n\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.ForwardRef\">\n<em class=\"property\"><span class=\"k\"><span class=\"pre\">class</span></span><span class=\"w\"> </span></em><span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">ForwardRef</span></span><a class=\"headerlink\" href=\"#annotationlib.ForwardRef\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A proxy object for forward references in annotations.</p>\n<p>Instances of this class are returned when the <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a>\nformat is used and annotations contain a name that cannot be resolved.\nThis can happen when a forward reference is used in an annotation, such as\nwhen a class is referenced before it is defined.</p>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.ForwardRef.__forward_arg__\">\n<span class=\"sig-name descname\"><span class=\"pre\">__forward_arg__</span></span><a class=\"headerlink\" href=\"#annotationlib.ForwardRef.__forward_arg__\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>A string containing the code that was evaluated to produce the\n<a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>. The string may not be exactly equivalent\nto the original source.</p>\n</dd></dl>\n\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.ForwardRef.evaluate\">\n<span class=\"sig-name descname\"><span class=\"pre\">evaluate</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"keyword-only-separator o\"><abbr title=\"Keyword-only parameters separator (PEP 3102)\"><span class=\"pre\">*</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">owner</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">globals</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">locals</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">type_params</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">format</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">Format.VALUE</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.ForwardRef.evaluate\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Evaluate the forward reference, returning its value.</p>\n<p>If the <em>format</em> argument is <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a> (the default),\nthis method may throw an exception, such as <a class=\"reference internal\" href=\"exceptions.html#NameError\" title=\"NameError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">NameError</span></code></a>, if the forward\nreference refers to a name that cannot be resolved. The arguments to this\nmethod can be used to provide bindings for names that would otherwise\nbe undefined. If the <em>format</em> argument is <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a>,\nthe method will never throw an exception, but may return a <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>\ninstance. For example, if the forward reference object contains the code\n<code class=\"docutils literal notranslate\"><span class=\"pre\">list[undefined]</span></code>, where <code class=\"docutils literal notranslate\"><span class=\"pre\">undefined</span></code> is a name that is not defined,\nevaluating it with the <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> format will return\n<code class=\"docutils literal notranslate\"><span class=\"pre\">list[ForwardRef('undefined')]</span></code>. If the <em>format</em> argument is\n<a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a>, the method will return <a class=\"reference internal\" href=\"#annotationlib.ForwardRef.__forward_arg__\" title=\"annotationlib.ForwardRef.__forward_arg__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__forward_arg__</span></code></a>.</p>\n<p>The <em>owner</em> parameter provides the preferred mechanism for passing scope\ninformation to this method. The owner of a <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> is the\nobject that contains the annotation from which the <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>\nderives, such as a module object, type object, or function object.</p>\n<p>The <em>globals</em>, <em>locals</em>, and <em>type_params</em> parameters provide a more precise\nmechanism for influencing the names that are available when the <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>\nis evaluated. <em>globals</em> and <em>locals</em> are passed to <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a>, representing\nthe global and local namespaces in which the name is evaluated.\nThe <em>type_params</em> parameter is relevant for objects created using the native\nsyntax for <a class=\"reference internal\" href=\"../reference/compound_stmts.html#generic-classes\"><span class=\"std std-ref\">generic classes</span></a> and <a class=\"reference internal\" href=\"../reference/compound_stmts.html#generic-functions\"><span class=\"std std-ref\">functions</span></a>.\nIt is a tuple of <a class=\"reference internal\" href=\"../reference/compound_stmts.html#type-params\"><span class=\"std std-ref\">type parameters</span></a> that are in scope\nwhile the forward reference is being evaluated. For example, if evaluating a\n<a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> retrieved from an annotation found in the class namespace\nof a generic class <code class=\"docutils literal notranslate\"><span class=\"pre\">C</span></code>, <em>type_params</em> should be set to <code class=\"docutils literal notranslate\"><span class=\"pre\">C.__type_params__</span></code>.</p>\n<p><a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> instances returned by <a class=\"reference internal\" href=\"#annotationlib.get_annotations\" title=\"annotationlib.get_annotations\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code></a>\nretain references to information about the scope they originated from,\nso calling this method with no further arguments may be sufficient to\nevaluate such objects. <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> instances created by other\nmeans may not have any information about their scope, so passing\narguments to this method may be necessary to evaluate them successfully.</p>\n<p>If no <em>owner</em>, <em>globals</em>, <em>locals</em>, or <em>type_params</em> are provided and the\n<a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> does not contain information about its origin,\nempty globals and locals dictionaries are used.</p>\n</dd></dl>\n\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n</section>\n<section id=\"functions\">\n<h2>Functions<a class=\"headerlink\" href=\"#functions\" title=\"Link to this heading\">¶</a></h2>\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.annotations_to_string\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">annotations_to_string</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">annotations</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.annotations_to_string\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Convert an annotations dict containing runtime values to a\ndict containing only strings. If the values are not already strings,\nthey are converted using <a class=\"reference internal\" href=\"#annotationlib.type_repr\" title=\"annotationlib.type_repr\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">type_repr()</span></code></a>.\nThis is meant as a helper for user-provided\nannotate functions that support the <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> format but\ndo not have access to the code creating the annotations.</p>\n<p>For example, this is used to implement the <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> for\n<a class=\"reference internal\" href=\"typing.html#typing.TypedDict\" title=\"typing.TypedDict\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">typing.TypedDict</span></code></a> classes created through the functional syntax:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">typing</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">TypedDict</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">Movie</span> <span class=\"o\">=</span> <span class=\"n\">TypedDict</span><span class=\"p\">(</span><span class=\"s2\">&quot;movie&quot;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"s2\">&quot;year&quot;</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">})</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">Movie</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">)</span>\n<span class=\"go\">{&#39;name&#39;: &#39;str&#39;, &#39;year&#39;: &#39;int&#39;}</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.call_annotate_function\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">call_annotate_function</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">annotate</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">format</span></span></em>, <em class=\"sig-param\"><span class=\"keyword-only-separator o\"><abbr title=\"Keyword-only parameters separator (PEP 3102)\"><span class=\"pre\">*</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">owner</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.call_annotate_function\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Call the <a class=\"reference internal\" href=\"../glossary.html#term-annotate-function\"><span class=\"xref std std-term\">annotate function</span></a> <em>annotate</em> with the given <em>format</em>,\na member of the <a class=\"reference internal\" href=\"#annotationlib.Format\" title=\"annotationlib.Format\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Format</span></code></a> enum, and return the annotations\ndictionary produced by the function.</p>\n<p>This helper function is required because annotate functions generated by\nthe compiler for functions, classes, and modules only support\nthe <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a> format when called directly.\nTo support other formats, this function calls the annotate function\nin a special environment that allows it to produce annotations in the\nother formats. This is a useful building block when implementing\nfunctionality that needs to partially evaluate annotations while a class\nis being constructed.</p>\n<p><em>owner</em> is the object that owns the annotation function, usually\na function, class, or module. If provided, it is used in the\n<a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> format to produce a <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a>\nobject that carries more information.</p>\n<div class=\"admonition seealso\">\n<p class=\"admonition-title\">See also</p>\n<p><span class=\"target\" id=\"index-12\"></span><a class=\"pep reference external\" href=\"https://peps.python.org/pep-0649/#the-stringizer-and-the-fake-globals-environment\"><strong>PEP 649</strong></a>\ncontains an explanation of the implementation technique used by this\nfunction.</p>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.call_evaluate_function\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">call_evaluate_function</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">evaluate</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">format</span></span></em>, <em class=\"sig-param\"><span class=\"keyword-only-separator o\"><abbr title=\"Keyword-only parameters separator (PEP 3102)\"><span class=\"pre\">*</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">owner</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.call_evaluate_function\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Call the <a class=\"reference internal\" href=\"../glossary.html#term-evaluate-function\"><span class=\"xref std std-term\">evaluate function</span></a> <em>evaluate</em> with the given <em>format</em>,\na member of the <a class=\"reference internal\" href=\"#annotationlib.Format\" title=\"annotationlib.Format\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Format</span></code></a> enum, and return the value produced by\nthe function. This is similar to <a class=\"reference internal\" href=\"#annotationlib.call_annotate_function\" title=\"annotationlib.call_annotate_function\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">call_annotate_function()</span></code></a>,\nbut the latter always returns a dictionary mapping strings to annotations,\nwhile this function returns a single value.</p>\n<p>This is intended for use with the evaluate functions generated for lazily\nevaluated elements related to type aliases and type parameters:</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.TypeAliasType.evaluate_value\" title=\"typing.TypeAliasType.evaluate_value\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.TypeAliasType.evaluate_value()</span></code></a>, the value of type aliases</p></li>\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.TypeVar.evaluate_bound\" title=\"typing.TypeVar.evaluate_bound\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.TypeVar.evaluate_bound()</span></code></a>, the bound of type variables</p></li>\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.TypeVar.evaluate_constraints\" title=\"typing.TypeVar.evaluate_constraints\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.TypeVar.evaluate_constraints()</span></code></a>, the constraints of\ntype variables</p></li>\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.TypeVar.evaluate_default\" title=\"typing.TypeVar.evaluate_default\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.TypeVar.evaluate_default()</span></code></a>, the default value of\ntype variables</p></li>\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.ParamSpec.evaluate_default\" title=\"typing.ParamSpec.evaluate_default\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.ParamSpec.evaluate_default()</span></code></a>, the default value of\nparameter specifications</p></li>\n<li><p><a class=\"reference internal\" href=\"typing.html#typing.TypeVarTuple.evaluate_default\" title=\"typing.TypeVarTuple.evaluate_default\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">typing.TypeVarTuple.evaluate_default()</span></code></a>, the default value of\ntype variable tuples</p></li>\n</ul>\n<p><em>owner</em> is the object that owns the evaluate function, such as the type\nalias or type variable object.</p>\n<p><em>format</em> can be used to control the format in which the value is returned:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">type</span> <span class=\"n\">Alias</span> <span class=\"o\">=</span> <span class=\"n\">undefined</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">call_evaluate_function</span><span class=\"p\">(</span><span class=\"n\">Alias</span><span class=\"o\">.</span><span class=\"n\">evaluate_value</span><span class=\"p\">,</span> <span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">VALUE</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"c\">...</span>\n<span class=\"gr\">NameError</span>: <span class=\"n\">name &#39;undefined&#39; is not defined</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">call_evaluate_function</span><span class=\"p\">(</span><span class=\"n\">Alias</span><span class=\"o\">.</span><span class=\"n\">evaluate_value</span><span class=\"p\">,</span> <span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">FORWARDREF</span><span class=\"p\">)</span>\n<span class=\"go\">ForwardRef(&#39;undefined&#39;)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">call_evaluate_function</span><span class=\"p\">(</span><span class=\"n\">Alias</span><span class=\"o\">.</span><span class=\"n\">evaluate_value</span><span class=\"p\">,</span> <span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">)</span>\n<span class=\"go\">&#39;undefined&#39;</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.get_annotate_from_class_namespace\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">get_annotate_from_class_namespace</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">namespace</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.get_annotate_from_class_namespace\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Retrieve the <a class=\"reference internal\" href=\"../glossary.html#term-annotate-function\"><span class=\"xref std std-term\">annotate function</span></a> from a class namespace dictionary <em>namespace</em>.\nReturn <code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code> if the namespace does not contain an annotate function.\nThis is primarily useful before the class has been fully created (e.g., in a metaclass);\nafter the class exists, the annotate function can be retrieved with <code class=\"docutils literal notranslate\"><span class=\"pre\">cls.__annotate__</span></code>.\nSee <a class=\"reference internal\" href=\"#annotationlib-metaclass\"><span class=\"std std-ref\">below</span></a> for an example using this function in a metaclass.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.get_annotations\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">get_annotations</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">obj</span></span></em>, <em class=\"sig-param\"><span class=\"keyword-only-separator o\"><abbr title=\"Keyword-only parameters separator (PEP 3102)\"><span class=\"pre\">*</span></abbr></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">globals</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">locals</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">eval_str</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">False</span></span></em>, <em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">format</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">Format.VALUE</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.get_annotations\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Compute the annotations dict for an object.</p>\n<p><em>obj</em> may be a callable, class, module, or other object with\n<a class=\"reference internal\" href=\"../reference/datamodel.html#object.__annotate__\" title=\"object.__annotate__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__annotate__</span></code></a> or <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__annotations__\" title=\"object.__annotations__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__annotations__</span></code></a> attributes.\nPassing any other object raises <a class=\"reference internal\" href=\"exceptions.html#TypeError\" title=\"TypeError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">TypeError</span></code></a>.</p>\n<p>The <em>format</em> parameter controls the format in which annotations are returned,\nand must be a member of the <a class=\"reference internal\" href=\"#annotationlib.Format\" title=\"annotationlib.Format\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Format</span></code></a> enum or its integer equivalent.\nThe different formats work as follows:</p>\n<ul class=\"simple\">\n<li><p>VALUE: <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotations__</span></code> is tried first; if that does not exist,\nthe <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotate__</span></code> function is called if it exists.</p></li>\n<li><p>FORWARDREF: If <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotations__</span></code> exists and can be evaluated successfully,\nit is used; otherwise, the <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotate__</span></code> function is called. If it\ndoes not exist either, <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotations__</span></code> is tried again and any error\nfrom accessing it is re-raised.</p>\n<ul>\n<li><p>When calling <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotate__</span></code> it is first called with <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a>.\nIf this is not implemented, it will then check if <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\" title=\"annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE_WITH_FAKE_GLOBALS</span></code></a>\nis supported and use that in the fake globals environment.\nIf neither of these formats are supported, it will fall back to using <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a>.\nIf <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a> fails, the error from this call will be raised.</p></li>\n</ul>\n</li>\n<li><p>STRING: If <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotate__</span></code> exists, it is called first;\notherwise, <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotations__</span></code> is used and stringified\nusing <a class=\"reference internal\" href=\"#annotationlib.annotations_to_string\" title=\"annotationlib.annotations_to_string\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">annotations_to_string()</span></code></a>.</p>\n<ul>\n<li><p>When calling <code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">object.__annotate__</span></code> it is first called with <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a>.\nIf this is not implemented, it will then check if <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\" title=\"annotationlib.Format.VALUE_WITH_FAKE_GLOBALS\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE_WITH_FAKE_GLOBALS</span></code></a>\nis supported and use that in the fake globals environment.\nIf neither of these formats are supported, it will fall back to using <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a>\nwith the result converted using <a class=\"reference internal\" href=\"#annotationlib.annotations_to_string\" title=\"annotationlib.annotations_to_string\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">annotations_to_string()</span></code></a>.\nIf <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">VALUE</span></code></a> fails, the error from this call will be raised.</p></li>\n</ul>\n</li>\n</ul>\n<p>Returns a dict. <code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code> returns a new dict every time\nit’s called; calling it twice on the same object will return two\ndifferent but equivalent dicts.</p>\n<p>This function handles several details for you:</p>\n<ul class=\"simple\">\n<li><p>If <em>eval_str</em> is true, values of type <code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">str</span></code> will\nbe un-stringized using <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a>. This is intended\nfor use with stringized annotations\n(<code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code>). It is an error\nto set <em>eval_str</em> to true with formats other than <a class=\"reference internal\" href=\"#annotationlib.Format.VALUE\" title=\"annotationlib.Format.VALUE\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Format.VALUE</span></code></a>.</p></li>\n<li><p>If <em>obj</em> doesn’t have an annotations dict, returns an\nempty dict. (Functions and methods always have an\nannotations dict; classes, modules, and other types of\ncallables may not.)</p></li>\n<li><p>Ignores inherited annotations on classes, as well as annotations\non metaclasses. If a class\ndoesn’t have its own annotations dict, returns an empty dict.</p></li>\n<li><p>All accesses to object members and dict values are done\nusing <code class=\"docutils literal notranslate\"><span class=\"pre\">getattr()</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">dict.get()</span></code> for safety.</p></li>\n</ul>\n<p><em>eval_str</em> controls whether or not values of type <code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">str</span></code> are\nreplaced with the result of calling <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a> on those values:</p>\n<ul class=\"simple\">\n<li><p>If eval_str is true, <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a> is called on values of type\n<code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">str</span></code>. (Note that <code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code> doesn’t catch\nexceptions; if <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a> raises an exception, it will unwind\nthe stack past the <code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code> call.)</p></li>\n<li><p>If <em>eval_str</em> is false (the default), values of type <code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">str</span></code> are\nunchanged.</p></li>\n</ul>\n<p><em>globals</em> and <em>locals</em> are passed in to <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a>; see the documentation\nfor <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a> for more information. If <em>globals</em> or <em>locals</em>\nis <code class=\"xref py py-const docutils literal notranslate\"><span class=\"pre\">None</span></code>, this function may replace that value with a\ncontext-specific default, contingent on <code class=\"docutils literal notranslate\"><span class=\"pre\">type(obj)</span></code>:</p>\n<ul class=\"simple\">\n<li><p>If <em>obj</em> is a module, <em>globals</em> defaults to <code class=\"docutils literal notranslate\"><span class=\"pre\">obj.__dict__</span></code>.</p></li>\n<li><p>If <em>obj</em> is a class, <em>globals</em> defaults to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">sys.modules[obj.__module__].__dict__</span></code> and <em>locals</em> defaults\nto the <em>obj</em> class namespace.</p></li>\n<li><p>If <em>obj</em> is a callable, <em>globals</em> defaults to\n<a class=\"reference internal\" href=\"../reference/datamodel.html#function.__globals__\" title=\"function.__globals__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">obj.__globals__</span></code></a>,\nalthough if <em>obj</em> is a wrapped function (using\n<a class=\"reference internal\" href=\"functools.html#functools.update_wrapper\" title=\"functools.update_wrapper\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">functools.update_wrapper()</span></code></a>) or a <a class=\"reference internal\" href=\"functools.html#functools.partial\" title=\"functools.partial\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">functools.partial</span></code></a> object,\nit is unwrapped until a non-wrapped function is found.</p></li>\n</ul>\n<p>Calling <code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code> is best practice for accessing the\nannotations dict of any object. See <a class=\"reference internal\" href=\"../howto/annotations.html#annotations-howto\"><span class=\"std std-ref\">Annotations Best Practices</span></a> for\nmore information on annotations best practices.</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">f</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">float</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">)</span>\n<span class=\"go\">{&#39;a&#39;: &lt;class &#39;int&#39;&gt;, &#39;b&#39;: &lt;class &#39;str&#39;&gt;, &#39;return&#39;: &lt;class &#39;float&#39;&gt;}</span>\n</pre></div>\n</div>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n<dl class=\"py function\">\n<dt class=\"sig sig-object py\" id=\"annotationlib.type_repr\">\n<span class=\"sig-prename descclassname\"><span class=\"pre\">annotationlib.</span></span><span class=\"sig-name descname\"><span class=\"pre\">type_repr</span></span><span class=\"sig-paren\">(</span><em class=\"sig-param\"><span class=\"n\"><span class=\"pre\">value</span></span></em><span class=\"sig-paren\">)</span><a class=\"headerlink\" href=\"#annotationlib.type_repr\" title=\"Link to this definition\">¶</a></dt>\n<dd><p>Convert an arbitrary Python value to a format suitable for use by the\n<a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> format. This calls <a class=\"reference internal\" href=\"functions.html#repr\" title=\"repr\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">repr()</span></code></a> for most\nobjects, but has special handling for some objects, such as type objects.</p>\n<p>This is meant as a helper for user-provided\nannotate functions that support the <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> format but\ndo not have access to the code creating the annotations. It can also\nbe used to provide a user-friendly string representation for other\nobjects that contain values that are commonly encountered in annotations.</p>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.14.</span></p>\n</div>\n</dd></dl>\n\n</section>\n<section id=\"recipes\">\n<h2>Recipes<a class=\"headerlink\" href=\"#recipes\" title=\"Link to this heading\">¶</a></h2>\n<section id=\"using-annotations-in-a-metaclass\">\n<span id=\"annotationlib-metaclass\"></span><h3>Using annotations in a metaclass<a class=\"headerlink\" href=\"#using-annotations-in-a-metaclass\" title=\"Link to this heading\">¶</a></h3>\n<p>A <a class=\"reference internal\" href=\"../reference/datamodel.html#metaclasses\"><span class=\"std std-ref\">metaclass</span></a> may want to inspect or even modify the annotations\nin a class body during class creation. Doing so requires retrieving annotations\nfrom the class namespace dictionary. For classes created with\n<code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">__future__</span> <span class=\"pre\">import</span> <span class=\"pre\">annotations</span></code>, the annotations will be in the <code class=\"docutils literal notranslate\"><span class=\"pre\">__annotations__</span></code>\nkey of the dictionary. For other classes with annotations,\n<a class=\"reference internal\" href=\"#annotationlib.get_annotate_from_class_namespace\" title=\"annotationlib.get_annotate_from_class_namespace\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotate_from_class_namespace()</span></code></a> can be used to get the\nannotate function, and <a class=\"reference internal\" href=\"#annotationlib.call_annotate_function\" title=\"annotationlib.call_annotate_function\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">call_annotate_function()</span></code></a> can be used to call it and\nretrieve the annotations. Using the <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> format will usually\nbe best, because this allows the annotations to refer to names that cannot yet be\nresolved when the class is created.</p>\n<p>To modify the annotations, it is best to create a wrapper annotate function\nthat calls the original annotate function, makes any necessary adjustments, and\nreturns the result.</p>\n<p>Below is an example of a metaclass that filters out all <a class=\"reference internal\" href=\"typing.html#typing.ClassVar\" title=\"typing.ClassVar\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">typing.ClassVar</span></code></a>\nannotations from the class and puts them in a separate attribute:</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">annotationlib</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">typing</span>\n\n<span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ClassVarSeparator</span><span class=\"p\">(</span><span class=\"nb\">type</span><span class=\"p\">):</span>\n   <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"n\">mcls</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">bases</span><span class=\"p\">,</span> <span class=\"n\">ns</span><span class=\"p\">):</span>\n      <span class=\"k\">if</span> <span class=\"s2\">&quot;__annotations__&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">ns</span><span class=\"p\">:</span>  <span class=\"c1\"># from __future__ import annotations</span>\n         <span class=\"n\">annotations</span> <span class=\"o\">=</span> <span class=\"n\">ns</span><span class=\"p\">[</span><span class=\"s2\">&quot;__annotations__&quot;</span><span class=\"p\">]</span>\n         <span class=\"n\">classvar_keys</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"n\">key</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">annotations</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n            <span class=\"c1\"># Use string comparison for simplicity; a more robust solution</span>\n            <span class=\"c1\"># could use annotationlib.ForwardRef.evaluate</span>\n            <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;ClassVar&quot;</span><span class=\"p\">)</span>\n         <span class=\"p\">}</span>\n         <span class=\"n\">classvars</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">key</span><span class=\"p\">:</span> <span class=\"n\">annotations</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"n\">classvar_keys</span><span class=\"p\">}</span>\n         <span class=\"n\">ns</span><span class=\"p\">[</span><span class=\"s2\">&quot;__annotations__&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"n\">key</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">annotations</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">classvar_keys</span>\n         <span class=\"p\">}</span>\n         <span class=\"n\">wrapped_annotate</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n      <span class=\"k\">elif</span> <span class=\"n\">annotate</span> <span class=\"o\">:=</span> <span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">get_annotate_from_class_namespace</span><span class=\"p\">(</span><span class=\"n\">ns</span><span class=\"p\">):</span>\n         <span class=\"n\">annotations</span> <span class=\"o\">=</span> <span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">call_annotate_function</span><span class=\"p\">(</span>\n            <span class=\"n\">annotate</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">FORWARDREF</span>\n         <span class=\"p\">)</span>\n         <span class=\"n\">classvar_keys</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"n\">key</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">annotations</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">typing</span><span class=\"o\">.</span><span class=\"n\">get_origin</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">is</span> <span class=\"n\">typing</span><span class=\"o\">.</span><span class=\"n\">ClassVar</span>\n         <span class=\"p\">}</span>\n         <span class=\"n\">classvars</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">key</span><span class=\"p\">:</span> <span class=\"n\">annotations</span><span class=\"p\">[</span><span class=\"n\">key</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"n\">classvar_keys</span><span class=\"p\">}</span>\n\n         <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">wrapped_annotate</span><span class=\"p\">(</span><span class=\"nb\">format</span><span class=\"p\">):</span>\n            <span class=\"n\">annos</span> <span class=\"o\">=</span> <span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">call_annotate_function</span><span class=\"p\">(</span><span class=\"n\">annotate</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"p\">,</span> <span class=\"n\">owner</span><span class=\"o\">=</span><span class=\"n\">typ</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"p\">{</span><span class=\"n\">key</span><span class=\"p\">:</span> <span class=\"n\">value</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">annos</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">classvar_keys</span><span class=\"p\">}</span>\n\n      <span class=\"k\">else</span><span class=\"p\">:</span>  <span class=\"c1\"># no annotations</span>\n         <span class=\"n\">classvars</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n         <span class=\"n\">wrapped_annotate</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n      <span class=\"n\">typ</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"n\">mcls</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">bases</span><span class=\"p\">,</span> <span class=\"n\">ns</span><span class=\"p\">)</span>\n\n      <span class=\"k\">if</span> <span class=\"n\">wrapped_annotate</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n         <span class=\"c1\"># Wrap the original __annotate__ with a wrapper that removes ClassVars</span>\n         <span class=\"n\">typ</span><span class=\"o\">.</span><span class=\"n\">__annotate__</span> <span class=\"o\">=</span> <span class=\"n\">wrapped_annotate</span>\n      <span class=\"n\">typ</span><span class=\"o\">.</span><span class=\"n\">classvars</span> <span class=\"o\">=</span> <span class=\"n\">classvars</span>  <span class=\"c1\"># Store the ClassVars in a separate attribute</span>\n      <span class=\"k\">return</span> <span class=\"n\">typ</span>\n</pre></div>\n</div>\n</section>\n</section>\n<section id=\"limitations-of-the-string-format\">\n<h2>Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">STRING</span></code> format<a class=\"headerlink\" href=\"#limitations-of-the-string-format\" title=\"Link to this heading\">¶</a></h2>\n<p>The <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> format is meant to approximate the source code\nof the annotation, but the implementation strategy used means that it is not\nalways possible to recover the exact source code.</p>\n<p>First, the stringifier of course cannot recover any information that is not present in\nthe compiled code, including comments, whitespace, parenthesization, and operations that\nget simplified by the compiler.</p>\n<p>Second, the stringifier can intercept almost all operations that involve names looked\nup in some scope, but it cannot intercept operations that operate fully on constants.\nAs a corollary, this also means it is not safe to request the <code class=\"docutils literal notranslate\"><span class=\"pre\">STRING</span></code> format on\nuntrusted code: Python is powerful enough that it is possible to achieve arbitrary\ncode execution even with no access to any globals or builtins. For example:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">f</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"n\">__base__</span><span class=\"o\">.</span><span class=\"n\">__subclasses__</span><span class=\"p\">()[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"o\">.</span><span class=\"n\">__builtins__</span><span class=\"p\">[</span><span class=\"s2\">&quot;print&quot;</span><span class=\"p\">](</span><span class=\"s2\">&quot;Hello world&quot;</span><span class=\"p\">)):</span> <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">annotationlib</span><span class=\"o\">.</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">)</span>\n<span class=\"go\">Hello world</span>\n<span class=\"go\">{&#39;x&#39;: &#39;None&#39;}</span>\n</pre></div>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>This particular example works as of the time of writing, but it relies on\nimplementation details and is not guaranteed to work in the future.</p>\n</div>\n<p>Among the different kinds of expressions that exist in Python,\nas represented by the <a class=\"reference internal\" href=\"ast.html#module-ast\" title=\"ast: Abstract Syntax Tree classes and manipulation.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">ast</span></code></a> module, some expressions are supported,\nmeaning that the <code class=\"docutils literal notranslate\"><span class=\"pre\">STRING</span></code> format can generally recover the original source code;\nothers are unsupported, meaning that they may result in incorrect output or an error.</p>\n<p>The following are supported (sometimes with caveats):</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.BinOp\" title=\"ast.BinOp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.BinOp</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.UnaryOp\" title=\"ast.UnaryOp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.UnaryOp</span></code></a></p>\n<ul>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Invert\" title=\"ast.Invert\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Invert</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">~</span></code>), <a class=\"reference internal\" href=\"ast.html#ast.UAdd\" title=\"ast.UAdd\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.UAdd</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">+</span></code>), and <a class=\"reference internal\" href=\"ast.html#ast.USub\" title=\"ast.USub\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.USub</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">-</span></code>) are supported</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Not\" title=\"ast.Not\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Not</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">not</span></code>) is not supported</p></li>\n</ul>\n</li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Dict\" title=\"ast.Dict\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Dict</span></code></a> (except when using <code class=\"docutils literal notranslate\"><span class=\"pre\">**</span></code> unpacking)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Set\" title=\"ast.Set\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Set</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Compare\" title=\"ast.Compare\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Compare</span></code></a></p>\n<ul>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Eq\" title=\"ast.Eq\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Eq</span></code></a> and <a class=\"reference internal\" href=\"ast.html#ast.NotEq\" title=\"ast.NotEq\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.NotEq</span></code></a> are supported</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Lt\" title=\"ast.Lt\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Lt</span></code></a>, <a class=\"reference internal\" href=\"ast.html#ast.LtE\" title=\"ast.LtE\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.LtE</span></code></a>, <a class=\"reference internal\" href=\"ast.html#ast.Gt\" title=\"ast.Gt\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Gt</span></code></a>, and <a class=\"reference internal\" href=\"ast.html#ast.GtE\" title=\"ast.GtE\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.GtE</span></code></a> are supported, but the operand may be flipped</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Is\" title=\"ast.Is\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Is</span></code></a>, <a class=\"reference internal\" href=\"ast.html#ast.IsNot\" title=\"ast.IsNot\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.IsNot</span></code></a>, <a class=\"reference internal\" href=\"ast.html#ast.In\" title=\"ast.In\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.In</span></code></a>, and <a class=\"reference internal\" href=\"ast.html#ast.NotIn\" title=\"ast.NotIn\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.NotIn</span></code></a> are not supported</p></li>\n</ul>\n</li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Call\" title=\"ast.Call\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Call</span></code></a> (except when using <code class=\"docutils literal notranslate\"><span class=\"pre\">**</span></code> unpacking)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Constant\" title=\"ast.Constant\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Constant</span></code></a> (though not the exact representation of the constant; for example, escape\nsequences in strings are lost; hexadecimal numbers are converted to decimal)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Attribute\" title=\"ast.Attribute\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Attribute</span></code></a> (assuming the value is not a constant)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Subscript\" title=\"ast.Subscript\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Subscript</span></code></a> (assuming the value is not a constant)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Starred\" title=\"ast.Starred\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Starred</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">*</span></code> unpacking)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Name\" title=\"ast.Name\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Name</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.List\" title=\"ast.List\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.List</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Tuple\" title=\"ast.Tuple\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Tuple</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Slice\" title=\"ast.Slice\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Slice</span></code></a></p></li>\n</ul>\n<p>The following are unsupported, but throw an informative error when encountered by the\nstringifier:</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.FormattedValue\" title=\"ast.FormattedValue\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.FormattedValue</span></code></a> (f-strings; error is not detected if conversion specifiers like <code class=\"docutils literal notranslate\"><span class=\"pre\">!r</span></code>\nare used)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.JoinedStr\" title=\"ast.JoinedStr\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.JoinedStr</span></code></a> (f-strings)</p></li>\n</ul>\n<p>The following are unsupported and result in incorrect output:</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.BoolOp\" title=\"ast.BoolOp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.BoolOp</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">and</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">or</span></code>)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.IfExp\" title=\"ast.IfExp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.IfExp</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Lambda\" title=\"ast.Lambda\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Lambda</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.ListComp\" title=\"ast.ListComp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.ListComp</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.SetComp\" title=\"ast.SetComp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.SetComp</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.DictComp\" title=\"ast.DictComp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.DictComp</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.GeneratorExp\" title=\"ast.GeneratorExp\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.GeneratorExp</span></code></a></p></li>\n</ul>\n<p>The following are disallowed in annotation scopes and therefore not relevant:</p>\n<ul class=\"simple\">\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.NamedExpr\" title=\"ast.NamedExpr\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.NamedExpr</span></code></a> (<code class=\"docutils literal notranslate\"><span class=\"pre\">:=</span></code>)</p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Await\" title=\"ast.Await\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Await</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.Yield\" title=\"ast.Yield\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.Yield</span></code></a></p></li>\n<li><p><a class=\"reference internal\" href=\"ast.html#ast.YieldFrom\" title=\"ast.YieldFrom\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ast.YieldFrom</span></code></a></p></li>\n</ul>\n</section>\n<section id=\"limitations-of-the-forwardref-format\">\n<h2>Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code> format<a class=\"headerlink\" href=\"#limitations-of-the-forwardref-format\" title=\"Link to this heading\">¶</a></h2>\n<p>The <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> format aims to produce real values as much\nas possible, with anything that cannot be resolved replaced with\n<a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> objects. It is affected by broadly the same Limitations\nas the <a class=\"reference internal\" href=\"#annotationlib.Format.STRING\" title=\"annotationlib.Format.STRING\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">STRING</span></code></a> format: annotations that perform operations on\nliterals or that use unsupported expression types may raise exceptions when\nevaluated using the <a class=\"reference internal\" href=\"#annotationlib.Format.FORWARDREF\" title=\"annotationlib.Format.FORWARDREF\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code></a> format.</p>\n<p>Below are a few examples of the behavior with unsupported expressions:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">annotationlib</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">get_annotations</span><span class=\"p\">,</span> <span class=\"n\">Format</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">zerodiv</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"mi\">1</span> <span class=\"o\">/</span> <span class=\"mi\">0</span><span class=\"p\">):</span> <span class=\"o\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">zerodiv</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">  </span><span class=\"c\">...</span>\n<span class=\"gr\">ZeroDivisionError</span>: <span class=\"n\">division by zero</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">zerodiv</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">FORWARDREF</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">  </span><span class=\"c\">...</span>\n<span class=\"gr\">ZeroDivisionError</span>: <span class=\"n\">division by zero</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">ifexp</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"mi\">1</span> <span class=\"k\">if</span> <span class=\"n\">y</span> <span class=\"k\">else</span> <span class=\"mi\">0</span><span class=\"p\">):</span> <span class=\"o\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">get_annotations</span><span class=\"p\">(</span><span class=\"n\">ifexp</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"n\">Format</span><span class=\"o\">.</span><span class=\"n\">STRING</span><span class=\"p\">)</span>\n<span class=\"go\">{&#39;x&#39;: &#39;1&#39;}</span>\n</pre></div>\n</div>\n</section>\n<section id=\"security-implications-of-introspecting-annotations\">\n<span id=\"annotationlib-security\"></span><h2>Security implications of introspecting annotations<a class=\"headerlink\" href=\"#security-implications-of-introspecting-annotations\" title=\"Link to this heading\">¶</a></h2>\n<p>Much of the functionality in this module involves executing code related to annotations,\nwhich can then do arbitrary things. For example,\n<a class=\"reference internal\" href=\"#annotationlib.get_annotations\" title=\"annotationlib.get_annotations\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">get_annotations()</span></code></a> may call an arbitrary <a class=\"reference internal\" href=\"../glossary.html#term-annotate-function\"><span class=\"xref std std-term\">annotate function</span></a>, and\n<a class=\"reference internal\" href=\"#annotationlib.ForwardRef.evaluate\" title=\"annotationlib.ForwardRef.evaluate\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">ForwardRef.evaluate()</span></code></a> may call <a class=\"reference internal\" href=\"functions.html#eval\" title=\"eval\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">eval()</span></code></a> on an arbitrary string. Code contained\nin an annotation might make arbitrary system calls, enter an infinite loop, or perform any\nother operation. This is also true for any access of the <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__annotations__\" title=\"object.__annotations__\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">__annotations__</span></code></a> attribute,\nand for various functions in the <a class=\"reference internal\" href=\"typing.html#module-typing\" title=\"typing: Support for type hints (see :pep:`484`).\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">typing</span></code></a> module that work with annotations, such as\n<a class=\"reference internal\" href=\"typing.html#typing.get_type_hints\" title=\"typing.get_type_hints\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">typing.get_type_hints()</span></code></a>.</p>\n<p>Any security issue arising from this also applies immediately after importing\ncode that may contain untrusted annotations: importing code can always cause arbitrary operations\nto be performed. However, it is unsafe to accept strings or other input from an untrusted source and\npass them to any of the APIs for introspecting annotations, for example by editing an\n<code class=\"docutils literal notranslate\"><span class=\"pre\">__annotations__</span></code> dictionary or directly creating a <a class=\"reference internal\" href=\"#annotationlib.ForwardRef\" title=\"annotationlib.ForwardRef\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ForwardRef</span></code></a> object.</p>\n</section>\n</section>\n\n\n            <div class=\"clearer\"></div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sphinxsidebar\" role=\"navigation\" aria-label=\"Main\">\n        <div class=\"sphinxsidebarwrapper\">\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> — Functionality for introspecting annotations</a><ul>\n<li><a class=\"reference internal\" href=\"#annotation-semantics\">Annotation semantics</a></li>\n<li><a class=\"reference internal\" href=\"#classes\">Classes</a></li>\n<li><a class=\"reference internal\" href=\"#functions\">Functions</a></li>\n<li><a class=\"reference internal\" href=\"#recipes\">Recipes</a><ul>\n<li><a class=\"reference internal\" href=\"#using-annotations-in-a-metaclass\">Using annotations in a metaclass</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#limitations-of-the-string-format\">Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">STRING</span></code> format</a></li>\n<li><a class=\"reference internal\" href=\"#limitations-of-the-forwardref-format\">Limitations of the <code class=\"docutils literal notranslate\"><span class=\"pre\">FORWARDREF</span></code> format</a></li>\n<li><a class=\"reference internal\" href=\"#security-implications-of-introspecting-annotations\">Security implications of introspecting annotations</a></li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"inspect.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">inspect</span></code> — Inspect live objects</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"site.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">site</span></code> — Site-specific configuration hook</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/annotationlib.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </div>\n<div id=\"sidebarbutton\" title=\"Collapse sidebar\">\n<span>«</span>\n</div>\n\n      </div>\n      <div class=\"clearer\"></div>\n    </div>  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             >index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"site.html\" title=\"site — Site-specific configuration hook\"\n             >next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"inspect.html\" title=\"inspect — Inspect live objects\"\n             >previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"python.html\" >Python Runtime Services</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">annotationlib</span></code> — Functionality for introspecting annotations</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>  \n    <div class=\"footer\">\n    &copy; <a href=\"../copyright.html\">Copyright</a> 2001 Python Software Foundation.\n    <br>\n    This page is licensed under the Python Software Foundation License Version 2.\n    <br>\n    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.\n    <br>\n    \n      See <a href=\"/license.html\">History and License</a> for more information.<br>\n    \n    \n    <br>\n\n    The Python Software Foundation is a non-profit corporation.\n<a href=\"https://www.python.org/psf/donations/\">Please donate.</a>\n<br>\n    <br>\n      Last updated on Nov 25, 2025 (18:01 UTC).\n    \n      <a href=\"/bugs.html\">Found a bug</a>?\n    \n    <br>\n\n    Created using <a href=\"https://www.sphinx-doc.org/\">Sphinx</a> 8.2.3.\n    </div>\n\n    <script type=\"text/javascript\" src=\"../_static/switchers.js\"></script>\n  </body>\n</html>",
  "metadata": {
    "title": "annotationlib — Functionality for introspecting annotations — Python 3.14.0 documentation",
    "meta_description": "Source code: Lib/annotationlib.py The annotationlib module provides tools for introspecting annotations on modules, classes, and functions. Annotations are lazily evaluated and often contain forwar...",
    "h1": "— Functionality for introspecting annotations"
  },
  "request_headers": {
    "Referer": "https://docs.python.org/3/library/",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en",
    "User-Agent": "DumbCrawler/1.0",
    "Accept-Encoding": "gzip, deflate"
  },
  "response_headers": {
    "Content-Length": "16416",
    "Server": "nginx",
    "Content-Type": "text/html",
    "Last-Modified": "Tue, 25 Nov 2025 18:03:26 GMT",
    "Etag": "\"6925ef6e-193e5\"",
    "X-Clacks-Overhead": "GNU Terry Pratchett",
    "Strict-Transport-Security": "max-age=315360000; includeSubDomains; preload",
    "Via": "1.1 varnish, 1.1 varnish",
    "Accept-Ranges": "bytes",
    "Age": "3752",
    "Date": "Wed, 26 Nov 2025 05:32:30 GMT",
    "X-Served-By": "cache-lga21920-LGA, cache-yul1970070-YUL",
    "X-Cache": "HIT, HIT",
    "X-Cache-Hits": "264, 0",
    "X-Timer": "S1764135150.085087,VS0,VE1",
    "Vary": "Accept-Encoding"
  },
  "crawled_at": "2025-11-26T05:32:30.498782+00:00",
  "crawler": {
    "name": "DumbCrawler",
    "version": "1.0",
    "mode": "crawl",
    "js_mode": "off",
    "scope": "subfolder"
  }
}