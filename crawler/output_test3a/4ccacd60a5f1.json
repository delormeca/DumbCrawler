{
  "url": "https://docs.python.org/3/library/unittest.mock-examples.html",
  "status_code": 200,
  "depth": 1,
  "referrer": "https://docs.python.org/3/library/",
  "raw_html": "<!DOCTYPE html>\n\n<html lang=\"en\" data-content_root=\"../\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<meta property=\"og:title\" content=\"unittest.mock — getting started\" />\n<meta property=\"og:type\" content=\"website\" />\n<meta property=\"og:url\" content=\"https://docs.python.org/3/library/unittest.mock-examples.html\" />\n<meta property=\"og:site_name\" content=\"Python documentation\" />\n<meta property=\"og:description\" content=\"Using Mock: Mock Patching Methods: Common uses for Mock objects include: Patching methods, Recording method calls on objects. You might want to replace a method on an object to check that it is cal...\" />\n<meta property=\"og:image:width\" content=\"1146\" />\n<meta property=\"og:image:height\" content=\"600\" />\n<meta property=\"og:image\" content=\"https://docs.python.org/3.14/_images/social_previews/summary_library_unittest.mock-examples_93153601.png\" />\n<meta property=\"og:image:alt\" content=\"Using Mock: Mock Patching Methods: Common uses for Mock objects include: Patching methods, Recording method calls on objects. You might want to replace a method on an object to check that it is cal...\" />\n<meta name=\"description\" content=\"Using Mock: Mock Patching Methods: Common uses for Mock objects include: Patching methods, Recording method calls on objects. You might want to replace a method on an object to check that it is cal...\" />\n<meta name=\"twitter:card\" content=\"summary_large_image\" />\n<meta name=\"theme-color\" content=\"#3776ab\">\n\n    <title>unittest.mock — getting started &#8212; Python 3.14.0 documentation</title><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    \n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments.css?v=b86133f3\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/classic.css?v=234b1a7c\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pydoctheme.css?v=8cd84f99\" />\n    <link id=\"pygments_dark_css\" media=\"(prefers-color-scheme: dark)\" rel=\"stylesheet\" type=\"text/css\" href=\"../_static/pygments_dark.css?v=5349f25f\" />\n    \n    <script src=\"../_static/documentation_options.js?v=e4f4b189\"></script>\n    <script src=\"../_static/doctools.js?v=9bcbadda\"></script>\n    <script src=\"../_static/sphinx_highlight.js?v=dc90522c\"></script>\n    \n    <script src=\"../_static/sidebar.js\"></script>\n    \n    <link rel=\"search\" type=\"application/opensearchdescription+xml\"\n          title=\"Search within Python 3.14.0 documentation\"\n          href=\"../_static/opensearch.xml\"/>\n    <link rel=\"author\" title=\"About these documents\" href=\"../about.html\" />\n    <link rel=\"index\" title=\"Index\" href=\"../genindex.html\" />\n    <link rel=\"search\" title=\"Search\" href=\"../search.html\" />\n    <link rel=\"copyright\" title=\"Copyright\" href=\"../copyright.html\" />\n    <link rel=\"next\" title=\"test — Regression tests package for Python\" href=\"test.html\" />\n    <link rel=\"prev\" title=\"unittest.mock — mock object library\" href=\"unittest.mock.html\" />\n    \n      \n      <script defer file-types=\"bz2,epub,zip\" data-domain=\"docs.python.org\" src=\"https://analytics.python.org/js/script.file-downloads.outbound-links.js\"></script>\n      \n      <link rel=\"canonical\" href=\"https://docs.python.org/3/library/unittest.mock-examples.html\">\n      \n    \n\n    \n    <style>\n      @media only screen {\n        table.full-width-table {\n            width: 100%;\n        }\n      }\n    </style>\n<link rel=\"stylesheet\" href=\"../_static/pydoctheme_dark.css\" media=\"(prefers-color-scheme: dark)\" id=\"pydoctheme_dark_css\">\n    <link rel=\"shortcut icon\" type=\"image/png\" href=\"../_static/py.svg\">\n            <script type=\"text/javascript\" src=\"../_static/copybutton.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/menu.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/search-focus.js\"></script>\n            <script type=\"text/javascript\" src=\"../_static/themetoggle.js\"></script> \n            <script type=\"text/javascript\" src=\"../_static/rtd_switcher.js\"></script>\n            <meta name=\"readthedocs-addons-api-version\" content=\"1\">\n\n  </head>\n<body>\n<div class=\"mobile-nav\">\n    <input type=\"checkbox\" id=\"menuToggler\" class=\"toggler__input\" aria-controls=\"navigation\"\n           aria-pressed=\"false\" aria-expanded=\"false\" role=\"button\" aria-label=\"Menu\">\n    <nav class=\"nav-content\" role=\"navigation\">\n        <label for=\"menuToggler\" class=\"toggler__label\">\n            <span></span>\n        </label>\n        <span class=\"nav-items-wrapper\">\n            <a href=\"https://www.python.org/\" class=\"nav-logo\">\n                <img src=\"../_static/py.svg\" alt=\"Python logo\">\n            </a>\n            <span class=\"version_switcher_placeholder\"></span>\n            <form role=\"search\" class=\"search\" action=\"../search.html\" method=\"get\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" class=\"search-icon\">\n                    <path fill-rule=\"nonzero\" fill=\"currentColor\" d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"></path>\n                </svg>\n                <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\">\n                <input type=\"submit\" value=\"Go\">\n            </form>\n        </span>\n    </nav>\n    <div class=\"menu-wrapper\">\n        <nav class=\"menu\" role=\"navigation\" aria-label=\"main navigation\">\n            <div class=\"language_switcher_placeholder\"></div>\n            \n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label>\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — getting started</a><ul>\n<li><a class=\"reference internal\" href=\"#using-mock\">Using Mock</a><ul>\n<li><a class=\"reference internal\" href=\"#mock-patching-methods\">Mock Patching Methods</a></li>\n<li><a class=\"reference internal\" href=\"#mock-for-method-calls-on-an-object\">Mock for Method Calls on an Object</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-classes\">Mocking Classes</a></li>\n<li><a class=\"reference internal\" href=\"#naming-your-mocks\">Naming your mocks</a></li>\n<li><a class=\"reference internal\" href=\"#tracking-all-calls\">Tracking all Calls</a></li>\n<li><a class=\"reference internal\" href=\"#setting-return-values-and-attributes\">Setting Return Values and Attributes</a></li>\n<li><a class=\"reference internal\" href=\"#raising-exceptions-with-mocks\">Raising exceptions with mocks</a></li>\n<li><a class=\"reference internal\" href=\"#side-effect-functions-and-iterables\">Side effect functions and iterables</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-asynchronous-iterators\">Mocking asynchronous iterators</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-asynchronous-context-manager\">Mocking asynchronous context manager</a></li>\n<li><a class=\"reference internal\" href=\"#creating-a-mock-from-an-existing-object\">Creating a Mock from an Existing Object</a></li>\n<li><a class=\"reference internal\" href=\"#using-side-effect-to-return-per-file-content\">Using side_effect to return per file content</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#patch-decorators\">Patch Decorators</a></li>\n<li><a class=\"reference internal\" href=\"#further-examples\">Further Examples</a><ul>\n<li><a class=\"reference internal\" href=\"#mocking-chained-calls\">Mocking chained calls</a></li>\n<li><a class=\"reference internal\" href=\"#partial-mocking\">Partial mocking</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-a-generator-method\">Mocking a Generator Method</a></li>\n<li><a class=\"reference internal\" href=\"#applying-the-same-patch-to-every-test-method\">Applying the same patch to every test method</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-unbound-methods\">Mocking Unbound Methods</a></li>\n<li><a class=\"reference internal\" href=\"#checking-multiple-calls-with-mock\">Checking multiple calls with mock</a></li>\n<li><a class=\"reference internal\" href=\"#coping-with-mutable-arguments\">Coping with mutable arguments</a></li>\n<li><a class=\"reference internal\" href=\"#nesting-patches\">Nesting Patches</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-a-dictionary-with-magicmock\">Mocking a dictionary with MagicMock</a></li>\n<li><a class=\"reference internal\" href=\"#mock-subclasses-and-their-attributes\">Mock subclasses and their attributes</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-imports-with-patch-dict\">Mocking imports with patch.dict</a></li>\n<li><a class=\"reference internal\" href=\"#tracking-order-of-calls-and-less-verbose-call-assertions\">Tracking order of calls and less verbose call assertions</a></li>\n<li><a class=\"reference internal\" href=\"#more-complex-argument-matching\">More complex argument matching</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"unittest.mock.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — mock object library</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"test.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">test</span></code> — Regression tests package for Python</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/unittest.mock-examples.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </nav>\n    </div>\n</div>\n\n  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             accesskey=\"I\">index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"test.html\" title=\"test — Regression tests package for Python\"\n             accesskey=\"N\">next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"unittest.mock.html\" title=\"unittest.mock — mock object library\"\n             accesskey=\"P\">previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"development.html\" accesskey=\"U\">Development Tools</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — getting started</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>    \n\n    <div class=\"document\">\n      <div class=\"documentwrapper\">\n        <div class=\"bodywrapper\">\n          <div class=\"body\" role=\"main\">\n            \n  <section id=\"unittest-mock-getting-started\">\n<h1><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — getting started<a class=\"headerlink\" href=\"#unittest-mock-getting-started\" title=\"Link to this heading\">¶</a></h1>\n<div class=\"versionadded\">\n<p><span class=\"versionmodified added\">Added in version 3.3.</span></p>\n</div>\n<span class=\"target\" id=\"getting-started\"></span><section id=\"using-mock\">\n<h2>Using Mock<a class=\"headerlink\" href=\"#using-mock\" title=\"Link to this heading\">¶</a></h2>\n<section id=\"mock-patching-methods\">\n<h3>Mock Patching Methods<a class=\"headerlink\" href=\"#mock-patching-methods\" title=\"Link to this heading\">¶</a></h3>\n<p>Common uses for <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> objects include:</p>\n<ul class=\"simple\">\n<li><p>Patching methods</p></li>\n<li><p>Recording method calls on objects</p></li>\n</ul>\n<p>You might want to replace a method on an object to check that\nit is called with the correct arguments by another part of the system:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span> <span class=\"o\">=</span> <span class=\"n\">SomeClass</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;method&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;MagicMock name=&#39;method()&#39; id=&#39;...&#39;&gt;</span>\n</pre></div>\n</div>\n<p>Once our mock has been used (<code class=\"docutils literal notranslate\"><span class=\"pre\">real.method</span></code> in this example) it has methods\nand attributes that allow you to make assertions about how it has been used.</p>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>In most of these examples the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> and <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.MagicMock\" title=\"unittest.mock.MagicMock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code></a> classes\nare interchangeable. As the <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> is the more capable class it makes\na sensible one to use by default.</p>\n</div>\n<p>Once the mock has been called its <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.called\" title=\"unittest.mock.Mock.called\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">called</span></code></a> attribute is set to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">True</span></code>. More importantly we can use the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_called_with\" title=\"unittest.mock.Mock.assert_called_with\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_called_with()</span></code></a> or\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_called_once_with\" title=\"unittest.mock.Mock.assert_called_once_with\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_called_once_with()</span></code></a> method to check that it was called with\nthe correct arguments.</p>\n<p>This example tests that calling <code class=\"docutils literal notranslate\"><span class=\"pre\">ProductionClass().method</span></code> results in a call to\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">something</span></code> method:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ProductionClass</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">method</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">something</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">something</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span> <span class=\"o\">=</span> <span class=\"n\">ProductionClass</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">something</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">something</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mock-for-method-calls-on-an-object\">\n<h3>Mock for Method Calls on an Object<a class=\"headerlink\" href=\"#mock-for-method-calls-on-an-object\" title=\"Link to this heading\">¶</a></h3>\n<p>In the last example we patched a method directly on an object to check that it\nwas called correctly. Another common use case is to pass an object into a\nmethod (or some part of the system under test) and then check that it is used\nin the correct way.</p>\n<p>The simple <code class=\"docutils literal notranslate\"><span class=\"pre\">ProductionClass</span></code> below has a <code class=\"docutils literal notranslate\"><span class=\"pre\">closer</span></code> method. If it is called with\nan object then it calls <code class=\"docutils literal notranslate\"><span class=\"pre\">close</span></code> on it.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ProductionClass</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">closer</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">something</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">something</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n</pre></div>\n</div>\n<p>So to test it we need to pass in an object with a <code class=\"docutils literal notranslate\"><span class=\"pre\">close</span></code> method and check\nthat it was called correctly.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span> <span class=\"o\">=</span> <span class=\"n\">ProductionClass</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">closer</span><span class=\"p\">(</span><span class=\"n\">mock</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">close</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>We don’t have to do any work to provide the ‘close’ method on our mock.\nAccessing close creates it. So, if ‘close’ hasn’t already been called then\naccessing it in the test will create it, but <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_called_with\" title=\"unittest.mock.Mock.assert_called_with\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_called_with()</span></code></a>\nwill raise a failure exception.</p>\n</section>\n<section id=\"mocking-classes\">\n<h3>Mocking Classes<a class=\"headerlink\" href=\"#mocking-classes\" title=\"Link to this heading\">¶</a></h3>\n<p>A common use case is to mock out classes instantiated by your code under test.\nWhen you patch a class, then that class is replaced with a mock. Instances\nare created by <em>calling the class</em>. This means you access the “mock instance”\nby looking at the return value of the mocked class.</p>\n<p>In the example below we have a function <code class=\"docutils literal notranslate\"><span class=\"pre\">some_function</span></code> that instantiates <code class=\"docutils literal notranslate\"><span class=\"pre\">Foo</span></code>\nand calls a method on it. The call to <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> replaces the class <code class=\"docutils literal notranslate\"><span class=\"pre\">Foo</span></code> with a\nmock. The <code class=\"docutils literal notranslate\"><span class=\"pre\">Foo</span></code> instance is the result of calling the mock, so it is configured\nby modifying the mock <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.return_value\" title=\"unittest.mock.Mock.return_value\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">return_value</span></code></a>.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">some_function</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;module.Foo&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">return_value</span>\n<span class=\"gp\">... </span>    <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;the result&#39;</span>\n<span class=\"gp\">... </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">some_function</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">result</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;the result&#39;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"naming-your-mocks\">\n<h3>Naming your mocks<a class=\"headerlink\" href=\"#naming-your-mocks\" title=\"Link to this heading\">¶</a></h3>\n<p>It can be useful to give your mocks a name. The name is shown in the repr of\nthe mock and can be helpful when the mock appears in test failure messages. The\nname is also propagated to attributes or methods of the mock:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span>\n<span class=\"go\">&lt;MagicMock name=&#39;foo&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">method</span>\n<span class=\"go\">&lt;MagicMock name=&#39;foo.method&#39; id=&#39;...&#39;&gt;</span>\n</pre></div>\n</div>\n</section>\n<section id=\"tracking-all-calls\">\n<h3>Tracking all Calls<a class=\"headerlink\" href=\"#tracking-all-calls\" title=\"Link to this heading\">¶</a></h3>\n<p>Often you want to track more than a single call to a method. The\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.mock_calls\" title=\"unittest.mock.Mock.mock_calls\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code></a> attribute records all calls\nto child attributes of the mock - and also to their children.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.method()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"mi\">53</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.attribute.method()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span>\n<span class=\"go\">[call.method(), call.attribute.method(10, x=53)]</span>\n</pre></div>\n</div>\n<p>If you make an assertion about <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code> and any unexpected methods\nhave been called, then the assertion will fail. This is useful because as well\nas asserting that the calls you expected have been made, you are also checking\nthat they were made in the right order and with no additional calls:</p>\n<p>You use the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.call\" title=\"unittest.mock.call\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">call</span></code></a> object to construct lists for comparing with\n<code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">expected</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">(),</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">=</span><span class=\"mi\">53</span><span class=\"p\">)]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span> <span class=\"o\">==</span> <span class=\"n\">expected</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>However, parameters to calls that return mocks are not recorded, which means it is not\npossible to track nested calls where the parameters used to create ancestors are important:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">factory</span><span class=\"p\">(</span><span class=\"n\">important</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">deliver</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.factory().deliver()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">factory</span><span class=\"p\">(</span><span class=\"n\">important</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">deliver</span><span class=\"p\">()</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n</section>\n<section id=\"setting-return-values-and-attributes\">\n<h3>Setting Return Values and Attributes<a class=\"headerlink\" href=\"#setting-return-values-and-attributes\" title=\"Link to this heading\">¶</a></h3>\n<p>Setting the return values on a mock object is trivially easy:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"go\">3</span>\n</pre></div>\n</div>\n<p>Of course you can do the same for methods on the mock:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n<span class=\"go\">3</span>\n</pre></div>\n</div>\n<p>The return value can also be set in the constructor:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"go\">3</span>\n</pre></div>\n</div>\n<p>If you need an attribute setting on your mock, just do it:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">x</span>\n<span class=\"go\">3</span>\n</pre></div>\n</div>\n<p>Sometimes you want to mock up a more complex situation, like for example\n<code class=\"docutils literal notranslate\"><span class=\"pre\">mock.connection.cursor().execute(&quot;SELECT</span> <span class=\"pre\">1&quot;)</span></code>. If we wanted this call to\nreturn a list, then we have to configure the result of the nested call.</p>\n<p>We can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.call\" title=\"unittest.mock.call\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">call</span></code></a> to construct the set of calls in a “chained call” like\nthis for easy assertion afterwards:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">cursor</span> <span class=\"o\">=</span> <span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">connection</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"o\">.</span><span class=\"n\">return_value</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">cursor</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">connection</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"s2\">&quot;SELECT 1&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">[&#39;foo&#39;]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">expected</span> <span class=\"o\">=</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">connection</span><span class=\"o\">.</span><span class=\"n\">cursor</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">execute</span><span class=\"p\">(</span><span class=\"s2\">&quot;SELECT 1&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">call_list</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span>\n<span class=\"go\">[call.connection.cursor(), call.connection.cursor().execute(&#39;SELECT 1&#39;)]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span> <span class=\"o\">==</span> <span class=\"n\">expected</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>It is the call to <code class=\"docutils literal notranslate\"><span class=\"pre\">.call_list()</span></code> that turns our call object into a list of\ncalls representing the chained calls.</p>\n</section>\n<section id=\"raising-exceptions-with-mocks\">\n<h3>Raising exceptions with mocks<a class=\"headerlink\" href=\"#raising-exceptions-with-mocks\" title=\"Link to this heading\">¶</a></h3>\n<p>A useful attribute is <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.side_effect\" title=\"unittest.mock.Mock.side_effect\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">side_effect</span></code></a>. If you set this to an\nexception class or instance then the exception will be raised when the mock\nis called.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"ne\">Exception</span><span class=\"p\">(</span><span class=\"s1\">&#39;Boom!&#39;</span><span class=\"p\">))</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">  </span><span class=\"c\">...</span>\n<span class=\"gr\">Exception</span>: <span class=\"n\">Boom!</span>\n</pre></div>\n</div>\n</section>\n<section id=\"side-effect-functions-and-iterables\">\n<h3>Side effect functions and iterables<a class=\"headerlink\" href=\"#side-effect-functions-and-iterables\" title=\"Link to this heading\">¶</a></h3>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> can also be set to a function or an iterable. The use case for\n<code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> as an iterable is where your mock is going to be called several\ntimes, and you want each call to return a different value. When you set\n<code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> to an iterable every call to the mock returns the next value\nfrom the iterable:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">])</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"go\">4</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"go\">5</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"go\">6</span>\n</pre></div>\n</div>\n<p>For more advanced use cases, like dynamically varying the return values\ndepending on what the mock is called with, <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> can be a function.\nThe function will be called with the same arguments as the mock. Whatever the\nfunction returns is what the call returns:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">vals</span> <span class=\"o\">=</span> <span class=\"p\">{(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">):</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">):</span> <span class=\"mi\">2</span><span class=\"p\">}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">side_effect</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"n\">vals</span><span class=\"p\">[</span><span class=\"n\">args</span><span class=\"p\">]</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"n\">side_effect</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"go\">1</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"go\">2</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mocking-asynchronous-iterators\">\n<h3>Mocking asynchronous iterators<a class=\"headerlink\" href=\"#mocking-asynchronous-iterators\" title=\"Link to this heading\">¶</a></h3>\n<p>Since Python 3.8, <code class=\"docutils literal notranslate\"><span class=\"pre\">AsyncMock</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> have support to mock\n<a class=\"reference internal\" href=\"../reference/datamodel.html#async-iterators\"><span class=\"std std-ref\">Asynchronous Iterators</span></a> through <code class=\"docutils literal notranslate\"><span class=\"pre\">__aiter__</span></code>. The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.return_value\" title=\"unittest.mock.Mock.return_value\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">return_value</span></code></a>\nattribute of <code class=\"docutils literal notranslate\"><span class=\"pre\">__aiter__</span></code> can be used to set the return values to be used for\niteration.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>  <span class=\"c1\"># AsyncMock also works here</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__aiter__</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">i</span> <span class=\"k\">async</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">mock</span><span class=\"p\">]</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">asyncio</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">())</span>\n<span class=\"go\">[1, 2, 3]</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mocking-asynchronous-context-manager\">\n<h3>Mocking asynchronous context manager<a class=\"headerlink\" href=\"#mocking-asynchronous-context-manager\" title=\"Link to this heading\">¶</a></h3>\n<p>Since Python 3.8, <code class=\"docutils literal notranslate\"><span class=\"pre\">AsyncMock</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> have support to mock\n<a class=\"reference internal\" href=\"../reference/datamodel.html#async-context-managers\"><span class=\"std std-ref\">Asynchronous Context Managers</span></a> through <code class=\"docutils literal notranslate\"><span class=\"pre\">__aenter__</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">__aexit__</span></code>.\nBy default, <code class=\"docutils literal notranslate\"><span class=\"pre\">__aenter__</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">__aexit__</span></code> are <code class=\"docutils literal notranslate\"><span class=\"pre\">AsyncMock</span></code> instances that\nreturn an async function.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">AsyncContextManager</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__aenter__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"bp\">self</span>\n<span class=\"gp\">... </span>    <span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__aexit__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">exc_type</span><span class=\"p\">,</span> <span class=\"n\">exc</span><span class=\"p\">,</span> <span class=\"n\">tb</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_instance</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">AsyncContextManager</span><span class=\"p\">())</span>  <span class=\"c1\"># AsyncMock also works here</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">async</span> <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"k\">async</span> <span class=\"k\">with</span> <span class=\"n\">mock_instance</span> <span class=\"k\">as</span> <span class=\"n\">result</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">asyncio</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">(</span><span class=\"n\">main</span><span class=\"p\">())</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_instance</span><span class=\"o\">.</span><span class=\"fm\">__aenter__</span><span class=\"o\">.</span><span class=\"n\">assert_awaited_once</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_instance</span><span class=\"o\">.</span><span class=\"fm\">__aexit__</span><span class=\"o\">.</span><span class=\"n\">assert_awaited_once</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n</section>\n<section id=\"creating-a-mock-from-an-existing-object\">\n<h3>Creating a Mock from an Existing Object<a class=\"headerlink\" href=\"#creating-a-mock-from-an-existing-object\" title=\"Link to this heading\">¶</a></h3>\n<p>One problem with over use of mocking is that it couples your tests to the\nimplementation of your mocks rather than your real code. Suppose you have a\nclass that implements <code class=\"docutils literal notranslate\"><span class=\"pre\">some_method</span></code>. In a test for another class, you\nprovide a mock of this object that <em>also</em> provides <code class=\"docutils literal notranslate\"><span class=\"pre\">some_method</span></code>. If later\nyou refactor the first class, so that it no longer has <code class=\"docutils literal notranslate\"><span class=\"pre\">some_method</span></code> - then\nyour tests will continue to pass even though your code is now broken!</p>\n<p><a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> allows you to provide an object as a specification for the mock,\nusing the <em>spec</em> keyword argument. Accessing methods / attributes on the\nmock that don’t exist on your specification object will immediately raise an\nattribute error. If you change the implementation of your specification, then\ntests that use that class will start failing immediately without you having to\ninstantiate the class in those tests.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">spec</span><span class=\"o\">=</span><span class=\"n\">SomeClass</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">old_method</span><span class=\"p\">()</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">   </span><span class=\"c\">...</span>\n<span class=\"gr\">AttributeError</span>: <span class=\"n\">Mock object has no attribute &#39;old_method&#39;. Did you mean: &#39;class_method&#39;?</span>\n</pre></div>\n</div>\n<p>Using a specification also enables a smarter matching of calls made to the\nmock, regardless of whether some parameters were passed as positional or\nnamed arguments:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">f</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"p\">):</span> <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">spec</span><span class=\"o\">=</span><span class=\"n\">f</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;Mock name=&#39;mock()&#39; id=&#39;140161580456576&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>If you want this smarter matching to also work with method calls on the mock,\nyou can use <a class=\"reference internal\" href=\"unittest.mock.html#auto-speccing\"><span class=\"std std-ref\">auto-speccing</span></a>.</p>\n<p>If you want a stronger form of specification that prevents the setting\nof arbitrary attributes as well as the getting of them then you can use\n<em>spec_set</em> instead of <em>spec</em>.</p>\n</section>\n<section id=\"using-side-effect-to-return-per-file-content\">\n<h3>Using side_effect to return per file content<a class=\"headerlink\" href=\"#using-side-effect-to-return-per-file-content\" title=\"Link to this heading\">¶</a></h3>\n<p><a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.mock_open\" title=\"unittest.mock.mock_open\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">mock_open()</span></code></a> is used to patch <a class=\"reference internal\" href=\"functions.html#open\" title=\"open\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">open()</span></code></a> method. <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.side_effect\" title=\"unittest.mock.Mock.side_effect\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">side_effect</span></code></a>\ncan be used to return a new Mock object per call. This can be used to return different\ncontents per file stored in a dictionary:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">DEFAULT</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;default&quot;</span>\n<span class=\"n\">data_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;file1&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;data1&quot;</span><span class=\"p\">,</span>\n             <span class=\"s2\">&quot;file2&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;data2&quot;</span><span class=\"p\">}</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">open_side_effect</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">mock_open</span><span class=\"p\">(</span><span class=\"n\">read_data</span><span class=\"o\">=</span><span class=\"n\">data_dict</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">DEFAULT</span><span class=\"p\">))()</span>\n\n<span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s2\">&quot;builtins.open&quot;</span><span class=\"p\">,</span> <span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"n\">open_side_effect</span><span class=\"p\">):</span>\n    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s2\">&quot;file1&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file1</span><span class=\"p\">:</span>\n        <span class=\"k\">assert</span> <span class=\"n\">file1</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;data1&quot;</span>\n\n    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s2\">&quot;file2&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file2</span><span class=\"p\">:</span>\n        <span class=\"k\">assert</span> <span class=\"n\">file2</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;data2&quot;</span>\n\n    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s2\">&quot;file3&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file2</span><span class=\"p\">:</span>\n        <span class=\"k\">assert</span> <span class=\"n\">file2</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;default&quot;</span>\n</pre></div>\n</div>\n</section>\n</section>\n<section id=\"patch-decorators\">\n<h2>Patch Decorators<a class=\"headerlink\" href=\"#patch-decorators\" title=\"Link to this heading\">¶</a></h2>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>With <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> it matters that you patch objects in the namespace where\nthey are looked up. This is normally straightforward, but for a quick guide\nread <a class=\"reference internal\" href=\"unittest.mock.html#where-to-patch\"><span class=\"std std-ref\">where to patch</span></a>.</p>\n</div>\n<p>A common need in tests is to patch a class attribute or a module attribute,\nfor example patching a builtin or patching a class in a module to test that it\nis instantiated. Modules and classes are effectively global, so patching on\nthem has to be undone after the test or the patch will persist into other\ntests and cause hard to diagnose problems.</p>\n<p>mock provides three convenient decorators for this: <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a>, <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.object\" title=\"unittest.mock.patch.object\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.object()</span></code></a> and\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.dict\" title=\"unittest.mock.patch.dict\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.dict()</span></code></a>. <code class=\"docutils literal notranslate\"><span class=\"pre\">patch</span></code> takes a single string, of the form\n<code class=\"docutils literal notranslate\"><span class=\"pre\">package.module.Class.attribute</span></code> to specify the attribute you are patching. It\nalso optionally takes a value that you want the attribute (or class or\nwhatever) to be replaced with. ‘patch.object’ takes an object and the name of\nthe attribute you would like patched, plus optionally the value to patch it\nwith.</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">patch.object</span></code>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">original</span> <span class=\"o\">=</span> <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@patch</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">(</span><span class=\"n\">SomeClass</span><span class=\"p\">,</span> <span class=\"s1\">&#39;attribute&#39;</span><span class=\"p\">,</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span> <span class=\"o\">==</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">test</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span> <span class=\"o\">==</span> <span class=\"n\">original</span>\n\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;package.module.attribute&#39;</span><span class=\"p\">,</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">package.module</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">attribute</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">attribute</span> <span class=\"ow\">is</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">test</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>If you are patching a module (including <a class=\"reference internal\" href=\"builtins.html#module-builtins\" title=\"builtins: The module that provides the built-in namespace.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">builtins</span></code></a>) then use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a>\ninstead of <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.object\" title=\"unittest.mock.patch.object\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.object()</span></code></a>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">file_handle</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;builtins.open&#39;</span><span class=\"p\">,</span> <span class=\"n\">mock</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"n\">handle</span> <span class=\"o\">=</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"s1\">&#39;filename&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;r&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"s1\">&#39;filename&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;r&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">handle</span> <span class=\"o\">==</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">file_handle</span><span class=\"p\">,</span> <span class=\"s2\">&quot;incorrect file handle returned&quot;</span>\n</pre></div>\n</div>\n<p>The module name can be ‘dotted’, in the form <code class=\"docutils literal notranslate\"><span class=\"pre\">package.module</span></code> if needed:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;package.module.ClassName.attribute&#39;</span><span class=\"p\">,</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test</span><span class=\"p\">():</span>\n<span class=\"gp\">... </span>    <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">package.module</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">ClassName</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">ClassName</span><span class=\"o\">.</span><span class=\"n\">attribute</span> <span class=\"o\">==</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">test</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>A nice pattern is to actually decorate test methods themselves:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"nd\">@patch</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">(</span><span class=\"n\">SomeClass</span><span class=\"p\">,</span> <span class=\"s1\">&#39;attribute&#39;</span><span class=\"p\">,</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_something</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertEqual</span><span class=\"p\">(</span><span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">,</span> <span class=\"n\">sentinel</span><span class=\"o\">.</span><span class=\"n\">attribute</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">original</span> <span class=\"o\">=</span> <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_something&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_something</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">attribute</span> <span class=\"o\">==</span> <span class=\"n\">original</span>\n</pre></div>\n</div>\n<p>If you want to patch with a Mock, you can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> with only one argument\n(or <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.object\" title=\"unittest.mock.patch.object\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.object()</span></code></a> with two arguments). The mock will be created for you and\npassed into the test function / method:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"nd\">@patch</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">(</span><span class=\"n\">SomeClass</span><span class=\"p\">,</span> <span class=\"s1\">&#39;static_method&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_something</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">mock_method</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">SomeClass</span><span class=\"o\">.</span><span class=\"n\">static_method</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>        <span class=\"n\">mock_method</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_something&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_something</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>You can stack up multiple patch decorators using this pattern:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"nd\">@patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;package.module.ClassName1&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"nd\">@patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;package.module.ClassName2&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_something</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">MockClass2</span><span class=\"p\">,</span> <span class=\"n\">MockClass1</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">package</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">ClassName1</span><span class=\"p\">,</span> <span class=\"n\">MockClass1</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">package</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">ClassName2</span><span class=\"p\">,</span> <span class=\"n\">MockClass2</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_something&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_something</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>When you nest patch decorators the mocks are passed in to the decorated\nfunction in the same order they applied (the normal <em>Python</em> order that\ndecorators are applied). This means from the bottom up, so in the example\nabove the mock for <code class=\"docutils literal notranslate\"><span class=\"pre\">test_module.ClassName2</span></code> is passed in first.</p>\n<p>There is also <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.dict\" title=\"unittest.mock.patch.dict\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.dict()</span></code></a> for setting values in a dictionary just\nduring a scope and restoring the dictionary to its original state when the test\nends:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">foo</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;key&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">original</span> <span class=\"o\">=</span> <span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"n\">foo</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;newkey&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;newvalue&#39;</span><span class=\"p\">},</span> <span class=\"n\">clear</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">foo</span> <span class=\"o\">==</span> <span class=\"p\">{</span><span class=\"s1\">&#39;newkey&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;newvalue&#39;</span><span class=\"p\">}</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">foo</span> <span class=\"o\">==</span> <span class=\"n\">original</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">patch</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">patch.object</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">patch.dict</span></code> can all be used as context managers.</p>\n<p>Where you use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> to create a mock for you, you can get a reference to the\nmock using the “as” form of the with statement:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">ProductionClass</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">method</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">(</span><span class=\"n\">ProductionClass</span><span class=\"p\">,</span> <span class=\"s1\">&#39;method&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_method</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mock_method</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n<span class=\"gp\">... </span>    <span class=\"n\">real</span> <span class=\"o\">=</span> <span class=\"n\">ProductionClass</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>    <span class=\"n\">real</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_method</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>As an alternative <code class=\"docutils literal notranslate\"><span class=\"pre\">patch</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">patch.object</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">patch.dict</span></code> can be used as\nclass decorators. When used in this way it is the same as applying the\ndecorator individually to every method whose name starts with “test”.</p>\n</section>\n<section id=\"further-examples\">\n<span id=\"id1\"></span><h2>Further Examples<a class=\"headerlink\" href=\"#further-examples\" title=\"Link to this heading\">¶</a></h2>\n<p>Here are some more examples for some slightly more advanced scenarios.</p>\n<section id=\"mocking-chained-calls\">\n<h3>Mocking chained calls<a class=\"headerlink\" href=\"#mocking-chained-calls\" title=\"Link to this heading\">¶</a></h3>\n<p>Mocking chained calls is actually straightforward with mock once you\nunderstand the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.return_value\" title=\"unittest.mock.Mock.return_value\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">return_value</span></code></a> attribute. When a mock is called for\nthe first time, or you fetch its <code class=\"docutils literal notranslate\"><span class=\"pre\">return_value</span></code> before it has been called, a\nnew <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> is created.</p>\n<p>This means that you can see how the object returned from a call to a mocked\nobject has been used by interrogating the <code class=\"docutils literal notranslate\"><span class=\"pre\">return_value</span></code> mock:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"go\">&lt;Mock name=&#39;mock().foo()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">return_value</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>From here it is a simple step to configure and then make assertions about\nchained calls. Of course another alternative is writing your code in a more\ntestable way in the first place…</p>\n<p>So, suppose we have some code that looks a little bit like this:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Something</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">backend</span> <span class=\"o\">=</span> <span class=\"n\">BackendProvider</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">method</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">backend</span><span class=\"o\">.</span><span class=\"n\">get_endpoint</span><span class=\"p\">(</span><span class=\"s1\">&#39;foobar&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">create_call</span><span class=\"p\">(</span><span class=\"s1\">&#39;spam&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">start_call</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>        <span class=\"c1\"># more code</span>\n</pre></div>\n</div>\n<p>Assuming that <code class=\"docutils literal notranslate\"><span class=\"pre\">BackendProvider</span></code> is already well tested, how do we test\n<code class=\"docutils literal notranslate\"><span class=\"pre\">method()</span></code>? Specifically, we want to test that the code section <code class=\"docutils literal notranslate\"><span class=\"pre\">#</span> <span class=\"pre\">more</span>\n<span class=\"pre\">code</span></code> uses the response object in the correct way.</p>\n<p>As this chain of calls is made from an instance attribute we can monkey patch\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">backend</span></code> attribute on a <code class=\"docutils literal notranslate\"><span class=\"pre\">Something</span></code> instance. In this particular case\nwe are only interested in the return value from the final call to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">start_call</span></code> so we don’t have much configuration to do. Let’s assume the\nobject it returns is ‘file-like’, so we’ll ensure that our response object\nuses the builtin <a class=\"reference internal\" href=\"functions.html#open\" title=\"open\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">open()</span></code></a> as its <code class=\"docutils literal notranslate\"><span class=\"pre\">spec</span></code>.</p>\n<p>To do this we create a mock instance as our mock backend and create a mock\nresponse object for it. To set the response as the return value for that final\n<code class=\"docutils literal notranslate\"><span class=\"pre\">start_call</span></code> we could do this:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">mock_backend</span><span class=\"o\">.</span><span class=\"n\">get_endpoint</span><span class=\"o\">.</span><span class=\"n\">return_value</span><span class=\"o\">.</span><span class=\"n\">create_call</span><span class=\"o\">.</span><span class=\"n\">return_value</span><span class=\"o\">.</span><span class=\"n\">start_call</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"n\">mock_response</span>\n</pre></div>\n</div>\n<p>We can do that in a slightly nicer way using the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.configure_mock\" title=\"unittest.mock.Mock.configure_mock\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">configure_mock()</span></code></a>\nmethod to directly set the return value for us:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">something</span> <span class=\"o\">=</span> <span class=\"n\">Something</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_response</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">spec</span><span class=\"o\">=</span><span class=\"nb\">open</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_backend</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">config</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;get_endpoint.return_value.create_call.return_value.start_call.return_value&#39;</span><span class=\"p\">:</span> <span class=\"n\">mock_response</span><span class=\"p\">}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_backend</span><span class=\"o\">.</span><span class=\"n\">configure_mock</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">config</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>With these we monkey patch the “mock backend” in place and can make the real\ncall:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">something</span><span class=\"o\">.</span><span class=\"n\">backend</span> <span class=\"o\">=</span> <span class=\"n\">mock_backend</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">something</span><span class=\"o\">.</span><span class=\"n\">method</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Using <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.mock_calls\" title=\"unittest.mock.Mock.mock_calls\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code></a> we can check the chained call with a single\nassert. A chained call is several calls in one line of code, so there will be\nseveral entries in <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code>. We can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.call.call_list\" title=\"unittest.mock.call.call_list\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">call.call_list()</span></code></a> to create\nthis list of calls for us:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">chained</span> <span class=\"o\">=</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">get_endpoint</span><span class=\"p\">(</span><span class=\"s1\">&#39;foobar&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">create_call</span><span class=\"p\">(</span><span class=\"s1\">&#39;spam&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">start_call</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">call_list</span> <span class=\"o\">=</span> <span class=\"n\">chained</span><span class=\"o\">.</span><span class=\"n\">call_list</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">mock_backend</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span> <span class=\"o\">==</span> <span class=\"n\">call_list</span>\n</pre></div>\n</div>\n</section>\n<section id=\"partial-mocking\">\n<h3>Partial mocking<a class=\"headerlink\" href=\"#partial-mocking\" title=\"Link to this heading\">¶</a></h3>\n<p>For some tests, you may want to mock out a call to <a class=\"reference internal\" href=\"datetime.html#datetime.date.today\" title=\"datetime.date.today\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">datetime.date.today()</span></code></a>\nto return a known date, but don’t want to prevent the code under test from\ncreating new date objects. Unfortunately <a class=\"reference internal\" href=\"datetime.html#datetime.date\" title=\"datetime.date\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">datetime.date</span></code></a> is written in C,\nso you cannot just monkey-patch out the static <a class=\"reference internal\" href=\"datetime.html#datetime.date.today\" title=\"datetime.date.today\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">datetime.date.today()</span></code></a> method.</p>\n<p>Instead, you can effectively wrap the date\nclass with a mock, while passing through calls to the constructor to the real\nclass (and returning real instances).</p>\n<p>The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch</span> <span class=\"pre\">decorator</span></code></a> is used here to\nmock out the <code class=\"docutils literal notranslate\"><span class=\"pre\">date</span></code> class in the module under test. The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.side_effect\" title=\"unittest.mock.Mock.side_effect\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">side_effect</span></code></a>\nattribute on the mock date class is then set to a lambda function that returns\na real date. When the mock date class is called a real date will be\nconstructed and returned by <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code>.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">datetime</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">date</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.date&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_date</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mock_date</span><span class=\"o\">.</span><span class=\"n\">today</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2010</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mock_date</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">:</span> <span class=\"n\">date</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kw</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"o\">.</span><span class=\"n\">today</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2010</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2009</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"n\">date</span><span class=\"p\">(</span><span class=\"mi\">2009</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"mi\">8</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Note that we don’t patch <a class=\"reference internal\" href=\"datetime.html#datetime.date\" title=\"datetime.date\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">datetime.date</span></code></a> globally, we patch <code class=\"docutils literal notranslate\"><span class=\"pre\">date</span></code> in the\nmodule that <em>uses</em> it. See <a class=\"reference internal\" href=\"unittest.mock.html#where-to-patch\"><span class=\"std std-ref\">where to patch</span></a>.</p>\n<p>When <code class=\"docutils literal notranslate\"><span class=\"pre\">date.today()</span></code> is called a known date is returned, but calls to the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">date(...)</span></code> constructor still return normal dates. Without this you can find\nyourself having to calculate an expected result using exactly the same\nalgorithm as the code under test, which is a classic testing anti-pattern.</p>\n<p>Calls to the date constructor are recorded in the <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_date</span></code> attributes\n(<code class=\"docutils literal notranslate\"><span class=\"pre\">call_count</span></code> and friends) which may also be useful for your tests.</p>\n<p>An alternative way of dealing with mocking dates, or other builtin classes,\nis discussed in <a class=\"reference external\" href=\"https://williambert.online/2011/07/how-to-unit-testing-in-django-with-mocking-and-patching/\">this blog entry</a>.</p>\n</section>\n<section id=\"mocking-a-generator-method\">\n<h3>Mocking a Generator Method<a class=\"headerlink\" href=\"#mocking-a-generator-method\" title=\"Link to this heading\">¶</a></h3>\n<p>A Python generator is a function or method that uses the <a class=\"reference internal\" href=\"../reference/simple_stmts.html#yield\"><code class=\"xref std std-keyword docutils literal notranslate\"><span class=\"pre\">yield</span></code></a> statement\nto return a series of values when iterated over <a class=\"footnote-reference brackets\" href=\"#id3\" id=\"id2\" role=\"doc-noteref\"><span class=\"fn-bracket\">[</span>1<span class=\"fn-bracket\">]</span></a>.</p>\n<p>A generator method / function is called to return the generator object. It is\nthe generator object that is then iterated over. The protocol method for\niteration is <a class=\"reference internal\" href=\"stdtypes.html#container.__iter__\" title=\"container.__iter__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__iter__()</span></code></a>, so we can\nmock this using a <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.MagicMock\" title=\"unittest.mock.MagicMock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code></a>.</p>\n<p>Here’s an example class with an “iter” method implemented as a generator:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Foo</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">iter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]:</span>\n<span class=\"gp\">... </span>            <span class=\"k\">yield</span> <span class=\"n\">i</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">foo</span> <span class=\"o\">=</span> <span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">iter</span><span class=\"p\">())</span>\n<span class=\"go\">[1, 2, 3]</span>\n</pre></div>\n</div>\n<p>How would we mock this class, and in particular its “iter” method?</p>\n<p>To configure the values returned from the iteration (implicit in the call to\n<a class=\"reference internal\" href=\"stdtypes.html#list\" title=\"list\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">list</span></code></a>), we need to configure the object returned by the call to <code class=\"docutils literal notranslate\"><span class=\"pre\">foo.iter()</span></code>.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_foo</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_foo</span><span class=\"o\">.</span><span class=\"n\">iter</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span><span class=\"p\">([</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">])</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">mock_foo</span><span class=\"o\">.</span><span class=\"n\">iter</span><span class=\"p\">())</span>\n<span class=\"go\">[1, 2, 3]</span>\n</pre></div>\n</div>\n<aside class=\"footnote-list brackets\">\n<aside class=\"footnote brackets\" id=\"id3\" role=\"doc-footnote\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id2\">1</a><span class=\"fn-bracket\">]</span></span>\n<p>There are also generator expressions and more <a class=\"reference external\" href=\"http://www.dabeaz.com/coroutines/index.html\">advanced uses</a> of generators, but we aren’t\nconcerned about them here. A very good introduction to generators and how\npowerful they are is: <a class=\"reference external\" href=\"http://www.dabeaz.com/generators/\">Generator Tricks for Systems Programmers</a>.</p>\n</aside>\n</aside>\n</section>\n<section id=\"applying-the-same-patch-to-every-test-method\">\n<h3>Applying the same patch to every test method<a class=\"headerlink\" href=\"#applying-the-same-patch-to-every-test-method\" title=\"Link to this heading\">¶</a></h3>\n<p>If you want several patches in place for multiple test methods the obvious way\nis to apply the patch decorators to every method. This can feel like unnecessary\nrepetition. Instead, you can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> (in all its\nvarious forms) as a class decorator. This applies the patches to all test\nmethods on the class. A test method is identified by methods whose names start\nwith <code class=\"docutils literal notranslate\"><span class=\"pre\">test</span></code>:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"nd\">@patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.SomeClass&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_one</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">MockSomeClass</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">SomeClass</span><span class=\"p\">,</span> <span class=\"n\">MockSomeClass</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_two</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">MockSomeClass</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">SomeClass</span><span class=\"p\">,</span> <span class=\"n\">MockSomeClass</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">not_a_test</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"s1\">&#39;something&#39;</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_one&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_one</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_two&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_two</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_two&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">not_a_test</span><span class=\"p\">()</span>\n<span class=\"go\">&#39;something&#39;</span>\n</pre></div>\n</div>\n<p>An alternative way of managing patches is to use the <a class=\"reference internal\" href=\"unittest.mock.html#start-and-stop\"><span class=\"std std-ref\">patch methods: start and stop</span></a>.\nThese allow you to move the patching into your <code class=\"docutils literal notranslate\"><span class=\"pre\">setUp</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">tearDown</span></code> methods.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">setUp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">patcher</span> <span class=\"o\">=</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.foo&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mock_foo</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_foo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mock_foo</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">tearDown</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">stop</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_foo&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>If you use this technique you must ensure that the patching is “undone” by\ncalling <code class=\"docutils literal notranslate\"><span class=\"pre\">stop</span></code>. This can be fiddlier than you might think, because if an\nexception is raised in the setUp then tearDown is not called.\n<a class=\"reference internal\" href=\"unittest.html#unittest.TestCase.addCleanup\" title=\"unittest.TestCase.addCleanup\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">unittest.TestCase.addCleanup()</span></code></a> makes this easier:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">setUp</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">patcher</span> <span class=\"o\">=</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.foo&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">addCleanup</span><span class=\"p\">(</span><span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">stop</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mock_foo</span> <span class=\"o\">=</span> <span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_foo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">assertIs</span><span class=\"p\">(</span><span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mock_foo</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_foo&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mocking-unbound-methods\">\n<h3>Mocking Unbound Methods<a class=\"headerlink\" href=\"#mocking-unbound-methods\" title=\"Link to this heading\">¶</a></h3>\n<p>Sometimes a test needs to patch an <em>unbound method</em>, which means patching the\nmethod on the class rather than on the instance. In order to make assertions\nabout which objects were calling this particular method, you need to pass\n<code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code> as the first argument. The issue is that you can’t patch with a mock for\nthis, because if you replace an unbound method with a mock it doesn’t become\na bound method when fetched from the instance, and so it doesn’t get <code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code>\npassed in. The workaround is to patch the unbound method with a real function\ninstead. The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch\" title=\"unittest.mock.patch\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch()</span></code></a> decorator makes it so simple to patch out methods\nwith a mock that having to create a real function becomes a nuisance.</p>\n<p>If you pass <code class=\"docutils literal notranslate\"><span class=\"pre\">autospec=True</span></code> to patch then it does the patching with a\n<em>real</em> function object. This function object has the same signature as the one\nit is replacing, but delegates to a mock under the hood. You still get your\nmock auto-created in exactly the same way as before. What it means though, is\nthat if you use it to patch out an unbound method on a class the mocked\nfunction will be turned into a bound method if it is fetched from an instance.\nIt will have <code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code> passed in as the first argument, which is exactly what\nwas needed:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Foo</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>  <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">foo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">pass</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">,</span> <span class=\"s1\">&#39;foo&#39;</span><span class=\"p\">,</span> <span class=\"n\">autospec</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_foo</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>  <span class=\"n\">mock_foo</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;foo&#39;</span>\n<span class=\"gp\">... </span>  <span class=\"n\">foo</span> <span class=\"o\">=</span> <span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>  <span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">&#39;foo&#39;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_foo</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">(</span><span class=\"n\">foo</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>If we don’t use <code class=\"docutils literal notranslate\"><span class=\"pre\">autospec=True</span></code> then the unbound method is patched out\nwith a Mock instance instead, and isn’t called with <code class=\"docutils literal notranslate\"><span class=\"pre\">self</span></code>.</p>\n</section>\n<section id=\"checking-multiple-calls-with-mock\">\n<h3>Checking multiple calls with mock<a class=\"headerlink\" href=\"#checking-multiple-calls-with-mock\" title=\"Link to this heading\">¶</a></h3>\n<p>mock has a nice API for making assertions about how your mock objects are used.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"o\">.</span><span class=\"n\">return_value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"p\">(</span><span class=\"s1\">&#39;baz&#39;</span><span class=\"p\">,</span> <span class=\"n\">spam</span><span class=\"o\">=</span><span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"s1\">&#39;baz&#39;</span><span class=\"p\">,</span> <span class=\"n\">spam</span><span class=\"o\">=</span><span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>If your mock is only being called once you can use the\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_called_once_with\" title=\"unittest.mock.Mock.assert_called_once_with\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_called_once_with()</span></code></a> method that also asserts that the\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.call_count\" title=\"unittest.mock.Mock.call_count\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">call_count</span></code></a> is one.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">(</span><span class=\"s1\">&#39;baz&#39;</span><span class=\"p\">,</span> <span class=\"n\">spam</span><span class=\"o\">=</span><span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">foo_bar</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">(</span><span class=\"s1\">&#39;baz&#39;</span><span class=\"p\">,</span> <span class=\"n\">spam</span><span class=\"o\">=</span><span class=\"s1\">&#39;eggs&#39;</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>: <span class=\"n\">Expected &#39;foo_bar&#39; to be called once. Called 2 times.</span>\n<span class=\"x\">Calls: [call(&#39;baz&#39;, spam=&#39;eggs&#39;), call()].</span>\n</pre></div>\n</div>\n<p>Both <code class=\"docutils literal notranslate\"><span class=\"pre\">assert_called_with</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">assert_called_once_with</span></code> make assertions about\nthe <em>most recent</em> call. If your mock is going to be called several times, and\nyou want to make assertions about <em>all</em> those calls you can use\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.call_args_list\" title=\"unittest.mock.Mock.call_args_list\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">call_args_list</span></code></a>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">call_args_list</span>\n<span class=\"go\">[call(1, 2, 3), call(4, 5, 6), call()]</span>\n</pre></div>\n</div>\n<p>The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.call\" title=\"unittest.mock.call\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">call</span></code></a> helper makes it easy to make assertions about these calls. You\ncan build up a list of expected calls and compare it to <code class=\"docutils literal notranslate\"><span class=\"pre\">call_args_list</span></code>. This\nlooks remarkably similar to the repr of the <code class=\"docutils literal notranslate\"><span class=\"pre\">call_args_list</span></code>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">expected</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">call</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">),</span> <span class=\"n\">call</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">),</span> <span class=\"n\">call</span><span class=\"p\">()]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">call_args_list</span> <span class=\"o\">==</span> <span class=\"n\">expected</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n</section>\n<section id=\"coping-with-mutable-arguments\">\n<h3>Coping with mutable arguments<a class=\"headerlink\" href=\"#coping-with-mutable-arguments\" title=\"Link to this heading\">¶</a></h3>\n<p>Another situation is rare, but can bite you, is when your mock is called with\nmutable arguments. <code class=\"docutils literal notranslate\"><span class=\"pre\">call_args</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">call_args_list</span></code> store <em>references</em> to the\narguments. If the arguments are mutated by the code under test then you can no\nlonger make assertions about what the values were when the mock was called.</p>\n<p>Here’s some example code that shows the problem. Imagine the following functions\ndefined in ‘mymodule’:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">frob</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n<span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">grob</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">):</span>\n    <span class=\"s2\">&quot;First frob and then clear val&quot;</span>\n    <span class=\"n\">frob</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span>\n    <span class=\"n\">val</span><span class=\"o\">.</span><span class=\"n\">clear</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>When we try to test that <code class=\"docutils literal notranslate\"><span class=\"pre\">grob</span></code> calls <code class=\"docutils literal notranslate\"><span class=\"pre\">frob</span></code> with the correct argument look\nwhat happens:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.frob&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_frob</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"mi\">6</span><span class=\"p\">}</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">grob</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">val</span>\n<span class=\"go\">set()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_frob</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">({</span><span class=\"mi\">6</span><span class=\"p\">})</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>: <span class=\"n\">Expected: (({6},), {})</span>\n<span class=\"x\">Called with: ((set(),), {})</span>\n</pre></div>\n</div>\n<p>One possibility would be for mock to copy the arguments you pass in. This\ncould then cause problems if you do assertions that rely on object identity\nfor equality.</p>\n<p>Here’s one solution that uses the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.side_effect\" title=\"unittest.mock.Mock.side_effect\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">side_effect</span></code></a>\nfunctionality. If you provide a <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> function for a mock then\n<code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> will be called with the same args as the mock. This gives us an\nopportunity to copy the arguments and store them for later assertions. In this\nexample I’m using <em>another</em> mock to store the arguments so that I can use the\nmock methods for doing the assertion. Again a helper function sets this up for\nme.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">copy</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">deepcopy</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">unittest.mock</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Mock</span><span class=\"p\">,</span> <span class=\"n\">patch</span><span class=\"p\">,</span> <span class=\"n\">DEFAULT</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">copy_call_args</span><span class=\"p\">(</span><span class=\"n\">mock</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"n\">new_mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">side_effect</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">new_mock</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"n\">DEFAULT</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"n\">side_effect</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"n\">new_mock</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.frob&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_frob</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"n\">new_mock</span> <span class=\"o\">=</span> <span class=\"n\">copy_call_args</span><span class=\"p\">(</span><span class=\"n\">mock_frob</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>    <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"mi\">6</span><span class=\"p\">}</span>\n<span class=\"gp\">... </span>    <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">grob</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">new_mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">({</span><span class=\"mi\">6</span><span class=\"p\">})</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">new_mock</span><span class=\"o\">.</span><span class=\"n\">call_args</span>\n<span class=\"go\">call({6})</span>\n</pre></div>\n</div>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">copy_call_args</span></code> is called with the mock that will be called. It returns a new\nmock that we do the assertion on. The <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> function makes a copy of\nthe args and calls our <code class=\"docutils literal notranslate\"><span class=\"pre\">new_mock</span></code> with the copy.</p>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>If your mock is only going to be used once there is an easier way of\nchecking arguments at the point they are called. You can simply do the\nchecking inside a <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> function.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">side_effect</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">assert</span> <span class=\"n\">arg</span> <span class=\"o\">==</span> <span class=\"p\">{</span><span class=\"mi\">6</span><span class=\"p\">}</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"n\">side_effect</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">({</span><span class=\"mi\">6</span><span class=\"p\">})</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"nb\">set</span><span class=\"p\">())</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>\n</pre></div>\n</div>\n</div>\n<p>An alternative approach is to create a subclass of <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> or\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.MagicMock\" title=\"unittest.mock.MagicMock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code></a> that copies (using <a class=\"reference internal\" href=\"copy.html#copy.deepcopy\" title=\"copy.deepcopy\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">copy.deepcopy()</span></code></a>) the arguments.\nHere’s an example implementation:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">copy</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">deepcopy</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">CopyingMock</span><span class=\"p\">(</span><span class=\"n\">MagicMock</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">/</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__call__</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span> <span class=\"o\">=</span> <span class=\"n\">CopyingMock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">arg</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">arg</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"nb\">set</span><span class=\"p\">())</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">arg</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>: <span class=\"n\">expected call not found.</span>\n<span class=\"x\">Expected: mock({1})</span>\n<span class=\"x\">Actual: mock(set())</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">c</span><span class=\"o\">.</span><span class=\"n\">foo</span>\n<span class=\"go\">&lt;CopyingMock name=&#39;mock.foo&#39; id=&#39;...&#39;&gt;</span>\n</pre></div>\n</div>\n<p>When you subclass <code class=\"docutils literal notranslate\"><span class=\"pre\">Mock</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> all dynamically created attributes,\nand the <code class=\"docutils literal notranslate\"><span class=\"pre\">return_value</span></code> will use your subclass automatically. That means all\nchildren of a <code class=\"docutils literal notranslate\"><span class=\"pre\">CopyingMock</span></code> will also have the type <code class=\"docutils literal notranslate\"><span class=\"pre\">CopyingMock</span></code>.</p>\n</section>\n<section id=\"nesting-patches\">\n<h3>Nesting Patches<a class=\"headerlink\" href=\"#nesting-patches\" title=\"Link to this heading\">¶</a></h3>\n<p>Using patch as a context manager is nice, but if you do multiple patches you\ncan end up with nested with statements indenting further and further to the\nright:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_foo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Foo&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_foo</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>            <span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Bar&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_bar</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>                <span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Spam&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mock_spam</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>                    <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span> <span class=\"ow\">is</span> <span class=\"n\">mock_foo</span>\n<span class=\"gp\">... </span>                    <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Bar</span> <span class=\"ow\">is</span> <span class=\"n\">mock_bar</span>\n<span class=\"gp\">... </span>                    <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Spam</span> <span class=\"ow\">is</span> <span class=\"n\">mock_spam</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">original</span> <span class=\"o\">=</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_foo&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">test_foo</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span> <span class=\"ow\">is</span> <span class=\"n\">original</span>\n</pre></div>\n</div>\n<p>With unittest <code class=\"docutils literal notranslate\"><span class=\"pre\">cleanup</span></code> functions and the <a class=\"reference internal\" href=\"unittest.mock.html#start-and-stop\"><span class=\"std std-ref\">patch methods: start and stop</span></a> we can\nachieve the same effect without the nested indentation. A simple helper\nmethod, <code class=\"docutils literal notranslate\"><span class=\"pre\">create_patch</span></code>, puts the patch in place and returns the created mock\nfor us:</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyTest</span><span class=\"p\">(</span><span class=\"n\">unittest</span><span class=\"o\">.</span><span class=\"n\">TestCase</span><span class=\"p\">):</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">create_patch</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">patcher</span> <span class=\"o\">=</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">thing</span> <span class=\"o\">=</span> <span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">addCleanup</span><span class=\"p\">(</span><span class=\"n\">patcher</span><span class=\"o\">.</span><span class=\"n\">stop</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"n\">thing</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">test_foo</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"n\">mock_foo</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Foo&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">mock_bar</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Bar&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">mock_spam</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">create_patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Spam&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">... </span>        <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span> <span class=\"ow\">is</span> <span class=\"n\">mock_foo</span>\n<span class=\"gp\">... </span>        <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Bar</span> <span class=\"ow\">is</span> <span class=\"n\">mock_bar</span>\n<span class=\"gp\">... </span>        <span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Spam</span> <span class=\"ow\">is</span> <span class=\"n\">mock_spam</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">original</span> <span class=\"o\">=</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">MyTest</span><span class=\"p\">(</span><span class=\"s1\">&#39;test_foo&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">run</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"n\">mymodule</span><span class=\"o\">.</span><span class=\"n\">Foo</span> <span class=\"ow\">is</span> <span class=\"n\">original</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mocking-a-dictionary-with-magicmock\">\n<h3>Mocking a dictionary with MagicMock<a class=\"headerlink\" href=\"#mocking-a-dictionary-with-magicmock\" title=\"Link to this heading\">¶</a></h3>\n<p>You may want to mock a dictionary, or other container object, recording all\naccess to it whilst having it still behave like a dictionary.</p>\n<p>We can do this with <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.MagicMock\" title=\"unittest.mock.MagicMock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code></a>, which will behave like a dictionary,\nand using <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.side_effect\" title=\"unittest.mock.Mock.side_effect\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">side_effect</span></code></a> to delegate dictionary access to a real\nunderlying dictionary that is under our control.</p>\n<p>When the <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__getitem__\" title=\"object.__getitem__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__getitem__()</span></code></a> and <a class=\"reference internal\" href=\"../reference/datamodel.html#object.__setitem__\" title=\"object.__setitem__\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">__setitem__()</span></code></a> methods\nof our <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> are called\n(normal dictionary access) then <code class=\"docutils literal notranslate\"><span class=\"pre\">side_effect</span></code> is called with the key (and in\nthe case of <code class=\"docutils literal notranslate\"><span class=\"pre\">__setitem__</span></code> the value too). We can also control what is returned.</p>\n<p>After the <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> has been used we can use attributes like\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.call_args_list\" title=\"unittest.mock.Mock.call_args_list\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">call_args_list</span></code></a> to assert about how the dictionary was used:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">my_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;b&#39;</span><span class=\"p\">:</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;c&#39;</span><span class=\"p\">:</span> <span class=\"mi\">3</span><span class=\"p\">}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">getitem</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>     <span class=\"k\">return</span> <span class=\"n\">my_dict</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">setitem</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"n\">my_dict</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">val</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__getitem__</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"n\">getitem</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"n\">setitem</span>\n</pre></div>\n</div>\n<div class=\"admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>An alternative to using <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> is to use <code class=\"docutils literal notranslate\"><span class=\"pre\">Mock</span></code> and <em>only</em> provide\nthe magic methods you specifically want:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__getitem__</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"n\">getitem</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">side_effect</span><span class=\"o\">=</span><span class=\"n\">setitem</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>A <em>third</em> option is to use <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> but passing in <code class=\"docutils literal notranslate\"><span class=\"pre\">dict</span></code> as the <em>spec</em>\n(or <em>spec_set</em>) argument so that the <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> created only has\ndictionary magic methods available:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"n\">spec_set</span><span class=\"o\">=</span><span class=\"nb\">dict</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__getitem__</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"n\">getitem</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"o\">.</span><span class=\"n\">side_effect</span> <span class=\"o\">=</span> <span class=\"n\">setitem</span>\n</pre></div>\n</div>\n</div>\n<p>With these side effect functions in place, the <code class=\"docutils literal notranslate\"><span class=\"pre\">mock</span></code> will behave like a normal\ndictionary but recording the access. It even raises a <a class=\"reference internal\" href=\"exceptions.html#KeyError\" title=\"KeyError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">KeyError</span></code></a> if you try\nto access a key that doesn’t exist.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;a&#39;</span><span class=\"p\">]</span>\n<span class=\"go\">1</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;c&#39;</span><span class=\"p\">]</span>\n<span class=\"go\">3</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;d&#39;</span><span class=\"p\">]</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">KeyError</span>: <span class=\"n\">&#39;d&#39;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;b&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;fish&#39;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;d&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;eggs&#39;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;b&#39;</span><span class=\"p\">]</span>\n<span class=\"go\">&#39;fish&#39;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">[</span><span class=\"s1\">&#39;d&#39;</span><span class=\"p\">]</span>\n<span class=\"go\">&#39;eggs&#39;</span>\n</pre></div>\n</div>\n<p>After it has been used you can make assertions about the access using the normal\nmock methods and attributes:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__getitem__</span><span class=\"o\">.</span><span class=\"n\">call_args_list</span>\n<span class=\"go\">[call(&#39;a&#39;), call(&#39;c&#39;), call(&#39;d&#39;), call(&#39;b&#39;), call(&#39;d&#39;)]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"o\">.</span><span class=\"n\">call_args_list</span>\n<span class=\"go\">[call(&#39;b&#39;, &#39;fish&#39;), call(&#39;d&#39;, &#39;eggs&#39;)]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">my_dict</span>\n<span class=\"go\">{&#39;a&#39;: 1, &#39;b&#39;: &#39;fish&#39;, &#39;c&#39;: 3, &#39;d&#39;: &#39;eggs&#39;}</span>\n</pre></div>\n</div>\n</section>\n<section id=\"mock-subclasses-and-their-attributes\">\n<h3>Mock subclasses and their attributes<a class=\"headerlink\" href=\"#mock-subclasses-and-their-attributes\" title=\"Link to this heading\">¶</a></h3>\n<p>There are various reasons why you might want to subclass <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a>. One\nreason might be to add helper methods. Here’s a silly example:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">MyMock</span><span class=\"p\">(</span><span class=\"n\">MagicMock</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">has_been_called</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">called</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span> <span class=\"o\">=</span> <span class=\"n\">MyMock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span>\n<span class=\"go\">&lt;MyMock id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">has_been_called</span><span class=\"p\">()</span>\n<span class=\"go\">False</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">has_been_called</span><span class=\"p\">()</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>The standard behaviour for <code class=\"docutils literal notranslate\"><span class=\"pre\">Mock</span></code> instances is that attributes and the return\nvalue mocks are of the same type as the mock they are accessed on. This ensures\nthat <code class=\"docutils literal notranslate\"><span class=\"pre\">Mock</span></code> attributes are <code class=\"docutils literal notranslate\"><span class=\"pre\">Mocks</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMock</span></code> attributes are <code class=\"docutils literal notranslate\"><span class=\"pre\">MagicMocks</span></code>\n<a class=\"footnote-reference brackets\" href=\"#id5\" id=\"id4\" role=\"doc-noteref\"><span class=\"fn-bracket\">[</span>2<span class=\"fn-bracket\">]</span></a>. So if you’re subclassing to add helper methods then they’ll also be\navailable on the attributes and return value mock of instances of your\nsubclass.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span>\n<span class=\"go\">&lt;MyMock name=&#39;mock.foo&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">has_been_called</span><span class=\"p\">()</span>\n<span class=\"go\">False</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;MyMock name=&#39;mock.foo()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">has_been_called</span><span class=\"p\">()</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>Sometimes this is inconvenient. For example, <a class=\"reference external\" href=\"https://code.google.com/archive/p/mock/issues/105\">one user</a> is subclassing mock to\ncreated a <a class=\"reference external\" href=\"https://twisted.org/documents/11.0.0/api/twisted.python.components.html\">Twisted adaptor</a>.\nHaving this applied to attributes too actually causes errors.</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">Mock</span></code> (in all its flavours) uses a method called <code class=\"docutils literal notranslate\"><span class=\"pre\">_get_child_mock</span></code> to create\nthese “sub-mocks” for attributes and return values. You can prevent your\nsubclass being used for attributes by overriding this method. The signature is\nthat it takes arbitrary keyword arguments (<code class=\"docutils literal notranslate\"><span class=\"pre\">**kwargs</span></code>) which are then passed\nonto the mock constructor:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Subclass</span><span class=\"p\">(</span><span class=\"n\">MagicMock</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">_get_child_mock</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">/</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"n\">MagicMock</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span> <span class=\"o\">=</span> <span class=\"n\">Subclass</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.foo&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">mymock</span><span class=\"p\">,</span> <span class=\"n\">Subclass</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">mymock</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">,</span> <span class=\"n\">Subclass</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">mymock</span><span class=\"p\">(),</span> <span class=\"n\">Subclass</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<aside class=\"footnote-list brackets\">\n<aside class=\"footnote brackets\" id=\"id5\" role=\"doc-footnote\">\n<span class=\"label\"><span class=\"fn-bracket\">[</span><a role=\"doc-backlink\" href=\"#id4\">2</a><span class=\"fn-bracket\">]</span></span>\n<p>An exception to this rule are the non-callable mocks. Attributes use the\ncallable variant because otherwise non-callable mocks couldn’t have callable\nmethods.</p>\n</aside>\n</aside>\n</section>\n<section id=\"mocking-imports-with-patch-dict\">\n<h3>Mocking imports with patch.dict<a class=\"headerlink\" href=\"#mocking-imports-with-patch-dict\" title=\"Link to this heading\">¶</a></h3>\n<p>One situation where mocking can be hard is where you have a local import inside\na function. These are harder to mock because they aren’t using an object from\nthe module namespace that we can patch out.</p>\n<p>Generally local imports are to be avoided. They are sometimes done to prevent\ncircular dependencies, for which there is <em>usually</em> a much better way to solve\nthe problem (refactor the code) or to prevent “up front costs” by delaying the\nimport. This can also be solved in better ways than an unconditional local\nimport (store the module as a class or module attribute and only do the import\non first use).</p>\n<p>That aside there is a way to use <code class=\"docutils literal notranslate\"><span class=\"pre\">mock</span></code> to affect the results of an import.\nImporting fetches an <em>object</em> from the <a class=\"reference internal\" href=\"sys.html#sys.modules\" title=\"sys.modules\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.modules</span></code></a> dictionary. Note that it\nfetches an <em>object</em>, which need not be a module. Importing a module for the\nfirst time results in a module object being put in <code class=\"docutils literal notranslate\"><span class=\"pre\">sys.modules</span></code>, so usually\nwhen you import something you get a module back. This need not be the case\nhowever.</p>\n<p>This means you can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.patch.dict\" title=\"unittest.mock.patch.dict\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">patch.dict()</span></code></a> to <em>temporarily</em> put a mock in place\nin <a class=\"reference internal\" href=\"sys.html#sys.modules\" title=\"sys.modules\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.modules</span></code></a>. Any imports whilst this patch is active will fetch the mock.\nWhen the patch is complete (the decorated function exits, the with statement\nbody is complete or <code class=\"docutils literal notranslate\"><span class=\"pre\">patcher.stop()</span></code> is called) then whatever was there\npreviously will be restored safely.</p>\n<p>Here’s an example that mocks out the ‘fooble’ module.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">sys</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"s1\">&#39;sys.modules&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;fooble&#39;</span><span class=\"p\">:</span> <span class=\"n\">mock</span><span class=\"p\">}):</span>\n<span class=\"gp\">... </span>   <span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">fooble</span>\n<span class=\"gp\">... </span>   <span class=\"n\">fooble</span><span class=\"o\">.</span><span class=\"n\">blob</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.blob()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">assert</span> <span class=\"s1\">&#39;fooble&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">modules</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">blob</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>As you can see the <code class=\"docutils literal notranslate\"><span class=\"pre\">import</span> <span class=\"pre\">fooble</span></code> succeeds, but on exit there is no ‘fooble’\nleft in <a class=\"reference internal\" href=\"sys.html#sys.modules\" title=\"sys.modules\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">sys.modules</span></code></a>.</p>\n<p>This also works for the <code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">module</span> <span class=\"pre\">import</span> <span class=\"pre\">name</span></code> form:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"s1\">&#39;sys.modules&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;fooble&#39;</span><span class=\"p\">:</span> <span class=\"n\">mock</span><span class=\"p\">}):</span>\n<span class=\"gp\">... </span>   <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">fooble</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">blob</span>\n<span class=\"gp\">... </span>   <span class=\"n\">blob</span><span class=\"o\">.</span><span class=\"n\">blip</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.blob.blip()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">blob</span><span class=\"o\">.</span><span class=\"n\">blip</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>With slightly more work you can also mock package imports:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">modules</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;package&#39;</span><span class=\"p\">:</span> <span class=\"n\">mock</span><span class=\"p\">,</span> <span class=\"s1\">&#39;package.module&#39;</span><span class=\"p\">:</span> <span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"p\">}</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"s1\">&#39;sys.modules&#39;</span><span class=\"p\">,</span> <span class=\"n\">modules</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>   <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">package.module</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">fooble</span>\n<span class=\"gp\">... </span>   <span class=\"n\">fooble</span><span class=\"p\">()</span>\n<span class=\"gp\">...</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.module.fooble()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">module</span><span class=\"o\">.</span><span class=\"n\">fooble</span><span class=\"o\">.</span><span class=\"n\">assert_called_once_with</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n</section>\n<section id=\"tracking-order-of-calls-and-less-verbose-call-assertions\">\n<h3>Tracking order of calls and less verbose call assertions<a class=\"headerlink\" href=\"#tracking-order-of-calls-and-less-verbose-call-assertions\" title=\"Link to this heading\">¶</a></h3>\n<p>The <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock\" title=\"unittest.mock.Mock\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Mock</span></code></a> class allows you to track the <em>order</em> of method calls on\nyour mock objects through the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.method_calls\" title=\"unittest.mock.Mock.method_calls\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">method_calls</span></code></a> attribute. This\ndoesn’t allow you to track the order of calls between separate mock objects,\nhowever we can use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.mock_calls\" title=\"unittest.mock.Mock.mock_calls\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code></a> to achieve the same effect.</p>\n<p>Because mocks track calls to child mocks in <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code>, and accessing an\narbitrary attribute of a mock creates a child mock, we can create our separate\nmocks from a parent one. Calls to those child mock will then all be recorded,\nin order, in the <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code> of the parent:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">manager</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_foo</span> <span class=\"o\">=</span> <span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">foo</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_bar</span> <span class=\"o\">=</span> <span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">bar</span>\n</pre></div>\n</div>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_foo</span><span class=\"o\">.</span><span class=\"n\">something</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.foo.something()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock_bar</span><span class=\"o\">.</span><span class=\"n\">other</span><span class=\"o\">.</span><span class=\"n\">thing</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;Mock name=&#39;mock.bar.other.thing()&#39; id=&#39;...&#39;&gt;</span>\n</pre></div>\n</div>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span>\n<span class=\"go\">[call.foo.something(), call.bar.other.thing()]</span>\n</pre></div>\n</div>\n<p>We can then assert about the calls, including the order, by comparing with\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code> attribute on the manager mock:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">expected_calls</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"o\">.</span><span class=\"n\">something</span><span class=\"p\">(),</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">bar</span><span class=\"o\">.</span><span class=\"n\">other</span><span class=\"o\">.</span><span class=\"n\">thing</span><span class=\"p\">()]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span> <span class=\"o\">==</span> <span class=\"n\">expected_calls</span>\n<span class=\"go\">True</span>\n</pre></div>\n</div>\n<p>If <code class=\"docutils literal notranslate\"><span class=\"pre\">patch</span></code> is creating, and putting in place, your mocks then you can attach\nthem to a manager mock using the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.attach_mock\" title=\"unittest.mock.Mock.attach_mock\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">attach_mock()</span></code></a> method. After\nattaching calls will be recorded in <code class=\"docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code> of the manager.</p>\n<div class=\"highlight-python3 notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">manager</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Class1&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">MockClass1</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">with</span> <span class=\"n\">patch</span><span class=\"p\">(</span><span class=\"s1\">&#39;mymodule.Class2&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">MockClass2</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">attach_mock</span><span class=\"p\">(</span><span class=\"n\">MockClass1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MockClass1&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">attach_mock</span><span class=\"p\">(</span><span class=\"n\">MockClass2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;MockClass2&#39;</span><span class=\"p\">)</span>\n<span class=\"gp\">... </span>        <span class=\"n\">MockClass1</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">()</span>\n<span class=\"gp\">... </span>        <span class=\"n\">MockClass2</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">bar</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.MockClass1().foo()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.MockClass2().bar()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">manager</span><span class=\"o\">.</span><span class=\"n\">mock_calls</span>\n<span class=\"go\">[call.MockClass1(),</span>\n<span class=\"go\">call.MockClass1().foo(),</span>\n<span class=\"go\">call.MockClass2(),</span>\n<span class=\"go\">call.MockClass2().bar()]</span>\n</pre></div>\n</div>\n<p>If many calls have been made, but you’re only interested in a particular\nsequence of them then an alternative is to use the\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_has_calls\" title=\"unittest.mock.Mock.assert_has_calls\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_has_calls()</span></code></a> method. This takes a list of calls (constructed\nwith the <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.call\" title=\"unittest.mock.call\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">call</span></code></a> object). If that sequence of calls are in\n<a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.mock_calls\" title=\"unittest.mock.Mock.mock_calls\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">mock_calls</span></code></a> then the assert succeeds.</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">foo</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">bar</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">baz</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock().foo().bar().baz()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">one</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">two</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">three</span><span class=\"p\">()</span>\n<span class=\"go\">&lt;MagicMock name=&#39;mock.one().two().three()&#39; id=&#39;...&#39;&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">calls</span> <span class=\"o\">=</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">one</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">two</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">three</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">call_list</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">assert_has_calls</span><span class=\"p\">(</span><span class=\"n\">calls</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Even though the chained call <code class=\"docutils literal notranslate\"><span class=\"pre\">m.one().two().three()</span></code> aren’t the only calls that\nhave been made to the mock, the assert still succeeds.</p>\n<p>Sometimes a mock may have several calls made to it, and you are only interested\nin asserting about <em>some</em> of those calls. You may not even care about the\norder. In this case you can pass <code class=\"docutils literal notranslate\"><span class=\"pre\">any_order=True</span></code> to <code class=\"docutils literal notranslate\"><span class=\"pre\">assert_has_calls</span></code>:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">MagicMock</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">two</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">),</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">seven</span><span class=\"p\">(</span><span class=\"mi\">7</span><span class=\"p\">),</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">fifty</span><span class=\"p\">(</span><span class=\"s1\">&#39;50&#39;</span><span class=\"p\">)</span>\n<span class=\"go\">(...)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">calls</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">fifty</span><span class=\"p\">(</span><span class=\"s1\">&#39;50&#39;</span><span class=\"p\">),</span> <span class=\"n\">call</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">call</span><span class=\"o\">.</span><span class=\"n\">seven</span><span class=\"p\">(</span><span class=\"mi\">7</span><span class=\"p\">)]</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">assert_has_calls</span><span class=\"p\">(</span><span class=\"n\">calls</span><span class=\"p\">,</span> <span class=\"n\">any_order</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"more-complex-argument-matching\">\n<h3>More complex argument matching<a class=\"headerlink\" href=\"#more-complex-argument-matching\" title=\"Link to this heading\">¶</a></h3>\n<p>Using the same basic concept as <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.ANY\" title=\"unittest.mock.ANY\"><code class=\"xref py py-data docutils literal notranslate\"><span class=\"pre\">ANY</span></code></a> we can implement matchers to do more\ncomplex assertions on objects used as arguments to mocks.</p>\n<p>Suppose we expect some object to be passed to a mock that by default\ncompares equal based on object identity (which is the Python default for user\ndefined classes). To use <a class=\"reference internal\" href=\"unittest.mock.html#unittest.mock.Mock.assert_called_with\" title=\"unittest.mock.Mock.assert_called_with\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">assert_called_with()</span></code></a> we would need to pass\nin the exact same object. If we are only interested in some of the attributes\nof this object then we can create a matcher that will check these attributes\nfor us.</p>\n<p>You can see in this example how a ‘standard’ call to <code class=\"docutils literal notranslate\"><span class=\"pre\">assert_called_with</span></code> isn’t\nsufficient:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Foo</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span>\n<span class=\"gp\">...</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span> <span class=\"o\">=</span> <span class=\"n\">Mock</span><span class=\"p\">(</span><span class=\"n\">return_value</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>: <span class=\"n\">expected call not found.</span>\n<span class=\"x\">Expected: mock(&lt;__main__.Foo object at 0x...&gt;)</span>\n<span class=\"x\">Actual: mock(&lt;__main__.Foo object at 0x...&gt;)</span>\n</pre></div>\n</div>\n<p>A comparison function for our <code class=\"docutils literal notranslate\"><span class=\"pre\">Foo</span></code> class might look something like this:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">compare</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">other</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n<span class=\"gp\">... </span>    <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">a</span> <span class=\"o\">!=</span> <span class=\"n\">other</span><span class=\"o\">.</span><span class=\"n\">a</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n<span class=\"gp\">... </span>    <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">b</span> <span class=\"o\">!=</span> <span class=\"n\">other</span><span class=\"o\">.</span><span class=\"n\">b</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n<span class=\"gp\">... </span>    <span class=\"k\">return</span> <span class=\"kc\">True</span>\n<span class=\"gp\">...</span>\n</pre></div>\n</div>\n<p>And a matcher object that can use comparison functions like this for its\nequality operation would look something like this:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">Matcher</span><span class=\"p\">:</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">compare</span><span class=\"p\">,</span> <span class=\"n\">some_obj</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">compare</span> <span class=\"o\">=</span> <span class=\"n\">compare</span>\n<span class=\"gp\">... </span>        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">some_obj</span> <span class=\"o\">=</span> <span class=\"n\">some_obj</span>\n<span class=\"gp\">... </span>    <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"fm\">__eq__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">other</span><span class=\"p\">):</span>\n<span class=\"gp\">... </span>        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">compare</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">some_obj</span><span class=\"p\">,</span> <span class=\"n\">other</span><span class=\"p\">)</span>\n<span class=\"gp\">...</span>\n</pre></div>\n</div>\n<p>Putting all this together:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">match_foo</span> <span class=\"o\">=</span> <span class=\"n\">Matcher</span><span class=\"p\">(</span><span class=\"n\">compare</span><span class=\"p\">,</span> <span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">match_foo</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">Matcher</span></code> is instantiated with our compare function and the <code class=\"docutils literal notranslate\"><span class=\"pre\">Foo</span></code> object\nwe want to compare against. In <code class=\"docutils literal notranslate\"><span class=\"pre\">assert_called_with</span></code> the <code class=\"docutils literal notranslate\"><span class=\"pre\">Matcher</span></code> equality\nmethod will be called, which compares the object the mock was called with\nagainst the one we created our matcher with. If they match then\n<code class=\"docutils literal notranslate\"><span class=\"pre\">assert_called_with</span></code> passes, and if they don’t an <a class=\"reference internal\" href=\"exceptions.html#AssertionError\" title=\"AssertionError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">AssertionError</span></code></a> is raised:</p>\n<div class=\"doctest highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">match_wrong</span> <span class=\"o\">=</span> <span class=\"n\">Matcher</span><span class=\"p\">(</span><span class=\"n\">compare</span><span class=\"p\">,</span> <span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">mock</span><span class=\"o\">.</span><span class=\"n\">assert_called_with</span><span class=\"p\">(</span><span class=\"n\">match_wrong</span><span class=\"p\">)</span>\n<span class=\"gt\">Traceback (most recent call last):</span>\n<span class=\"w\">    </span><span class=\"o\">...</span>\n<span class=\"gr\">AssertionError</span>: <span class=\"n\">Expected: ((&lt;Matcher object at 0x...&gt;,), {})</span>\n<span class=\"x\">Called with: ((&lt;Foo object at 0x...&gt;,), {})</span>\n</pre></div>\n</div>\n<p>With a bit of tweaking you could have the comparison function raise the\n<a class=\"reference internal\" href=\"exceptions.html#AssertionError\" title=\"AssertionError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">AssertionError</span></code></a> directly and provide a more useful failure message.</p>\n<p>As of version 1.5, the Python testing library <a class=\"reference external\" href=\"https://pyhamcrest.readthedocs.io/\">PyHamcrest</a> provides similar functionality,\nthat may be useful here, in the form of its equality matcher\n(<a class=\"reference external\" href=\"https://pyhamcrest.readthedocs.io/en/release-1.8/integration/#module-hamcrest.library.integration.match_equality\">hamcrest.library.integration.match_equality</a>).</p>\n</section>\n</section>\n</section>\n\n\n            <div class=\"clearer\"></div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sphinxsidebar\" role=\"navigation\" aria-label=\"Main\">\n        <div class=\"sphinxsidebarwrapper\">\n  <div>\n    <h3><a href=\"../contents.html\">Table of Contents</a></h3>\n    <ul>\n<li><a class=\"reference internal\" href=\"#\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — getting started</a><ul>\n<li><a class=\"reference internal\" href=\"#using-mock\">Using Mock</a><ul>\n<li><a class=\"reference internal\" href=\"#mock-patching-methods\">Mock Patching Methods</a></li>\n<li><a class=\"reference internal\" href=\"#mock-for-method-calls-on-an-object\">Mock for Method Calls on an Object</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-classes\">Mocking Classes</a></li>\n<li><a class=\"reference internal\" href=\"#naming-your-mocks\">Naming your mocks</a></li>\n<li><a class=\"reference internal\" href=\"#tracking-all-calls\">Tracking all Calls</a></li>\n<li><a class=\"reference internal\" href=\"#setting-return-values-and-attributes\">Setting Return Values and Attributes</a></li>\n<li><a class=\"reference internal\" href=\"#raising-exceptions-with-mocks\">Raising exceptions with mocks</a></li>\n<li><a class=\"reference internal\" href=\"#side-effect-functions-and-iterables\">Side effect functions and iterables</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-asynchronous-iterators\">Mocking asynchronous iterators</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-asynchronous-context-manager\">Mocking asynchronous context manager</a></li>\n<li><a class=\"reference internal\" href=\"#creating-a-mock-from-an-existing-object\">Creating a Mock from an Existing Object</a></li>\n<li><a class=\"reference internal\" href=\"#using-side-effect-to-return-per-file-content\">Using side_effect to return per file content</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#patch-decorators\">Patch Decorators</a></li>\n<li><a class=\"reference internal\" href=\"#further-examples\">Further Examples</a><ul>\n<li><a class=\"reference internal\" href=\"#mocking-chained-calls\">Mocking chained calls</a></li>\n<li><a class=\"reference internal\" href=\"#partial-mocking\">Partial mocking</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-a-generator-method\">Mocking a Generator Method</a></li>\n<li><a class=\"reference internal\" href=\"#applying-the-same-patch-to-every-test-method\">Applying the same patch to every test method</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-unbound-methods\">Mocking Unbound Methods</a></li>\n<li><a class=\"reference internal\" href=\"#checking-multiple-calls-with-mock\">Checking multiple calls with mock</a></li>\n<li><a class=\"reference internal\" href=\"#coping-with-mutable-arguments\">Coping with mutable arguments</a></li>\n<li><a class=\"reference internal\" href=\"#nesting-patches\">Nesting Patches</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-a-dictionary-with-magicmock\">Mocking a dictionary with MagicMock</a></li>\n<li><a class=\"reference internal\" href=\"#mock-subclasses-and-their-attributes\">Mock subclasses and their attributes</a></li>\n<li><a class=\"reference internal\" href=\"#mocking-imports-with-patch-dict\">Mocking imports with patch.dict</a></li>\n<li><a class=\"reference internal\" href=\"#tracking-order-of-calls-and-less-verbose-call-assertions\">Tracking order of calls and less verbose call assertions</a></li>\n<li><a class=\"reference internal\" href=\"#more-complex-argument-matching\">More complex argument matching</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n\n  </div>\n  <div>\n    <h4>Previous topic</h4>\n    <p class=\"topless\"><a href=\"unittest.mock.html\"\n                          title=\"previous chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — mock object library</a></p>\n  </div>\n  <div>\n    <h4>Next topic</h4>\n    <p class=\"topless\"><a href=\"test.html\"\n                          title=\"next chapter\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">test</span></code> — Regression tests package for Python</a></p>\n  </div>\n  <div role=\"note\" aria-label=\"source link\">\n    <h3>This page</h3>\n    <ul class=\"this-page-menu\">\n      <li><a href=\"../bugs.html\">Report a bug</a></li>\n      <li>\n        <a href=\"https://github.com/python/cpython/blob/main/Doc/library/unittest.mock-examples.rst?plain=1\"\n            rel=\"nofollow\">Show source\n        </a>\n      </li>\n    </ul>\n  </div>\n        </div>\n<div id=\"sidebarbutton\" title=\"Collapse sidebar\">\n<span>«</span>\n</div>\n\n      </div>\n      <div class=\"clearer\"></div>\n    </div>  \n    <div class=\"related\" role=\"navigation\" aria-label=\"Related\">\n      <h3>Navigation</h3>\n      <ul>\n        <li class=\"right\" style=\"margin-right: 10px\">\n          <a href=\"../genindex.html\" title=\"General Index\"\n             >index</a></li>\n        <li class=\"right\" >\n          <a href=\"../py-modindex.html\" title=\"Python Module Index\"\n             >modules</a> |</li>\n        <li class=\"right\" >\n          <a href=\"test.html\" title=\"test — Regression tests package for Python\"\n             >next</a> |</li>\n        <li class=\"right\" >\n          <a href=\"unittest.mock.html\" title=\"unittest.mock — mock object library\"\n             >previous</a> |</li>\n\n          <li><img src=\"../_static/py.svg\" alt=\"Python logo\" style=\"vertical-align: middle; margin-top: -1px\"></li>\n          <li><a href=\"https://www.python.org/\">Python</a> &#187;</li>\n          <li class=\"switchers\">\n            <div class=\"language_switcher_placeholder\"></div>\n            <div class=\"version_switcher_placeholder\"></div>\n          </li>\n          <li>\n              \n          </li>\n    <li id=\"cpython-language-and-version\">\n      <a href=\"../index.html\">3.14.0 Documentation</a> &#187;\n    </li>\n\n          <li class=\"nav-item nav-item-1\"><a href=\"index.html\" >The Python Standard Library</a> &#187;</li>\n          <li class=\"nav-item nav-item-2\"><a href=\"development.html\" >Development Tools</a> &#187;</li>\n        <li class=\"nav-item nav-item-this\"><a href=\"\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">unittest.mock</span></code> — getting started</a></li>\n                <li class=\"right\">\n                    \n\n    <div class=\"inline-search\" role=\"search\">\n        <form class=\"inline-search\" action=\"../search.html\" method=\"get\">\n          <input placeholder=\"Quick search\" aria-label=\"Quick search\" type=\"search\" name=\"q\" id=\"search-box\">\n          <input type=\"submit\" value=\"Go\">\n        </form>\n    </div>\n                     |\n                </li>\n            <li class=\"right\">\n<label class=\"theme-selector-label\">\n    Theme\n    <select class=\"theme-selector\" oninput=\"activateTheme(this.value)\">\n        <option value=\"auto\" selected>Auto</option>\n        <option value=\"light\">Light</option>\n        <option value=\"dark\">Dark</option>\n    </select>\n</label> |</li>\n            \n      </ul>\n    </div>  \n    <div class=\"footer\">\n    &copy; <a href=\"../copyright.html\">Copyright</a> 2001 Python Software Foundation.\n    <br>\n    This page is licensed under the Python Software Foundation License Version 2.\n    <br>\n    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.\n    <br>\n    \n      See <a href=\"/license.html\">History and License</a> for more information.<br>\n    \n    \n    <br>\n\n    The Python Software Foundation is a non-profit corporation.\n<a href=\"https://www.python.org/psf/donations/\">Please donate.</a>\n<br>\n    <br>\n      Last updated on Nov 25, 2025 (18:01 UTC).\n    \n      <a href=\"/bugs.html\">Found a bug</a>?\n    \n    <br>\n\n    Created using <a href=\"https://www.sphinx-doc.org/\">Sphinx</a> 8.2.3.\n    </div>\n\n    <script type=\"text/javascript\" src=\"../_static/switchers.js\"></script>\n  </body>\n</html>",
  "metadata": {
    "title": "unittest.mock — getting started — Python 3.14.0 documentation",
    "meta_description": "Using Mock: Mock Patching Methods: Common uses for Mock objects include: Patching methods, Recording method calls on objects. You might want to replace a method on an object to check that it is cal...",
    "h1": "— getting started"
  },
  "request_headers": {
    "Referer": "https://docs.python.org/3/library/",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en",
    "User-Agent": "DumbCrawler/1.0",
    "Accept-Encoding": "gzip, deflate"
  },
  "response_headers": {
    "Content-Length": "25537",
    "Server": "nginx",
    "Content-Type": "text/html",
    "Last-Modified": "Tue, 25 Nov 2025 18:03:26 GMT",
    "Etag": "\"6925ef6e-2f168\"",
    "X-Clacks-Overhead": "GNU Terry Pratchett",
    "Strict-Transport-Security": "max-age=315360000; includeSubDomains; preload",
    "Via": "1.1 varnish, 1.1 varnish",
    "Accept-Ranges": "bytes",
    "Age": "3685",
    "Date": "Wed, 26 Nov 2025 05:32:30 GMT",
    "X-Served-By": "cache-lga21923-LGA, cache-yul1970029-YUL",
    "X-Cache": "HIT, HIT",
    "X-Cache-Hits": "118, 0",
    "X-Timer": "S1764135151.662371,VS0,VE1",
    "Vary": "Accept-Encoding"
  },
  "crawled_at": "2025-11-26T05:32:31.370145+00:00",
  "crawler": {
    "name": "DumbCrawler",
    "version": "1.0",
    "mode": "crawl",
    "js_mode": "off",
    "scope": "subfolder"
  }
}